<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cotizador AT&T ¬∑ ExpertCell</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
<style>
:root {
  --att-blue: #009FDB;
  --att-dark: #00395D;
  --att-deep: #001A2F;
  --att-light: #E5F5FC;
  --att-accent: #00C7B1;
  --surface: #FFFFFF;
  --surface-2: #F6F8FB;
  --surface-3: #EDF1F7;
  --text: #0D1B2A;
  --text-2: #4A5F78;
  --text-3: #8899AA;
  --border: #DDE4ED;
  --success: #0FA958;
  --success-bg: #E8F8EF;
  --warning: #E6A200;
  --warning-bg: #FFF8E1;
  --danger: #DC3545;
  --danger-bg: #FEE2E5;
  --radius: 10px;
  --shadow-sm: 0 1px 3px rgba(0,31,63,0.06);
  --shadow-md: 0 4px 12px rgba(0,31,63,0.08);
  --shadow-lg: 0 8px 30px rgba(0,31,63,0.12);
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
  font-family: 'DM Sans', -apple-system, sans-serif;
  background: var(--surface-2);
  color: var(--text);
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
}

/* ===== HEADER ===== */
.header {
  background: linear-gradient(135deg, var(--att-deep) 0%, var(--att-dark) 40%, #005A8C 100%);
  padding: 0 20px;
  height: 56px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  z-index: 1000;
  box-shadow: 0 2px 16px rgba(0,31,63,0.25);
}
.header-left { display: flex; align-items: center; gap: 14px; }
.btn-back {
  background: rgba(255,255,255,0.1);
  border: none;
  color: white;
  width: 34px; height: 34px;
  border-radius: 8px;
  font-size: 18px;
  cursor: pointer;
  display: none;
  align-items: center;
  justify-content: center;
  transition: background 0.2s;
}
.btn-back:hover { background: rgba(255,255,255,0.2); }
.btn-back.visible { display: flex; }
.logo { display: flex; flex-direction: column; }
.logo-main {
  color: white;
  font-size: 20px;
  font-weight: 800;
  letter-spacing: 1.5px;
  line-height: 1;
}
.logo-sub { color: rgba(255,255,255,0.6); font-size: 10px; font-weight: 500; letter-spacing: 0.3px; }
.header-title { color: white; font-size: 15px; font-weight: 600; }
.header-right { color: rgba(255,255,255,0.7); font-size: 12px; font-weight: 500; }

/* ===== CONTAINER ===== */
.container { max-width: 980px; margin: 0 auto; padding: 20px 16px; }

/* ===== VIEWS ===== */
.view { display: none; }
.view.active { display: block; animation: fadeIn 0.25s ease; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

/* ===== HOME GRID ===== */
.home-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
  gap: 14px;
}
.home-card {
  background: var(--surface);
  border-radius: var(--radius);
  padding: 22px;
  text-align: center;
  border: 1.5px solid var(--border);
  transition: all 0.2s;
  cursor: default;
  box-shadow: var(--shadow-sm);
}
.home-card.clickable { cursor: pointer; }
.home-card.clickable:hover { border-color: var(--att-blue); box-shadow: var(--shadow-md); transform: translateY(-2px); }
.home-card.disabled { opacity: 0.45; pointer-events: none; }
.card-icon { font-size: 30px; margin-bottom: 8px; }
.card-title { font-size: 15px; font-weight: 700; margin-bottom: 6px; }
.card-desc { font-size: 12px; color: var(--text-2); line-height: 1.4; }
.card-stat { font-size: 13px; color: var(--att-blue); font-weight: 700; margin: 6px 0; }
.success-pill {
  display: inline-block;
  background: var(--success-bg);
  color: var(--success);
  font-size: 11px;
  font-weight: 700;
  padding: 3px 10px;
  border-radius: 20px;
  margin-bottom: 6px;
}
.mini-stats { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-top: 8px; }
.mini-stat { font-size: 11px; font-weight: 600; }
.mini-stat.open { color: var(--att-blue); }
.mini-stat.closed { color: var(--success); }
.mini-stat.pending { color: var(--warning); }
.mini-stat.lost { color: var(--danger); }

/* ===== FILE UPLOAD ===== */
.upload-zone {
  border: 2px dashed var(--border);
  border-radius: var(--radius);
  padding: 20px;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s;
  margin-top: 10px;
}
.upload-zone:hover { border-color: var(--att-blue); background: var(--att-light); }
.upload-zone input { display: none; }

/* ===== FORM ELEMENTS ===== */
.form-card {
  background: var(--surface);
  border-radius: var(--radius);
  padding: 24px;
  border: 1px solid var(--border);
  box-shadow: var(--shadow-sm);
  max-width: 420px;
  margin: 0 auto;
}
.section {
  background: var(--surface);
  border-radius: var(--radius);
  padding: 20px;
  margin-bottom: 14px;
  border: 1px solid var(--border);
  box-shadow: var(--shadow-sm);
}
.section-title {
  font-size: 15px;
  font-weight: 700;
  color: var(--att-dark);
  margin-bottom: 14px;
  padding-bottom: 8px;
  border-bottom: 2px solid var(--surface-3);
}
.form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}
.form-group { display: flex; flex-direction: column; gap: 3px; }
.form-group.full { grid-column: 1 / -1; }
label.field-label { font-size: 11px; font-weight: 600; color: var(--text-2); text-transform: uppercase; letter-spacing: 0.3px; }
input.field:invalid:not(:placeholder-shown) { border-color: var(--danger); }
input.field.error { border-color: var(--danger); background: var(--danger-bg); }
input.field, select.field, textarea.field {
  padding: 9px 12px;
  border: 1.5px solid var(--border);
  border-radius: 8px;
  font-size: 14px;
  font-family: inherit;
  color: var(--text);
  background: var(--surface);
  outline: none;
  transition: border 0.2s;
  width: 100%;
}
input.field:focus, select.field:focus { border-color: var(--att-blue); }

/* ===== BUTTONS ===== */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 10px 20px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  font-family: inherit;
  cursor: pointer;
  border: none;
  transition: all 0.2s;
}
.btn-primary { background: linear-gradient(135deg, var(--att-dark), var(--att-blue)); color: white; }
.btn-primary:hover { box-shadow: 0 4px 12px rgba(0,159,219,0.35); transform: translateY(-1px); }
.btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }
.btn-secondary { background: var(--surface); color: var(--att-blue); border: 1.5px solid var(--att-blue); }
.btn-secondary:hover { background: var(--att-light); }
.btn-lg { padding: 14px 28px; font-size: 15px; width: 100%; }
.btn-sm { padding: 6px 12px; font-size: 12px; }
.btn-danger-ghost { background: none; border: none; color: var(--danger); font-size: 18px; cursor: pointer; padding: 4px; }

/* ===== SEARCH ===== */
.search-row { display: flex; gap: 10px; margin-bottom: 12px; }
.search-row input.field { flex: 1; }
.search-row select.field { width: 170px; flex-shrink: 0; }

/* ===== DEVICE CARDS ===== */
.device-list { display: flex; flex-direction: column; gap: 8px; }
.device-card {
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  background: var(--surface);
  transition: border-color 0.2s;
}
.device-card:hover { border-color: var(--att-blue); }
.device-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  cursor: pointer;
  gap: 12px;
}
.device-brand { font-size: 10px; color: var(--text-3); text-transform: uppercase; letter-spacing: 0.6px; font-weight: 600; }
.device-name { font-size: 14px; font-weight: 600; color: var(--text); margin-top: 1px; }
.device-offer {
  display: inline-block;
  font-size: 10px;
  font-weight: 600;
  color: var(--att-blue);
  background: var(--att-light);
  padding: 2px 8px;
  border-radius: 4px;
  margin-top: 3px;
}
.device-price { text-align: right; flex-shrink: 0; }
.device-price-label { font-size: 10px; color: var(--text-3); }
.device-price-val { font-size: 14px; font-weight: 700; }
.expand-icon { font-size: 11px; color: var(--text-3); flex-shrink: 0; transition: transform 0.2s; }
.device-body { padding: 0 16px 16px; border-top: 1px solid var(--surface-3); display: none; }
.device-body.open { display: block; animation: fadeIn 0.2s ease; }
.device-selectors { display: flex; gap: 12px; margin-top: 12px; }
.device-selectors .form-group { flex: 1; }
.device-calc { margin-top: 14px; display: flex; flex-direction: column; gap: 6px; }
.calc-row { display: flex; justify-content: space-between; font-size: 14px; padding: 4px 0; }
.calc-row.total { border-top: 2px solid var(--att-blue); padding-top: 8px; margin-top: 4px; }
.calc-val { font-weight: 700; }
.calc-val.blue { color: var(--att-blue); }
.calc-val.green { color: var(--success); }
.calc-val.big { font-size: 20px; color: var(--att-blue); }
.not-available { color: var(--danger); font-size: 13px; text-align: center; padding: 12px; }
.device-vigencia { font-size: 11px; color: var(--text-3); border-top: 1px solid var(--surface-3); padding-top: 8px; margin-top: 10px; }
.no-results { color: var(--text-3); text-align: center; padding: 24px; font-size: 14px; }

/* ===== ITEMS LIST ===== */
.items-list { display: flex; flex-direction: column; gap: 10px; }
.item-card {
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 14px;
  background: var(--surface-2);
}
.item-top { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
.item-name { font-size: 14px; font-weight: 600; }
.item-plan { font-size: 12px; color: var(--att-blue); font-weight: 500; }
.item-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 6px;
}
.item-detail {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 13px;
  padding: 5px 10px;
  background: var(--surface);
  border-radius: 6px;
}
.item-detail.total-row { grid-column: 1 / -1; border-top: 2px solid var(--att-blue); }
.detail-label { color: var(--text-3); font-size: 11px; }
.item-detail input.field { width: 60px; padding: 4px 6px; font-size: 13px; text-align: center; }

/* ===== HISTORIAL ===== */
.filter-row { display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap; }
.filter-btn {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 8px 14px;
  font-size: 13px;
  font-family: inherit;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
  color: var(--text-2);
  font-weight: 500;
  transition: all 0.2s;
}
.filter-btn:hover { border-color: var(--att-blue); }
.filter-btn.active { background: var(--att-blue); color: white; border-color: var(--att-blue); }
.filter-count {
  background: rgba(0,0,0,0.08);
  border-radius: 10px;
  padding: 1px 7px;
  font-size: 11px;
  font-weight: 700;
}
.filter-btn.active .filter-count { background: rgba(255,255,255,0.25); }
.historial-list { display: flex; flex-direction: column; gap: 8px; }
.historial-card {
  background: var(--surface);
  border-radius: var(--radius);
  padding: 14px 16px;
  cursor: pointer;
  border: 1px solid var(--border);
  transition: all 0.2s;
}
.historial-card:hover { border-color: var(--att-blue); box-shadow: var(--shadow-md); }
.historial-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
.historial-folio { font-size: 13px; font-weight: 700; color: var(--att-dark); font-family: 'JetBrains Mono', monospace; }
.historial-body { display: flex; flex-direction: column; gap: 2px; }
.historial-client { font-size: 14px; font-weight: 600; }
.historial-meta { font-size: 12px; color: var(--text-3); }
.badge {
  display: inline-block;
  font-size: 10px;
  font-weight: 700;
  padding: 3px 10px;
  border-radius: 12px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.badge-enviada { background: var(--att-light); color: var(--att-dark); }
.badge-seguimiento { background: var(--warning-bg); color: var(--warning); }
.badge-venta { background: var(--success-bg); color: var(--success); }
.badge-perdida { background: var(--danger-bg); color: var(--danger); }

/* Dashboard */
.kpi-card { background:white; border-radius:10px; padding:14px; text-align:center; border:1px solid var(--border); }
.kpi-value { font-size:28px; font-weight:800; color:var(--att-blue); line-height:1.1; }
.kpi-label { font-size:11px; color:var(--text-3); margin-top:4px; }
.kpi-sub { font-size:10px; color:var(--text-2); margin-top:2px; }
.funnel-bar { display:flex; align-items:center; margin-bottom:6px; gap:8px; }
.funnel-fill { height:28px; border-radius:6px; display:flex; align-items:center; padding:0 10px; color:white; font-size:11px; font-weight:700; min-width:40px; transition:width .3s; }
.funnel-label { font-size:12px; color:var(--text); min-width:100px; }
.funnel-count { font-size:12px; color:var(--text-2); font-weight:600; }
.breakdown-row { display:flex; justify-content:space-between; align-items:center; padding:6px 0; border-bottom:1px solid var(--border); font-size:12px; }
.breakdown-row:last-child { border-bottom:none; }
.breakdown-bar { height:6px; background:var(--border); border-radius:3px; flex:1; margin:0 8px; overflow:hidden; }
.breakdown-bar-fill { height:100%; border-radius:3px; }
.rank-row { display:flex; align-items:center; gap:8px; padding:8px 0; border-bottom:1px solid var(--border); }
.rank-row:last-child { border-bottom:none; }
.rank-pos { width:24px; height:24px; border-radius:50%; background:var(--att-blue); color:white; font-size:11px; font-weight:700; display:flex; align-items:center; justify-content:center; }
.rank-pos.gold { background:#E6A200; }
.rank-pos.silver { background:#8899AA; }
.rank-pos.bronze { background:#CD7F32; }

/* Cruce de ventas */
.cruce-card { padding:10px 12px; border-radius:8px; border-left:4px solid; margin-bottom:6px; background:white; }
.cruce-card.confirmada { border-color:#0FA958; background:#f0faf4; }
.cruce-card.no-confirmada { border-color:#DC3545; background:#fdf3f4; }
.cruce-badge { display:inline-block; font-size:10px; font-weight:700; padding:2px 8px; border-radius:4px; }
.cruce-badge.ok { background:#0FA958; color:white; }
.cruce-badge.warn { background:#DC3545; color:white; }
.empty-state { text-align: center; padding: 40px 20px; color: var(--text-3); font-size: 14px; }

/* ===== DETALLE ===== */
.detalle-top {
  background: var(--surface);
  border-radius: var(--radius);
  padding: 20px;
  margin-bottom: 14px;
  display: flex;
  justify-content: space-between;
  gap: 20px;
  flex-wrap: wrap;
  border: 1px solid var(--border);
  box-shadow: var(--shadow-sm);
}
.detalle-info h3 { font-size: 18px; margin-bottom: 4px; }
.detalle-meta { font-size: 13px; color: var(--text-2); margin: 3px 0; }
.detalle-actions { display: flex; flex-direction: column; gap: 10px; align-items: flex-end; }
.estatus-row { display: flex; align-items: center; gap: 8px; }
.detalle-item { padding: 12px 0; border-bottom: 1px solid var(--surface-3); }
.detalle-item:last-child { border-bottom: none; }
.detalle-item-name { font-weight: 600; font-size: 14px; margin-bottom: 4px; }
.detalle-item-grid { display: flex; gap: 16px; flex-wrap: wrap; font-size: 13px; color: var(--text-2); }

/* ===== RESPONSIVE ===== */
@media (max-width: 600px) {
  .form-grid { grid-template-columns: 1fr; }
  .search-row { flex-direction: column; }
  .search-row select.field { width: 100%; }
  .device-selectors { flex-direction: column; }
  .detalle-top { flex-direction: column; }
  .detalle-actions { align-items: stretch; }
  .item-grid { grid-template-columns: 1fr; }
  .home-grid { grid-template-columns: 1fr 1fr; }
  .header-title { display: none; }
  #dashKpis { grid-template-columns: repeat(3, 1fr) !important; }
  #viewDashboard .section div[style*="grid-template-columns:1fr 1fr"] { grid-template-columns: 1fr !important; }
}
@media (max-width: 400px) {
  .home-grid { grid-template-columns: 1fr; }
}
</style>
</head>
<body>

<!-- CDN Error Banner -->
<div id="cdnError" style="display:none;background:#DC3545;color:white;padding:12px 20px;text-align:center;font-family:sans-serif;font-size:14px;position:fixed;top:0;left:0;right:0;z-index:9999">
  ‚ö†Ô∏è No se pudieron cargar las librer√≠as. Tu red podr√≠a estar bloqueando CDNs externos. Intenta conectarte a otra red (ej: datos m√≥viles / hotspot).
</div>

<!-- ===== LOGIN SCREEN ===== -->
<div id="loginScreen" style="display:flex;align-items:center;justify-content:center;min-height:100vh;background:linear-gradient(135deg,#001A2F 0%,#00395D 50%,#009FDB 100%)">
  <div style="background:white;border-radius:16px;padding:32px;width:320px;box-shadow:0 20px 60px rgba(0,0,0,0.3);text-align:center">
    <div style="font-size:28px;font-weight:800;color:#00395D;margin-bottom:2px">AT&T</div>
    <div style="font-size:11px;color:#009FDB;font-weight:700;letter-spacing:1px;margin-bottom:4px">EXPERTCELL</div>
    <div style="font-size:10px;color:#8899AA;margin-bottom:20px">Cotizador Premium</div>
    <div style="margin-bottom:12px;text-align:left">
      <label style="font-size:11px;font-weight:600;color:#4A5F78;display:block;margin-bottom:4px">ATTUID</label>
      <input id="loginAttuid" class="field" placeholder="Ej: JT2908" style="text-transform:uppercase;width:100%;box-sizing:border-box" autocomplete="off">
    </div>
    <div style="margin-bottom:16px;text-align:left">
      <label style="font-size:11px;font-weight:600;color:#4A5F78;display:block;margin-bottom:4px">PIN (4 d√≠gitos)</label>
      <input id="loginPin" class="field" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="4" inputmode="numeric" style="width:100%;box-sizing:border-box;letter-spacing:8px;text-align:center;font-size:18px" autocomplete="off">
    </div>
    <button class="btn btn-primary btn-lg" style="width:100%" onclick="doLogin()" id="btnLogin">Iniciar Sesi√≥n</button>
    <div id="loginError" style="margin-top:10px;font-size:12px;color:#DC3545;display:none"></div>
    <div style="margin-top:16px;font-size:9px;color:#8899AA">Distribuidor Autorizado AT&T</div>
  </div>
</div>

<!-- ===== APP (hidden until login) ===== -->
<div id="appContainer" style="display:none">

<!-- ===== HEADER ===== -->
<div class="header">
  <div class="header-left">
    <button class="btn-back" id="btnBack" onclick="goBack()">‚Üê</button>
    <div class="logo">
      <span class="logo-main">AT&T</span>
      <span class="logo-sub">Cotizador ExpertCell</span>
    </div>
  </div>
  <span class="header-title" id="headerTitle"></span>
  <span class="header-right" id="headerAgent"></span>
  <button onclick="doLogout()" style="background:none;border:1px solid #DDE4ED;color:#8899AA;font-size:10px;padding:4px 10px;border-radius:6px;cursor:pointer;margin-left:8px" title="Cerrar sesi√≥n">Salir</button>
</div>

<!-- ===== VIEW: HOME ===== -->
<div class="view active" id="viewHome">
  <div class="container">
    <div id="homeAlerts" style="display:none;margin-bottom:10px"></div>
    <div class="home-grid">
      <div class="home-card" id="cardUpload">
        <div class="card-icon">üìã</div>
        <div class="card-title">Lista de Precios</div>
        <div id="uploadStatus">
          <div class="card-desc">Sube la lista de precios AT&T (.xlsm)</div>
          <div class="upload-zone" onclick="document.getElementById('fileInput').click()">
            <div style="font-size:24px;margin-bottom:4px">üìÅ</div>
            <div style="font-size:12px;color:var(--text-3)">Click para seleccionar archivo</div>
            <input type="file" id="fileInput" accept=".xlsx,.xlsm" onchange="handleFileUpload(event)">
          </div>
        </div>
      </div>

      <div class="home-card disabled" id="cardCotizar" onclick="showView('cotizar')">
        <div class="card-icon">üìù</div>
        <div class="card-title">Nueva Cotizaci√≥n</div>
        <div class="card-desc" id="cotizarDesc">Primero sube la lista de precios</div>
      </div>

      <div class="home-card clickable" id="cardHistorial" onclick="showView('historial')">
        <div class="card-icon">üìä</div>
        <div class="card-title">Historial</div>
        <div class="card-stat" id="historialCount">0 cotizaciones</div>
        <div class="mini-stats" id="historialMiniStats"></div>
      </div>

      <div class="home-card clickable" onclick="showView('config')">
        <div class="card-icon">‚öôÔ∏è</div>
        <div class="card-title">Mi Perfil</div>
        <div class="card-desc" id="configDesc">Configurar datos del ejecutivo</div>
      </div>

      <div class="home-card clickable" id="cardAdmin" style="display:none" onclick="openAdmin()">
        <div class="card-icon">üë•</div>
        <div class="card-title">Admin Usuarios</div>
        <div class="card-desc" id="adminDesc">Gestionar equipo</div>
      </div>

      <div class="home-card clickable" id="cardDashboard" style="display:none" onclick="openDashboard()">
        <div class="card-icon">üìà</div>
        <div class="card-title">Dashboard</div>
        <div class="card-desc" id="dashboardDesc">M√©tricas y conversi√≥n</div>
      </div>

      <div class="home-card clickable" id="cardRecuperacion" style="display:none" onclick="openRecuperacion()">
        <div class="card-icon">üîÑ</div>
        <div class="card-title">Recuperaci√≥n</div>
        <div class="card-desc" id="recupDesc">Cotizaciones por reasignar</div>
      </div>
    </div>
  </div>
</div>

<!-- ===== VIEW: CONFIG ===== -->
<div class="view" id="viewConfig">
  <div class="container">
    <div class="form-card">
      <div class="form-group" style="margin-bottom:12px">
        <label class="field-label">Nombre completo</label>
        <input class="field" id="cfgNombre" placeholder="Ej: Jonathan Tenorio Del Aguila">
      </div>
      <div class="form-group" style="margin-bottom:12px">
        <label class="field-label">ATTUID</label>
        <input class="field" id="cfgAttuid" placeholder="Ej: JT2908" style="text-transform:uppercase">
      </div>
      <div class="form-group" style="margin-bottom:16px">
        <label class="field-label">WhatsApp (10 d√≠gitos)</label>
        <input class="field" id="cfgWhatsapp" placeholder="Ej: 5512345678" maxlength="10" inputmode="numeric">
      </div>
      <button class="btn btn-primary btn-lg" onclick="saveConfig()">Guardar</button>
    </div>
  </div>
</div>

<!-- ===== VIEW: COTIZAR ===== -->
<div class="view" id="viewCotizar">
  <div class="container">
    <!-- Client Data -->
    <div class="section">
      <div class="section-title">Datos del Cliente</div>
      <div class="form-grid">
        <div class="form-group">
          <label class="field-label">Nombre completo *</label>
          <input class="field" id="cliNombre" placeholder="Nombre del cliente" required>
        </div>
        <div class="form-group">
          <label class="field-label">Tel√©fono (10 d√≠gitos) *</label>
          <input class="field" id="cliTelefono" placeholder="10 d√≠gitos" maxlength="10" pattern="[0-9]{10}" inputmode="numeric"
            oninput="this.value=this.value.replace(/[^0-9]/g,'').slice(0,10); validatePhone(this)">
          <span class="field-hint" id="phoneHint" style="display:none;font-size:11px;color:var(--danger)">Debe ser exactamente 10 d√≠gitos</span>
        </div>
        <div class="form-group">
          <label class="field-label">Email *</label>
          <input class="field" id="cliEmail" placeholder="correo@ejemplo.com" type="email" required>
        </div>
        <div class="form-group">
          <label class="field-label">D√≠as de validez</label>
          <select class="field" id="cliValidez">
            <option value="3">3 d√≠as</option>
            <option value="5">5 d√≠as</option>
            <option value="7" selected>7 d√≠as</option>
            <option value="15">15 d√≠as</option>
            <option value="30">30 d√≠as</option>
          </select>
        </div>
        <div class="form-group full">
          <label class="field-label">Direcci√≥n *</label>
          <input class="field" id="cliDireccion" placeholder="Calle, colonia, municipio, estado" required>
        </div>
        <div class="form-group full">
          <label class="field-label">Plan actual del cliente (opcional - para comparativa)</label>
          <select class="field" id="cliPlanActual">
            <option value="">Sin plan actual / No aplica</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Search -->
    <div class="section">
      <div class="section-title">Buscar Equipo</div>
      <div class="search-row">
        <input class="field" id="searchInput" placeholder="Buscar equipo (ej: iPhone 17, Samsung S25...)" oninput="searchDevices()">
        <select class="field" id="searchFilter" onchange="searchDevices()">
          <option value="all">Todas las ofertas</option>
          <option value="premium">AT&T Premium</option>
          <option value="titanio">AT&T Titanio</option>
        </select>
      </div>
      <div id="deviceResults"></div>
    </div>

    <!-- Selected Items -->
    <div class="section" id="itemsSection" style="display:none">
      <div class="section-title" id="itemsTitle">Equipos en Cotizaci√≥n (0)</div>
      <div class="items-list" id="itemsList"></div>
      <div style="margin-top:14px;padding:14px;background:linear-gradient(135deg,#f0f7ff,#e8f4fd);border-radius:12px;border:1.5px solid #c8e0f4">
        <label class="field-label" style="margin-bottom:8px;display:block;color:var(--att-blue);font-weight:700">üé® Dise√±o de Cotizaci√≥n</label>
        <div style="display:flex;gap:10px">
          <label style="flex:1;cursor:pointer;padding:12px;border-radius:10px;border:2px solid #d1d9e0;background:white;text-align:center;transition:all 0.2s" id="tplCard1" onclick="selectTemplate('classic')">
            <div style="font-size:22px;margin-bottom:4px">üìã</div>
            <div style="font-size:12px;font-weight:700;color:var(--text-1)">Cl√°sico</div>
            <div style="font-size:10px;color:var(--text-3)">Formato institucional</div>
          </label>
          <label style="flex:1;cursor:pointer;padding:12px;border-radius:10px;border:2px solid #d1d9e0;background:white;text-align:center;transition:all 0.2s" id="tplCard2" onclick="selectTemplate('premium')">
            <div style="font-size:22px;margin-bottom:4px">‚ú®</div>
            <div style="font-size:12px;font-weight:700;color:var(--text-1)">Premium</div>
            <div style="font-size:10px;color:var(--text-3)">Dise√±o ejecutivo</div>
          </label>
        </div>
        <input type="hidden" id="pdfTemplate" value="classic">
      </div>
      <button class="btn btn-primary btn-lg" style="margin-top:16px" id="btnGenerar" onclick="generarCotizacion()">
        üìÑ Generar Cotizaci√≥n PDF
      </button>
    </div>
  </div>
</div>

<!-- ===== VIEW: HISTORIAL ===== -->
<div class="view" id="viewHistorial">
  <div class="container">
    <div class="section" style="padding:14px;margin-bottom:8px">
      <input class="field" id="historialSearch" placeholder="üîç Buscar por nombre, tel√©fono o folio..." oninput="renderHistorial()" style="width:100%;margin-bottom:8px">
      <div id="historialRoleFilters" style="display:none;gap:6px;flex-wrap:wrap">
        <select class="field" id="hFilterCentro" onchange="onHFilterCentroChange()" style="width:auto;min-width:120px;font-size:12px;padding:6px 8px">
          <option value="all">Todos los centros</option>
        </select>
        <select class="field" id="hFilterCoord" onchange="onHFilterCoordChange()" style="width:auto;min-width:140px;font-size:12px;padding:6px 8px">
          <option value="all">Todos los coordinadores</option>
        </select>
        <select class="field" id="hFilterSup" onchange="onHFilterSupChange()" style="width:auto;min-width:140px;font-size:12px;padding:6px 8px">
          <option value="all">Todos los supervisores</option>
        </select>
        <select class="field" id="hFilterAgente" onchange="renderHistorial()" style="width:auto;min-width:140px;font-size:12px;padding:6px 8px">
          <option value="all">Todos los agentes</option>
        </select>
      </div>
    </div>
    <div class="filter-row" id="filterRow"></div>
    <div id="historialList"></div>
  </div>
</div>

<!-- ===== VIEW: DETALLE ===== -->
<div class="view" id="viewDetalle">
  <div class="container" id="detalleContent"></div>
</div>

<!-- ===== VIEW: ADMIN ===== -->
<div class="view" id="viewAdmin">
  <div class="container">
    <div class="section">
      <div class="section-title">Administrar Usuarios</div>
      <div style="display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap">
        <button class="btn btn-primary" onclick="showAddUserForm()">+ Nuevo Usuario</button>
        <label class="btn btn-secondary" style="cursor:pointer">
          üìÅ Carga masiva
          <input type="file" accept=".xlsx,.xls" onchange="cargaMasivaUsuarios(this)" style="display:none">
        </label>
        <button class="btn btn-secondary" onclick="descargarPlantillaUsuarios()">üìã Plantilla</button>
        <select class="field" id="adminFilterRol" onchange="renderAdminUsers()" style="width:auto">
          <option value="all">Todos los roles</option>
          <option value="coordinador">Coordinadores</option>
          <option value="supervisor">Supervisores</option>
          <option value="agente">Agentes</option>
        </select>
        <select class="field" id="adminFilterCentro" onchange="renderAdminUsers()" style="width:auto">
          <option value="all">Todos los centros</option>
        </select>
        <select class="field" id="adminFilterEstatus" onchange="renderAdminUsers()" style="width:auto">
          <option value="activos">Activos</option>
          <option value="baja">Baja</option>
          <option value="all">Todos</option>
        </select>
      </div>
      <div id="addUserForm" style="display:none;background:var(--surface-2);padding:16px;border-radius:10px;margin-bottom:12px">
        <div style="font-weight:700;margin-bottom:10px;color:var(--att-blue)">Nuevo Usuario</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
          <div>
            <label class="field-label">Nombre completo *</label>
            <input class="field" id="newUserNombre" placeholder="Nombre completo">
          </div>
          <div>
            <label class="field-label">ATTUID *</label>
            <input class="field" id="newUserAttuid" placeholder="Ej: AB1234" style="text-transform:uppercase">
          </div>
          <div>
            <label class="field-label">PIN (4 d√≠gitos) *</label>
            <input class="field" id="newUserPin" placeholder="1234" maxlength="4" inputmode="numeric">
          </div>
          <div>
            <label class="field-label">Rol *</label>
            <select class="field" id="newUserRol" onchange="updateNewUserOptions()">
              <option value="">Selecciona...</option>
              <option value="coordinador">Coordinador</option>
              <option value="supervisor">Supervisor</option>
              <option value="agente">Agente</option>
            </select>
          </div>
          <div>
            <label class="field-label">Centro *</label>
            <select class="field" id="newUserCentro"></select>
          </div>
          <div id="newUserSupervisorDiv" style="display:none">
            <label class="field-label">Supervisor</label>
            <select class="field" id="newUserSupervisor"></select>
          </div>
          <div id="newUserCoordinadorDiv" style="display:none">
            <label class="field-label">Coordinador</label>
            <select class="field" id="newUserCoordinador"></select>
          </div>
          <div>
            <label class="field-label">WhatsApp</label>
            <input class="field" id="newUserWhatsapp" placeholder="5512345678" maxlength="10">
          </div>
        </div>
        <div style="display:flex;gap:8px;margin-top:12px">
          <button class="btn btn-primary" onclick="saveNewUser()">Guardar</button>
          <button class="btn btn-secondary" onclick="document.getElementById('addUserForm').style.display='none'">Cancelar</button>
        </div>
        <div id="newUserError" style="color:var(--danger);font-size:12px;margin-top:8px;display:none"></div>
      </div>
      <div id="adminUsersList"></div>
    </div>
  </div>
</div>

<!-- ===== VIEW: DASHBOARD ===== -->
<div class="view" id="viewDashboard">
  <div class="container">
    <div class="section" style="padding:14px;margin-bottom:8px">
      <div style="display:flex;gap:6px;flex-wrap:wrap;align-items:center">
        <select class="field" id="dashFilterCentro" onchange="onDashFilterChange()" style="width:auto;font-size:12px;padding:6px 8px">
          <option value="all">Todos los centros</option>
        </select>
        <select class="field" id="dashFilterCoord" onchange="onDashFilterChange()" style="width:auto;font-size:12px;padding:6px 8px">
          <option value="all">Todos los coordinadores</option>
        </select>
        <select class="field" id="dashFilterSup" onchange="onDashFilterChange()" style="width:auto;font-size:12px;padding:6px 8px">
          <option value="all">Todos los supervisores</option>
        </select>
        <select class="field" id="dashFilterAgente" onchange="renderDashboard()" style="width:auto;font-size:12px;padding:6px 8px">
          <option value="all">Todos los agentes</option>
        </select>
        <select class="field" id="dashFilterPeriodo" onchange="onDashPeriodoChange()" style="width:auto;font-size:12px;padding:6px 8px">
          <option value="all">Todo el tiempo</option>
          <option value="hoy">Hoy</option>
          <option value="semana">√öltima semana</option>
          <option value="mes" selected>Este mes</option>
          <option value="mes_anterior">Mes anterior</option>
          <option value="ene">Enero</option>
          <option value="feb">Febrero</option>
          <option value="mar">Marzo</option>
          <option value="abr">Abril</option>
          <option value="may">Mayo</option>
          <option value="jun">Junio</option>
          <option value="jul">Julio</option>
          <option value="ago">Agosto</option>
          <option value="sep">Septiembre</option>
          <option value="oct">Octubre</option>
          <option value="nov">Noviembre</option>
          <option value="dic">Diciembre</option>
          <option value="rango">Rango personalizado...</option>
        </select>
        <div id="dashRangoFechas" style="display:none;gap:4px;align-items:center">
          <input type="date" class="field" id="dashFechaDesde" style="width:auto;font-size:12px;padding:5px 8px" onchange="renderDashboard()">
          <span style="font-size:11px;color:var(--text-3)">a</span>
          <input type="date" class="field" id="dashFechaHasta" style="width:auto;font-size:12px;padding:5px 8px" onchange="renderDashboard()">
        </div>
        <button class="btn btn-secondary" style="font-size:11px;padding:6px 10px" onclick="exportDashExcel()">üìä Exportar Excel</button>
        <button class="btn btn-secondary" style="font-size:11px;padding:6px 10px" onclick="exportDashPDF()">üìÑ Exportar PDF</button>
      </div>
    </div>

    <!-- KPI Cards -->
    <div id="dashKpis" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:8px;margin-bottom:12px"></div>

    <!-- Conversion Funnel -->
    <div class="section" style="padding:14px;margin-bottom:8px">
      <div class="section-title">Embudo de Conversi√≥n</div>
      <div id="dashFunnel" style="margin-top:8px"></div>
    </div>

    <!-- Estatus Breakdown -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px">
      <div class="section" style="padding:14px">
        <div class="section-title">Motivos de P√©rdida</div>
        <div id="dashPerdidas" style="margin-top:8px"></div>
      </div>
      <div class="section" style="padding:14px">
        <div class="section-title">Seguimiento Pendiente</div>
        <div id="dashSeguimiento" style="margin-top:8px"></div>
      </div>
    </div>

    <!-- Top Agents -->
    <div class="section" style="padding:14px;margin-bottom:8px">
      <div class="section-title">Ranking de Agentes</div>
      <div id="dashRanking" style="margin-top:8px"></div>
    </div>

    <!-- Cruce de Ventas -->
    <div class="section" style="padding:14px;margin-bottom:8px" id="cruceSection">
      <div class="section-title">Cruce de Ventas</div>
      <p style="font-size:12px;color:var(--text-3);margin:6px 0 10px">Sube el archivo de ventas de AT&T (.xlsx) para validar las cotizaciones marcadas como "Venta Exitosa".</p>
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
        <label class="btn btn-primary" style="cursor:pointer;font-size:12px">
          üìÅ Subir archivo de ventas
          <input type="file" id="cruceFile" accept=".xlsx,.xls" onchange="procesarCruceVentas(this)" style="display:none">
        </label>
        <span id="cruceFileName" style="font-size:11px;color:var(--text-3)"></span>
      </div>
      <div id="cruceColumnConfig" style="display:none;margin-top:12px;background:var(--surface-2);padding:12px;border-radius:8px">
        <div style="font-weight:700;font-size:12px;margin-bottom:8px;color:var(--att-blue)">Mapea las columnas del archivo:</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
          <div>
            <label class="field-label">Columna de Tel√©fono</label>
            <select class="field" id="cruceColTelefono" style="font-size:12px"></select>
          </div>
          <div>
            <label class="field-label">Columna de Folio AT&T</label>
            <select class="field" id="cruceColFolio" style="font-size:12px"></select>
          </div>
        </div>
        <button class="btn btn-primary" style="margin-top:10px;font-size:12px" onclick="ejecutarCruce()">üîç Ejecutar Cruce</button>
      </div>
      <div id="cruceResults" style="margin-top:12px"></div>
    </div>
  </div>
</div>

<!-- ===== VIEW: RECUPERACI√ìN ===== -->
<div class="view" id="viewRecuperacion">
  <div class="container">
    <div class="section" style="padding:14px;margin-bottom:8px">
      <div class="section-title">Cotizaciones por Reasignar</div>
      <p style="font-size:12px;color:var(--text-3);margin:4px 0 10px">Cotizaciones de agentes dados de baja que a√∫n pueden convertirse en ventas.</p>
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:10px">
        <label class="field-label" style="margin:0">Reasignar a:</label>
        <select class="field" id="recupAgente" style="width:auto;min-width:200px;font-size:12px"></select>
        <button class="btn btn-primary" style="font-size:12px" onclick="reasignarSeleccionadas()">Reasignar seleccionadas</button>
        <button class="btn btn-secondary" style="font-size:12px" onclick="seleccionarTodasRecup()">Seleccionar todas</button>
      </div>
      <div id="recupList"></div>
    </div>
  </div>
</div>

</div> <!-- end appContainer -->

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.49.4/dist/umd/supabase.min.js"></script>
<script>window._sb1 = typeof supabase !== 'undefined' ? supabase : null;</script>
<script src="https://unpkg.com/@supabase/supabase-js@2.49.4/dist/umd/supabase.min.js"></script>
<script>window._sb2 = typeof supabase !== 'undefined' ? supabase : null;</script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.0/dist/umd/supabase.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.2/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>

<script>
// ============================================================
// SUPABASE CONNECTION
// ============================================================
var SUPABASE_URL = 'https://smytiyjzmzbmcllivxkc.supabase.co';
var SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNteXRpeWp6bXpibWNsbGl2eGtjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4MTIwNzQsImV4cCI6MjA4NzM4ODA3NH0.KScWdne5ItM-iXtdKWuy75lXUUORJqmwRzp7z0W7OMo';
var supabase = null;
var currentUser = null;

function initSupabase() {
  try {
    var sbLib = window.supabase || window._sb1 || window._sb2;
    if (sbLib && sbLib.createClient) {
      supabase = sbLib.createClient(SUPABASE_URL, SUPABASE_KEY);
      console.log('Supabase connected OK');
      return true;
    }
    console.log('Supabase SDK not found yet. window.supabase=' + typeof window.supabase);
  } catch(e) { console.error('Supabase init error:', e); }
  return false;
}

// Try immediately and retry
initSupabase();
setTimeout(function() { if (!supabase) { initSupabase(); } }, 500);
setTimeout(function() { if (!supabase) { initSupabase(); } }, 1500);
setTimeout(function() { if (!supabase) { initSupabase(); } }, 3000);
setTimeout(function() { if (!supabase) { initSupabase(); console.log('Final supabase status:', !!supabase); } }, 5000);

async function doLogin() {
  var attuid = document.getElementById('loginAttuid').value.trim().toUpperCase();
  var pin = document.getElementById('loginPin').value.trim();
  var errEl = document.getElementById('loginError');
  var btn = document.getElementById('btnLogin');

  if (!attuid || !pin) {
    errEl.textContent = 'Ingresa tu ATTUID y PIN.';
    errEl.style.display = 'block';
    return;
  }

  btn.disabled = true;
  btn.textContent = 'Verificando...';
  errEl.style.display = 'none';

  try {
    if (!supabase) {
      initSupabase();
    }
    if (!supabase) {
      errEl.textContent = 'Cargando conexi√≥n... Intenta de nuevo en 3 segundos.';
      errEl.style.display = 'block';
      btn.disabled = false;
      btn.textContent = 'Iniciar Sesi√≥n';
      return;
    }

    var { data, error } = await supabase
      .from('usuarios')
      .select('*')
      .eq('attuid', attuid)
      .eq('pin', pin)
      .eq('activo', true)
      .single();

    if (error || !data) {
      errEl.textContent = 'ATTUID o PIN incorrectos.';
      errEl.style.display = 'block';
      btn.disabled = false;
      btn.textContent = 'Iniciar Sesi√≥n';
      return;
    }

    currentUser = data;
    localStorage.setItem('cotizador_session', JSON.stringify({ attuid: data.attuid, pin: data.pin }));

    // Set agent info in the cotizador state
    state.agente = {
      nombre: data.nombre,
      attuid: data.attuid,
      whatsapp: data.whatsapp || '',
      id: data.id,
      rol: data.rol,
      centro_id: data.centro_id,
      supervisor_id: data.supervisor_id,
      coordinador_id: data.coordinador_id,
    };
    saveState();

    // Show app, hide login
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('appContainer').style.display = 'block';
    await loadCotizacionesFromSupabase();
    updateHome();

  } catch(e) {
    errEl.textContent = 'Error de conexi√≥n. Intenta de nuevo.';
    errEl.style.display = 'block';
    console.error(e);
  }

  btn.disabled = false;
  btn.textContent = 'Iniciar Sesi√≥n';
}

// Auto-login from saved session
async function tryAutoLogin() {
  try {
    var saved = localStorage.getItem('cotizador_session');
    if (!saved) return;
    var sess = JSON.parse(saved);
    if (!sess.attuid || !sess.pin) return;

    var { data, error } = await supabase
      .from('usuarios')
      .select('*')
      .eq('attuid', sess.attuid)
      .eq('pin', sess.pin)
      .eq('activo', true)
      .single();

    if (!error && data) {
      currentUser = data;
      state.agente = {
        nombre: data.nombre,
        attuid: data.attuid,
        whatsapp: data.whatsapp || '',
        id: data.id,
        rol: data.rol,
        centro_id: data.centro_id,
        supervisor_id: data.supervisor_id,
        coordinador_id: data.coordinador_id,
      };
      saveState();
      document.getElementById('loginScreen').style.display = 'none';
      document.getElementById('appContainer').style.display = 'block';
      await loadCotizacionesFromSupabase();
      updateHome();
    }
  } catch(e) { console.error('Auto-login error:', e); }
}

// Allow Enter key in PIN field
document.getElementById('loginPin').addEventListener('keydown', function(e) {
  if (e.key === 'Enter') doLogin();
});
document.getElementById('loginAttuid').addEventListener('keydown', function(e) {
  if (e.key === 'Enter') document.getElementById('loginPin').focus();
});

function doLogout() {
  currentUser = null;
  localStorage.removeItem('cotizador_session');
  document.getElementById('appContainer').style.display = 'none';
  document.getElementById('loginScreen').style.display = 'flex';
  document.getElementById('loginAttuid').value = '';
  document.getElementById('loginPin').value = '';
}

var pdfReady = false;

// Check if libs loaded from jsdelivr
if (window.jspdf && window.jspdf.jsPDF) {
  pdfReady = true;
  console.log('PDF libs ready from jsdelivr');
}

// If not, try unpkg
if (!pdfReady) {
  console.log('jsdelivr failed, trying unpkg...');
  function tryUnpkg() {
    var scripts = [
      'https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js',
      'https://unpkg.com/jspdf@2.5.2/dist/jspdf.umd.min.js',
      'https://unpkg.com/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js'
    ];
    var idx = 0;
    function loadNext() {
      if (idx >= scripts.length) {
        if (window.jspdf && window.jspdf.jsPDF) {
          pdfReady = true;
          console.log('PDF libs ready from unpkg');
        } else {
          console.error('ALL CDNs FAILED - check network');
          document.getElementById('cdnError').style.display = 'block';
        }
        return;
      }
      var s = document.createElement('script');
      s.src = scripts[idx];
      s.onload = function() { idx++; loadNext(); };
      s.onerror = function() {
        console.error('Failed: ' + scripts[idx]);
        // Try cdnjs as last resort
        var alt = scripts[idx].replace('unpkg.com/xlsx@0.18.5/dist','cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5')
          .replace('unpkg.com/jspdf@2.5.2/dist','cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.2')
          .replace('unpkg.com/jspdf-autotable@3.8.2/dist','cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2');
        var s2 = document.createElement('script');
        s2.src = alt;
        s2.onload = function() { idx++; loadNext(); };
        s2.onerror = function() { 
          console.error('ALL sources failed for: ' + scripts[idx]);
          document.getElementById('cdnError').style.display = 'block';
        };
        document.head.appendChild(s2);
      };
      document.head.appendChild(s);
    }
    loadNext();
  }
  tryUnpkg();
}


// ============================================================
// LOGOS (base64 embedded)
// ============================================================
var ATT_LOGO_B64 = 'data:image/png;base64,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/pXutIaPfvSjW7ZscdjgXJmHcPNMa+3U+NwpavOo//M///OuXbuEEINus9baXXnkUw6bhYMWyv3dn3N9S+zu7KbRCQAwANx333379+8X882B6oY4z3PP83bt2nX33Xc7qAqFgpMn52r1TXJ/oPsulZsxTo0PwtC/eV+5DX6lP+iPPPLIjTfe6KZI34Pzff+d73znzTfffNddd3384x9fvXq1g81NRyHE3r17b7vttv4kc3eL47jv8Q2qHNeffvf6c0gp1Z8x/ev7nTfGAEC1WvX952Bb6WN5fjCzUqrVat18881Od/XRcoNFc4dcsBDiC1/4wgUXXDAoFi972cs++tGPOk/4MKiIKIqijRs33nDDDWmaOmF1OuA973nPyMiIM7T9u/m+7zTn0NCQlNJNizvvvHP37t2uY57nOSn8p3/6p7e+9a3uWxdccMGb3vSmN7zhDT/72c/cBb7vp2l62223/eEf/qHv+32Rvfzyyz/ykY80Go0wDJMkQUQX2TuogiC48cYbf/jDHzp5dYguW7bsmmuuqVarbla50XA2IssyKeW6devGxsbg2a9SPHbulXP3N27cuHz5cjdz3XCcc845l156qeu3kz8AOOussyYnJw/zUZ+6fe1rX1uwYIHT+b7vI2K5XJ6YmHhap8/phve///3On5JSOh/4wgsv7F/T18+f+tSngiBQSvU9tauvvrrVav1cXf3Qhz7UHwH34uedd97+/fuPQwhzDFW0Q+573/ve+Pi4ezene6+66qqPf/zjfSF2qmnr1q133nnnoHeT5/lhLqtr1lo3vq1WK01TN0e11m729L+SJEm9Xj+qC4qIrVarXq/39YETtVe/+tWDNtvp7VWrVi1dutRa24+a8jzP83xQqfY96iOBdx1otVrOavSFvtlszs7OPrWT/IJONjicWq3Wrbfe6kZfCOF8mXXr1p199tlDQ0P9MUJErfXPfvazXq/X94yca9of68HIyslTf8T7rsrgZU7xHvbdvrpzv3VguH84p3pQH7reSinHx8edY+guC4LAifJhPpTneeVy+cgOI6LjK/p22pltfLr2ggbYzdNbbrnlwQcfHOShzjjjjEsuucRa+3u/93uOzOr7RDfccMOePXv6ttkFo0e9eRzH1tp2u+1Goc9aOFeob3dLh+5v2++YtbZUKq1evdrh5Fw5APj617/edwtc34wx3/jGN3q93mDuYWRkxO2I7D7sdDpOkQzK9FG5i8GR8X3/OfGhnk8v2hhz5513zszMeJ7npq0Q4uyzz166dKmU8g1veIMTxL5Hum/fvttvv70/BE/rOrgY7D/ByzstvXDhwv4QO+SmpqZcwOZumCTJBz7wgeuuu67ff611tVp99atfPRjqFAqF/kR8arEbdLD7iY1jnaoSx04/NxqNL3/5y84zdKFCpVL5zd/8Ted/rl+//uqrr3aZBudvdzqdG2+8cXZ2tq+lnyEN2XeYn8lgOVVJROeee+7o6Gg/znb686//+q+vv/76brd7xx13XHvttX/7t3/rcHWOLiKeccYZV1555WEh2dM+19n4w4aory1OPIDdC991110HDhxwJtOxB0uWLFm3bp17vSiK3Ej1hxgANm3a9NBDDz0tVA4kd1t38TMfpr4hX7169Zve9CYXJvXV+/T09Ac/+ME//dM/fetb33r99de7p3ie5xKdQRD8zd/8zejo6DNUM4fN+MOk+UjUTySAmfkjH/mIy4048RVCXHrppUuWLOlfdsUVV5xyyinOBDqVtW3btp07d7rfpmna6XSOnON99ehyuod9+LTi22w2jTETExNa6w984ANjY2PGmD6NLIR47LHHPv3pT2/fvt3dv89mEJEL1hHRla/22ZWn9Xsdlkemn09IgN2r7t69+5577nGi5miHIAguueQS5x+56X/66aefeeaZzOycTOf+fPOb33ROjZTSsZVPBlvfhP9cM69QKAghKpUKABSLxe985zvOA3LD7aaju7Mxxvd9a22e5ytWrLjzzjt/+7d/20Hl0O3Pqqf1ewcleDC4OlEBRsSvfe1rfYLXtbVr1zomoU+6+r5/2WWX+b7v3j/P8ziOv/Wtb+3evRsAut1un+R76lH7uaJGpVSWZVprl5PeunXrueee6+acI0z61tFllBctWvRHf/RHt91224UXXtiPhkdHRz3Pm5mZ2bt3b6/X63Q63W7XJYOf2oseLAY6PgCr5xxdp11vvPHGQc3JzJdffvmKFSscTejgdKTH8uXLt2/f7qIjF2985Stf+V//63+5/PGRYtFXjFrrQab+GcLMzGEYIuL4+PjHPvaxj33sY47jdPD0FUkQBFmWAcA111zzd3/3dw5v9zj3oE996lPf+973nI5xE2LdunWOHTuy24Mhe/8f6vhspHUs6Mk77rhjxYoVh2VLNmzYMEjx5HmeJEmr1br22mv7kYlT3QsXLnzaBLPW+pOf/GR/EjhKpFgs7t69+0jyyz1r8Os/+clPLr300n7C2HnIURS5XHW/HsHRMj/+8Y/7lJP7+7777qvVDt8y681vfnN/BA5jsj7wgQ/0Bde94/r1611Xn2W693hTlW4u33PPPXv27HED56RqbGzMFTf1H+x5nuMirrrqqr675L4+MTFx6623PrWV6ueLBstfnsyzzbLM2fWZmRlEvPfee9/+9rffdtttTkv3eZgkSVzY5rK/LnjbtGnTH/zBH9x///39nFKSJNddd12z2fR9PwxDx1Qrpf7hH/5hMOV8JO1zWHB14tlgx/7U6/XvfOc7fVvr3u29731vEASH+SPuV5dccsnJJ5/sxro/wa+77rqnLlXsU//PpBUKhWq1yszlcrnRaLzrXe/avHlzEARufrgwaWxs7F//9V/vuOMOFyU7YtU5gDt37rz88stvvvlmJ+7XX3/9V7/6VSeseZ47KvvDH/7wyMjIU8/7vvMBx7GJ51bbI+IjjzziYlkXpzrAzjvvPOeS7N69e3Z2dteuXZOTkzt37qzX61EULV682Hlk/Vzp/fffv3nzZjfWR32QECIMw8NE9snGrq+EPc/70Ic+dNddd0VR5Kajo8EvuuiiL3/5y29729suuuiir3/962NjY87AuxBAStlsNt/61rc+9thjrVbr85//fKPRcP10xuLqq69+xzve8RROQD/kHXShj08crJ5DdKWUWuvrr79+ZmbG933nRgGA53l/9md/5lDpF+u4H9M0DYJg69at7kcnDb7v79u37+677167du2TBdmDyvCZq7uJiYl//Md/dG6go5qZ+WUve9mnP/3ps846ywnua1/72k984hPveMc7pqen+3rI9/2DBw++973vPf/882+//XZXi+LmX7Va/dM//dNisei+/gyJDmPM8YmDnzMnyzkLMzMzL3/5y13KpZ8ffCakT5/PcoVaAHDttdfW6/WjuiHO4n7uc58rlUp9RwkAKpXKUZ2s/k2+9KUv9QtL3LNKpdJNN93kHDG3Pthd+YUvfMHd1pXe9a/vh+b90sG3v/3t/UrNJxuWP/7jPz6MjVm3bt2jjz564jlZP/7xjx944AFXvAjzZcMOA1dW4RLsnud5nudYQDcVnAIYpIQ2bNgwPj5+pOI9rNoNBmrVnkKO3a9uvfVW51W5v5n59NNPP++88/p5Laf2mfktb3nL3/zN3/TnSr8QJUmSQY9pyZIlb3/725VSTyG+hymbvv9xVHfsBWqD3fAZY2666aZut+vqT13g2K8O7Ofy+qnDwVxQv9ShX7Q1OTnpkktHhsLuDo4gG0wq90vMn6xNT0/3J4S7yZIlSyqVSv8Tt6wGAGZnZ//7f//vf/Inf+ImXL+k3k0O97K+77/nPe956UtfOpimPGo7MjPoHO8TBmA3tffu3esI+n4BqdY6TVNnbxy93m/WWq314AXOz3Ij6Pt+s9m84YYbut3uUUkfa22WZYeRWf0o9mmzOv2sc98N7Lderzc7O1utVqempj760Y9+8IMfdCajT6s51e0SYn/0R380uDrhaROFgxUHx+c44Z9vErlhjeN4UCsiYrfbjaLoRz/60dTUlAt43ASvVCqnn36602DulZzb6Qba1ZS76S+l3L1799atWx3MbtTuv//+W2+99dWvfvVRp1S/nmvQz3rqge6HK/3rXd2Py2C67zrX2iUzAOAv/uIv2u32Jz/5SQfwoEM3PT39yCOPXHTRRUTU6/VckcZTZzafwu16gXrRg0lZF+k7r8H3fbfu6C//8i/dyzgb7CS1n/93sawzYBs3bvzd3/3dAwcOuDVLzpe+8847XYJ9sCi8HyYNMn/9Rz9FP5cuXQoDq4CYedu2bRs2bLjkkkuMMU5n9rP3jqtK03RychIG6mTdjETE7du3v/Od7/z0pz/t6kGfYhHRYM/7XX0hpgullHEcD/Y4TdN2u10oFPbt27dp06b+BHfjdf7559dqtVqtNjw87PJIpVKpVquNjIyMjIwMDQ2VSqVSqVSpVEql0oUXXrh+/fo+T+tE+Y477mi320dNFzqxOyxweuohvvDCCweZL0Tcv3//5z73uU6n49A9rIg6z/N3v/vdX/nKVxyu/YJf9w/P8+6///4PfehD27ZtO2p50CCVdqQuPDHShUEQuMjhs5/9bN+oOC29fv36yy+/vO+FOrKXnrwFQXD55ZdHUZTnuRtNIcRtt9324IMP9onMw/JufZU7mJp9CoDf+MY3Oj+5X5gnhPi3f/u3a6+9dtOmTX2yxb3IwYMHL7/88n/5l39xpt19y7kX/RpCz/NuueWWd7/73fV63XkPT8bMHObkH7dF5c+BinZ8xU9/+tN+Ns15LuvXr1++fHk/CfPUAbHjDa644opFixbt2LFjUB9++tOfvvjii10C0a35HFTUg4vwn3bUoij6nd/5nS984QtuTVTfJb7hhhsee+yx1772tatXr47j2BizdevWT3ziE1mWuRd0Aufsgu/7nU6n3z2l1E033fT7v//7//7v/+667UryDltrMxjUHU8bDM9J+uiWW27pM7GuWFVK+a1vfeuZB/Luskaj8Ru/8RswX8vuBiUIAkcqHba44brrrnOLxPuMShAEO3fufLKSdPfh448/7pYTCiGcW/Rkir1fdSvnGwB84hOf+NjHPubstOth/7tvetObjmRm3L/f//73H5YlPOecc04AoqM/T3/605+66slBjv5XfuVX2u32M8xsOympVquXXnqp88VcTt75rt/4xjcAoG+Mnap0dHFfZyilnLFwxdVPxnGuWrXqM5/5zMKFC11xfN9zdsrAH2gue98vqbTWvve97333u9/9rne96x3veIcQwumA/he//OUv//mf/7ljQg575T6j14/ygyAoFArHQ1c/e3pyz5495557LhxaPvee97zHxVQ/rzK4/fbbFy1aNBgLAcCrXvWqZrPp2EQniFmWfexjHysdul+o7/s7duzor/U7qhA7WvGGG25wKqdvjPsYO33gJmvfHgPA+9//fndna2232z0yeHNi/c53vtNd5vrghuhP/uRP+uPjwF6zZs2ePXt+rvUvz8MCcAfJz372swULFrhZ7IZGKeUKsrrdbrPZfIav4a7pdDq/8zu/M6jqpZSLFi3asGFDf2W+C6Y/+9nPurpXt7gIERcsWLBv376nfZz77Z49e972treVy+Un8wzcTI2i6LWvfe2tt9562AYESZK4FVburcMwdObZqfH+UxzAf/VXf9WnJ11XzzzzTLc26VgD/KzSzk5F79u37wc/+EGSJI7QcDUxb3zjGwf5kJ/rhvfcc88dd9zhdKOrxyuXy69//ev7G1Y4P7b/XLcGlYgWL178qle9qr+Lz1Hvn2VZ300DgLvvvvuWW265++67N2/e3O12nV1w0rxixYqzzz770ksvvfLKK13pSP+2SZJEUZRlWd8PaLfbztmu1+sXXHDBFVdcMfhGjz766E033eT7fp8FWr58+Ste8YojN/t5ztsv12akTkM4xd5fQu4iounp6SRJkiRxpSZhGEZRtHTpUt/3XfmfmxYOj3a7HUWRUifAkSbPAcBHLb14NqmSo67XfoqNtAZ33fp5n9vf6uap47cne/F+mmGQux203INXDhZ1/Ce6+qIE/3ye/5EwH2mDn6za+cUd319sL5T24makv8QAO5fksHxqt9uFZ1wa6C7rdrtPmzl5ru7sSMRnqcOfYZ+fr/ZzjZV42vTRYWapv5b+mScTnzYf/hze+dl7Ls+8z8+bWf15xupFG/wL3v5/9HUgu6IHIqgAAAAASUVORK5CYII=';
var EC_LOGO_LIGHT_B64 = 'data:image/png;base64,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';
var ATT_LOGO_DARK_B64 = 'data:image/png;base64,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';


// Final safety poll
var _poll = setInterval(function() {
  if (window.jspdf && window.jspdf.jsPDF) {
    pdfReady = true;
    clearInterval(_poll);
  }
}, 1000);

// ============================================================
// HELPERS
// ============================================================
function fmt(n) {
  return (Math.round(n * 100) / 100).toLocaleString('es-MX', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}

// ============================================================
// STATE
// ============================================================
let state = {
  agente: { nombre: '', attuid: '' },
  devices: [],
  fileLoaded: false,
  fileName: '',
  items: [],
  cotizaciones: [],
  currentView: 'home',
  viewStack: ['home'],
  filterEstatus: 'all',
  selectedCotizacion: null,
};

// Plan configs
// Plan pricing with auto-switch dates
var PRICE_SWITCH_DATE_1 = new Date('2026-03-06T00:00:00'); // Diamante
var PRICE_SWITCH_DATE_2 = new Date('2026-03-13T00:00:00'); // Rest
var NOW_DATE = new Date();

function pp(current, newPrice, switchDate) {
  return NOW_DATE >= switchDate ? newPrice : current;
}

const PLANS_PREMIUM = [
  { id:'azul1', name:'Azul 1', gb:'5GB', price: pp(319, 330, PRICE_SWITCH_DATE_2), col:7 },
  { id:'azul2', name:'Azul 2', gb:'8GB', price: pp(419, 435, PRICE_SWITCH_DATE_2), col:10 },
  { id:'azul3', name:'Azul 3', gb:'12GB', price: pp(529, 550, PRICE_SWITCH_DATE_2), col:13 },
  { id:'plata', name:'Plata', gb:'25GB', price: pp(629, 650, PRICE_SWITCH_DATE_2), col:16 },
  { id:'oro', name:'Oro', gb:'30GB', price: pp(699, 725, PRICE_SWITCH_DATE_2), col:19 },
  { id:'black', name:'Black', gb:'40GB', price: pp(799, 825, PRICE_SWITCH_DATE_2), col:22 },
  { id:'platino', name:'Platino', gb:'45GB', price: pp(999, 1035, PRICE_SWITCH_DATE_2), col:25 },
  { id:'diamante', name:'Diamante', gb:'50GB', price: pp(1259, 1300, PRICE_SWITCH_DATE_1), col:28 },
];
const PLANS_TITANIO = [
  { id:'titanio', name:'Titanio', gb:'40GB', price: pp(1499, 1499, PRICE_SWITCH_DATE_2), col:7 },
];
const ALL_PLANS = [...PLANS_PREMIUM, ...PLANS_TITANIO];

// Planes actuales del cliente (para comparativa) ‚Äî con precios actuales y nuevos
const PLANS_ACTUALES = [
  // Con Todo (Nextel/Iusacell) ‚Üí mismos incrementos que AT&T Plus A Tu Manera
  { id:'ct_399', name:'Con Todo 399', gb:'2GB', price: pp(434, 444, PRICE_SWITCH_DATE_2) },
  { id:'ct_499', name:'Con Todo 499', gb:'3GB', price: pp(534, 546, PRICE_SWITCH_DATE_2) },
  { id:'ct_549', name:'Con Todo 549', gb:'5GB', price: pp(584, 603, PRICE_SWITCH_DATE_2) },
  { id:'ct_599', name:'Con Todo 599', gb:'6GB', price: pp(634, 657, PRICE_SWITCH_DATE_2) },
  { id:'ct_699', name:'Con Todo 699', gb:'6GB', price: pp(744, 771, PRICE_SWITCH_DATE_2) },
  { id:'ct_799', name:'Con Todo 799', gb:'7GB', price: pp(844, 871, PRICE_SWITCH_DATE_2) },
  { id:'ct_999', name:'Con Todo 999', gb:'8GB', price: pp(1044, 1079, PRICE_SWITCH_DATE_2) },
  { id:'ct_1254', name:'Con Todo 1254', gb:'9GB', price: pp(1254, 1296, PRICE_SWITCH_DATE_2) },
  // Cons√≠guelo AT&T
  { id:'cg_1', name:'Cons√≠guelo 1', gb:'1GB', price: pp(299, 309, PRICE_SWITCH_DATE_2) },
  { id:'cg_1_5', name:'Cons√≠guelo 1.5', gb:'1.5GB', price: pp(341, 353, PRICE_SWITCH_DATE_2) },
  { id:'cg_2', name:'Cons√≠guelo 2', gb:'2GB', price: pp(404, 418, PRICE_SWITCH_DATE_2) },
  { id:'cg_3', name:'Cons√≠guelo 3', gb:'3GB', price: pp(541, 560, PRICE_SWITCH_DATE_2) },
  { id:'cg_5', name:'Cons√≠guelo 5', gb:'5GB', price: pp(667, 690, PRICE_SWITCH_DATE_2) },
  { id:'cg_6_5', name:'Cons√≠guelo 6.5', gb:'6.5GB', price: pp(772, 799, PRICE_SWITCH_DATE_2) },
  { id:'cg_8', name:'Cons√≠guelo 8', gb:'8GB', price: pp(887, 918, PRICE_SWITCH_DATE_2) },
  { id:'cg_10', name:'Cons√≠guelo 10', gb:'10GB', price: pp(992, 1027, PRICE_SWITCH_DATE_2) },
  { id:'cg_13', name:'Cons√≠guelo 13', gb:'13GB', price: pp(1202, 1244, PRICE_SWITCH_DATE_2) },
  { id:'cg_20', name:'Cons√≠guelo 20', gb:'20GB', price: pp(1853, 1918, PRICE_SWITCH_DATE_2) },
  // √Årmalo
  { id:'ar_3', name:'√Årmalo 3', gb:'3GB', price: pp(314, 325, PRICE_SWITCH_DATE_2) },
  { id:'ar_5', name:'√Årmalo 5', gb:'5GB', price: pp(419, 434, PRICE_SWITCH_DATE_2) },
  { id:'ar_8', name:'√Årmalo 8', gb:'8GB', price: pp(524, 542, PRICE_SWITCH_DATE_2) },
  { id:'ar_9', name:'√Årmalo 9', gb:'9GB', price: pp(629, 651, PRICE_SWITCH_DATE_2) },
  { id:'ar_10', name:'√Årmalo 10', gb:'10GB', price: pp(629, 651, PRICE_SWITCH_DATE_2) },
  { id:'ar_11', name:'√Årmalo 11', gb:'11GB', price: pp(681, 705, PRICE_SWITCH_DATE_2) },
  { id:'ar_12', name:'√Årmalo 12', gb:'12GB', price: pp(681, 705, PRICE_SWITCH_DATE_2) },
  { id:'ar_14', name:'√Årmalo 14', gb:'14GB', price: pp(786, 814, PRICE_SWITCH_DATE_2) },
  { id:'ar_17', name:'√Årmalo 17', gb:'17GB', price: pp(891, 922, PRICE_SWITCH_DATE_1) },
  { id:'ar_20', name:'√Årmalo 20', gb:'20GB', price: pp(996, 1031, PRICE_SWITCH_DATE_2) },
  { id:'ar_26', name:'√Årmalo 26', gb:'26GB', price: pp(1101, 1140, PRICE_SWITCH_DATE_2) },
  { id:'ar_40', name:'√Årmalo 40', gb:'40GB', price: pp(1399, 1454, PRICE_SWITCH_DATE_1) },
  // AT&T Premium (actuales, para clientes que ya tienen Premium)
  { id:'pa_azul1', name:'AT&T Azul 1 (actual)', gb:'5GB', price: pp(319, 330, PRICE_SWITCH_DATE_2) },
  { id:'pa_azul2', name:'AT&T Azul 2 (actual)', gb:'8GB', price: pp(419, 435, PRICE_SWITCH_DATE_2) },
  { id:'pa_azul3', name:'AT&T Azul 3 (actual)', gb:'12GB', price: pp(529, 550, PRICE_SWITCH_DATE_2) },
  { id:'pa_plata', name:'AT&T Plata (actual)', gb:'25GB', price: pp(629, 650, PRICE_SWITCH_DATE_2) },
  { id:'pa_oro', name:'AT&T Oro (actual)', gb:'30GB', price: pp(699, 725, PRICE_SWITCH_DATE_2) },
  { id:'pa_black', name:'AT&T Black (actual)', gb:'40GB', price: pp(799, 825, PRICE_SWITCH_DATE_2) },
  { id:'pa_platino', name:'AT&T Platino (actual)', gb:'45GB', price: pp(999, 1035, PRICE_SWITCH_DATE_2) },
  { id:'pa_diamante', name:'AT&T Diamante (actual)', gb:'50GB', price: pp(1259, 1300, PRICE_SWITCH_DATE_1) },
];

// ============================================================
// PERSISTENCE (localStorage + Google Sheets ready)
// ============================================================
function loadState() {
  try {
    const saved = localStorage.getItem('cotizador_att_state');
    if (saved) {
      const parsed = JSON.parse(saved);
      state.agente = parsed.agente || state.agente;
      state.cotizaciones = parsed.cotizaciones || [];
    }
  } catch(e) { console.error('Load error:', e); }
}

function saveState() {
  try {
    localStorage.setItem('cotizador_att_state', JSON.stringify({
      agente: state.agente,
      cotizaciones: state.cotizaciones,
    }));
  } catch(e) { console.error('Save error:', e); }
}

// ============================================================
// SUPABASE SYNC
// ============================================================
async function syncCotizacionToSupabase(cotizacion, isEdit) {
  if (!supabase || !currentUser) return;
  try {
    if (isEdit) {
      // Update existing
      await supabase.from('cotizaciones').update({
        cliente_nombre: cotizacion.cliente.nombre,
        cliente_telefono: cotizacion.cliente.telefono,
        cliente_email: cotizacion.cliente.email,
        cliente_direccion: cotizacion.cliente.direccion,
        dias_validez: cotizacion.diasValidez,
        valido_hasta: cotizacion.validoHasta,
        estatus: cotizacion.estatus,
        plantilla: selectedTemplate,
        edited_at: new Date().toISOString(),
      }).eq('folio', cotizacion.folio);

      // Delete old items and re-insert
      await supabase.from('cotizacion_items').delete().eq('cotizacion_id',
        (await supabase.from('cotizaciones').select('id').eq('folio', cotizacion.folio).single()).data.id
      );
    } else {
      // Insert new cotizacion
      var { data: cotRow, error: cotErr } = await supabase.from('cotizaciones').insert({
        folio: cotizacion.folio,
        agente_id: currentUser.id,
        cliente_nombre: cotizacion.cliente.nombre,
        cliente_telefono: cotizacion.cliente.telefono,
        cliente_email: cotizacion.cliente.email,
        cliente_direccion: cotizacion.cliente.direccion,
        dias_validez: cotizacion.diasValidez,
        fecha: cotizacion.fecha,
        valido_hasta: cotizacion.validoHasta,
        estatus: cotizacion.estatus || 'enviada',
        plantilla: selectedTemplate,
      }).select('id').single();

      if (cotErr) { console.error('Error saving cotizacion:', cotErr); return; }
    }

    // Get cotizacion ID
    var { data: cotData } = await supabase.from('cotizaciones').select('id').eq('folio', cotizacion.folio).single();
    if (!cotData) return;

    // Insert items
    var items = cotizacion.items.map(function(it) {
      var base = it.precioPromo - (it.enganche || 0);
      var mensual = base / it.plazo + it.planPrecio;
      return {
        cotizacion_id: cotData.id,
        equipo: it.equipo,
        marca: it.marca || '',
        precio_lista: it.precioLista,
        precio_promo: it.precioPromo,
        plazo: it.plazo,
        enganche_pct: it.enganchePct || 0,
        enganche: it.enganche || 0,
        plan_id: it.planId,
        plan_nombre: it.planNombre,
        plan_precio: it.planPrecio,
        mensual: Math.round(mensual * 100) / 100,
      };
    });

    if (items.length > 0) {
      await supabase.from('cotizacion_items').insert(items);
    }

    console.log('Cotizaci√≥n synced to Supabase:', cotizacion.folio);
  } catch(e) {
    console.error('Supabase sync error:', e);
  }
}

async function updateEstatusInSupabase(folio, estatus) {
  if (!supabase) return;
  try {
    await supabase.from('cotizaciones').update({ estatus: estatus }).eq('folio', folio);
    console.log('Estatus updated in Supabase:', folio, estatus);
  } catch(e) { console.error('Estatus sync error:', e); }
}

async function loadCotizacionesFromSupabase() {
  if (!supabase || !currentUser) { console.log('loadCots: no supabase or user'); return; }
  try {
    var query = supabase.from('cotizaciones').select('*, cotizacion_items(*)');

    // Filter by role
    if (currentUser.rol === 'agente') {
      query = query.eq('agente_id', currentUser.id);
    } else if (currentUser.rol === 'supervisor') {
      var { data: agentes } = await supabase.from('usuarios').select('id').eq('supervisor_id', currentUser.id);
      var ids = (agentes || []).map(function(a) { return a.id; });
      ids.push(currentUser.id);
      query = query.in('agente_id', ids);
    } else if (currentUser.rol === 'coordinador') {
      var { data: users } = await supabase.from('usuarios').select('id').eq('coordinador_id', currentUser.id);
      var ids = (users || []).map(function(u) { return u.id; });
      ids.push(currentUser.id);
      query = query.in('agente_id', ids);
    }
    // admin sees all - no filter

    query = query.order('created_at', { ascending: false }).limit(500);
    var { data, error } = await query;

    if (error) { console.error('Load cotizaciones error:', error); return; }
    if (!data) { console.log('loadCots: no data returned'); return; }
    console.log('loadCots: got ' + data.length + ' from Supabase');

    // Load agent names separately
    var agentIds = [...new Set(data.map(function(c) { return c.agente_id; }))];
    var agentMap = {};
    if (agentIds.length > 0) {
      var { data: agents } = await supabase.from('usuarios').select('id, nombre, attuid, whatsapp').in('id', agentIds);
      (agents || []).forEach(function(a) { agentMap[a.id] = a; });
    }

    // Convert Supabase format to local format
    var cotizaciones = data.map(function(c) {
      var ag = agentMap[c.agente_id];
      return {
        folio: c.folio,
        fecha: c.fecha,
        validoHasta: c.valido_hasta,
        diasValidez: c.dias_validez,
        cliente: {
          nombre: c.cliente_nombre,
          telefono: c.cliente_telefono,
          email: c.cliente_email,
          direccion: c.cliente_direccion,
        },
        ejecutivo: ag ? { nombre: ag.nombre, attuid: ag.attuid, whatsapp: ag.whatsapp || '' } : { ...state.agente },
        items: (c.cotizacion_items || []).map(function(it) {
          return {
            equipo: it.equipo,
            marca: it.marca,
            precioLista: parseFloat(it.precio_lista),
            precioPromo: parseFloat(it.precio_promo),
            plazo: it.plazo,
            enganchePct: parseFloat(it.enganche_pct),
            enganche: parseFloat(it.enganche),
            planId: it.plan_id,
            planNombre: it.plan_nombre,
            planPrecio: parseFloat(it.plan_precio),
            imageData: null,
          };
        }),
        estatus: c.estatus,
        sub_estatus: c.sub_estatus,
        folio_att: c.folio_att,
        fecha_fin_plazo: c.fecha_fin_plazo,
        tiene_ine: c.tiene_ine,
        createdAt: c.created_at,
        editedAt: c.edited_at,
        agente_id: c.agente_id,
      };
    });

    state.cotizaciones = cotizaciones;
    saveState();
    console.log('Loaded ' + cotizaciones.length + ' cotizaciones from Supabase');
  } catch(e) { console.error('Load cotizaciones error:', e); }
}

// ============================================================
// NAVIGATION
// ============================================================
function showView(name, title) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.getElementById('view' + name.charAt(0).toUpperCase() + name.slice(1)).classList.add('active');

  state.viewStack.push(name);
  state.currentView = name;

  const btnBack = document.getElementById('btnBack');
  const headerTitle = document.getElementById('headerTitle');
  btnBack.className = name === 'home' ? 'btn-back' : 'btn-back visible';

  const titles = {
    home: '', config: 'Mi Perfil', cotizar: 'Nueva Cotizaci√≥n',
    historial: 'Historial de Cotizaciones', detalle: '', admin: 'Admin Usuarios', dashboard: 'Dashboard', recuperacion: 'Recuperaci√≥n',
  };
  headerTitle.textContent = title || titles[name] || '';

  if (name === 'config') {
    document.getElementById('cfgNombre').value = state.agente.nombre;
    document.getElementById('cfgAttuid').value = state.agente.attuid;
    document.getElementById('cfgWhatsapp').value = state.agente.whatsapp || '';
  }
  if (name === 'historial') { initHistorialFilters(); renderHistorial(); }
  if (name === 'home') {
    state.viewStack = ['home'];
    updateHome();
  }
}

function goBack() {
  state.viewStack.pop();
  const prev = state.viewStack[state.viewStack.length - 1] || 'home';
  state.viewStack.pop(); // will be re-added by showView
  showView(prev);
}

// ============================================================
// HOME UPDATE
// ============================================================
function updateHome() {
  // Agent display
  const agentEl = document.getElementById('headerAgent');
  const configDesc = document.getElementById('configDesc');
  if (state.agente.nombre) {
    agentEl.textContent = state.agente.nombre + ' ¬∑ ' + state.agente.attuid;
    configDesc.textContent = state.agente.nombre + ' (' + state.agente.attuid + ')';
  } else {
    agentEl.textContent = '';
    configDesc.textContent = 'Configurar datos del ejecutivo';
  }

  // Upload status
  const cardCotizar = document.getElementById('cardCotizar');
  const cotizarDesc = document.getElementById('cotizarDesc');
  if (state.fileLoaded && state.agente.nombre) {
    cardCotizar.className = 'home-card clickable';
    cotizarDesc.textContent = 'Crear cotizaci√≥n para un cliente';
  } else if (!state.fileLoaded) {
    cardCotizar.className = 'home-card disabled';
    cotizarDesc.textContent = 'Primero sube la lista de precios';
  } else {
    cardCotizar.className = 'home-card disabled';
    cotizarDesc.textContent = 'Configura tu perfil primero';
  }

  // Historial counts
  const total = state.cotizaciones.length;
  const open = state.cotizaciones.filter(c => c.estatus === 'enviada').length;
  const closed = state.cotizaciones.filter(c => c.estatus === 'venta').length;
  const pending = state.cotizaciones.filter(c => c.estatus === 'seguimiento').length;
  const lost = state.cotizaciones.filter(c => c.estatus === 'perdida').length;
  document.getElementById('historialCount').textContent = total + ' cotizaciones';
  document.getElementById('historialMiniStats').innerHTML =
    `<span class="mini-stat open">${open} enviadas</span>` +
    `<span class="mini-stat closed">${closed} ventas</span>` +
    `<span class="mini-stat pending">${pending} seguimiento</span>`;

  // Show admin card for admin/coordinator/supervisor
  var adminCard = document.getElementById('cardAdmin');
  if (currentUser && (currentUser.rol === 'admin' || currentUser.rol === 'coordinador' || currentUser.rol === 'supervisor')) {
    adminCard.style.display = '';
    var adminDesc = document.getElementById('adminDesc');
    if (currentUser.rol === 'supervisor') adminDesc.textContent = 'Gestionar mis agentes';
    else if (currentUser.rol === 'coordinador') adminDesc.textContent = 'Gestionar mi equipo';
    else adminDesc.textContent = 'Gestionar todos los usuarios';
  } else {
    adminCard.style.display = 'none';
  }

  // Show dashboard for admin/coordinator/supervisor
  var dashCard = document.getElementById('cardDashboard');
  if (currentUser && currentUser.rol !== 'agente') {
    dashCard.style.display = '';
  } else {
    dashCard.style.display = 'none';
  }

  // Show recuperacion card for admin/coordinator
  var recupCard = document.getElementById('cardRecuperacion');
  if (currentUser && (currentUser.rol === 'admin' || currentUser.rol === 'coordinador')) {
    recupCard.style.display = '';
    // Count pending recovery async
    if (supabase) {
      supabase.from('usuarios').select('id').eq('activo', false).then(function(res) {
        var inactiveIds = (res.data || []).map(function(u) { return u.id; });
        if (inactiveIds.length === 0) {
          recupCard.style.display = 'none';
          return;
        }
        supabase.from('cotizaciones').select('id', { count: 'exact', head: true })
          .in('agente_id', inactiveIds).neq('estatus', 'venta').then(function(r2) {
            var cnt = r2.count || 0;
            document.getElementById('recupDesc').textContent = cnt > 0 ? cnt + ' cotizaci√≥n(es) por reasignar' : 'Todo reasignado';
            if (cnt === 0) recupCard.style.display = 'none';
          });
      });
    }
  } else {
    recupCard.style.display = 'none';
  }

  // Alerts/Notifications
  var alertsDiv = document.getElementById('homeAlerts');
  var alerts = [];
  var now = new Date();

  // Cotizaciones sin gesti√≥n por m√°s de 2 d√≠as
  var sinGestion = state.cotizaciones.filter(function(c) {
    if (c.estatus !== 'enviada') return false;
    var created = c.createdAt ? new Date(c.createdAt) : null;
    return created && (now - created) > 2 * 86400000;
  });
  if (sinGestion.length > 0) {
    alerts.push('<div style="background:#FFF3CD;border:1px solid #E6A200;border-radius:8px;padding:10px 14px;display:flex;align-items:center;gap:8px"><span style="font-size:18px">‚è∞</span><div><div style="font-weight:700;font-size:12px;color:#856404">' + sinGestion.length + ' cotizaci√≥n(es) sin gestionar por m√°s de 2 d√≠as</div><div style="font-size:11px;color:#856404">Clientes: ' + sinGestion.slice(0,3).map(function(c){return c.cliente.nombre}).join(', ') + (sinGestion.length > 3 ? '...' : '') + '</div></div></div>');
  }

  // Cotizaciones en seguimiento por m√°s de 5 d√≠as
  var segViejo = state.cotizaciones.filter(function(c) {
    if (c.estatus !== 'seguimiento') return false;
    var created = c.createdAt ? new Date(c.createdAt) : null;
    return created && (now - created) > 5 * 86400000;
  });
  if (segViejo.length > 0) {
    alerts.push('<div style="background:#F8D7DA;border:1px solid #DC3545;border-radius:8px;padding:10px 14px;display:flex;align-items:center;gap:8px"><span style="font-size:18px">üî¥</span><div><div style="font-weight:700;font-size:12px;color:#721C24">' + segViejo.length + ' en seguimiento por m√°s de 5 d√≠as</div><div style="font-size:11px;color:#721C24">Posibles ventas perdidas: ' + segViejo.slice(0,3).map(function(c){return c.cliente.nombre}).join(', ') + (segViejo.length > 3 ? '...' : '') + '</div></div></div>');
  }

  // Ventas no confirmadas
  var noConf = state.cotizaciones.filter(function(c) { return c.estatus === 'venta' && c.sub_estatus === 'no_confirmada'; });
  if (noConf.length > 0) {
    alerts.push('<div style="background:#F8D7DA;border:1px solid #DC3545;border-radius:8px;padding:10px 14px;display:flex;align-items:center;gap:8px"><span style="font-size:18px">‚ö†Ô∏è</span><div><div style="font-weight:700;font-size:12px;color:#721C24">' + noConf.length + ' venta(s) no confirmada(s)</div><div style="font-size:11px;color:#721C24">Requieren revisi√≥n en el Dashboard</div></div></div>');
  }

  // Aceleraciones vencidas (fecha ya pas√≥ y no est√° como perdida ni venta)
  var aceleracionesVencidas = state.cotizaciones.filter(function(c) {
    if (c.sub_estatus !== 'aceleracion' || !c.fecha_fin_plazo) return false;
    if (c.estatus === 'perdida' || c.estatus === 'venta') return false;
    return new Date(c.fecha_fin_plazo + 'T00:00:00') <= now;
  });
  if (aceleracionesVencidas.length > 0) {
    alerts.push('<div style="background:#F8D7DA;border:1px solid #DC3545;border-radius:8px;padding:10px 14px;display:flex;align-items:center;gap:8px"><span style="font-size:18px">üö®</span><div><div style="font-weight:700;font-size:12px;color:#721C24">' + aceleracionesVencidas.length + ' aceleraci√≥n(es) con plazo VENCIDO</div><div style="font-size:11px;color:#721C24">¬°Estos clientes ya est√°n libres! Contactar de inmediato: ' + aceleracionesVencidas.slice(0,3).map(function(c){return c.cliente.nombre + ' (venci√≥ ' + c.fecha_fin_plazo + ')'}).join(', ') + (aceleracionesVencidas.length > 3 ? '...' : '') + '</div></div></div>');
  }

  // Aceleraciones pr√≥ximas a vencer (dentro de 7 d√≠as)
  var proxAceleraciones = state.cotizaciones.filter(function(c) {
    if (c.sub_estatus !== 'aceleracion' || !c.fecha_fin_plazo) return false;
    if (c.estatus === 'perdida' || c.estatus === 'venta') return false;
    var fechaFin = new Date(c.fecha_fin_plazo + 'T00:00:00');
    return fechaFin > now && (fechaFin - now) <= 7 * 86400000;
  });
  if (proxAceleraciones.length > 0) {
    alerts.push('<div style="background:#FFF3CD;border:1px solid #E6A200;border-radius:8px;padding:10px 14px;display:flex;align-items:center;gap:8px"><span style="font-size:18px">üìÖ</span><div><div style="font-weight:700;font-size:12px;color:#856404">' + proxAceleraciones.length + ' aceleraci√≥n(es) pr√≥ximas a vencer (7 d√≠as)</div><div style="font-size:11px;color:#856404">' + proxAceleraciones.map(function(c){return c.cliente.nombre + ' (' + c.fecha_fin_plazo + ')'}).join(', ') + '</div></div></div>');
  }

  if (alerts.length > 0) {
    alertsDiv.style.display = 'flex';
    alertsDiv.style.flexDirection = 'column';
    alertsDiv.style.gap = '6px';
    alertsDiv.innerHTML = alerts.join('');
  } else {
    alertsDiv.style.display = 'none';
  }
}

// ============================================================
// CONFIG
// ============================================================
function saveConfig() {
  const nombre = document.getElementById('cfgNombre').value.trim();
  const attuid = document.getElementById('cfgAttuid').value.trim().toUpperCase();
  const whatsapp = document.getElementById('cfgWhatsapp').value.trim();
  if (!nombre || !attuid) { alert('Completa nombre y ATTUID.'); return; }
  state.agente = { ...state.agente, nombre, attuid, whatsapp };
  saveState();

  // Sync WhatsApp to Supabase
  if (supabase && currentUser) {
    supabase.from('usuarios').update({ whatsapp: whatsapp || null }).eq('id', currentUser.id);
    currentUser.whatsapp = whatsapp;
  }
  showView('home');
}

// ============================================================
// FILE PARSER
// ============================================================
async function handleFileUpload(event) {
  const file = event.target.files[0];
  if (!file) return;

  document.getElementById('uploadStatus').innerHTML =
    '<div class="card-desc" style="color:var(--att-blue)">‚è≥ Procesando archivo...</div>';

  try {
    const data = await file.arrayBuffer();
    const wb = XLSX.read(data, { type:'array', cellDates:true });
    const devices = [];

    // Parse Promociones AT&T Premium
    var pSheetName = Object.keys(wb.Sheets).find(function(s) { return s.toLowerCase().includes('premium'); });
    const pSheet = pSheetName ? wb.Sheets[pSheetName] : null;
    console.log('Premium sheet:', pSheetName, '| found:', !!pSheet, '| All sheets:', Object.keys(wb.Sheets));
    if (pSheet) {
      const rows = XLSX.utils.sheet_to_json(pSheet, { header:1, defval:null });
      for (let i = 8; i < rows.length; i++) {
        const r = rows[i];
        if (!r || !r[5] || typeof r[5] !== 'string') continue;
        const pc = parseFloat(r[6]) || 0;
        if (pc === 0) continue;

        const pricing = {};
        PLANS_PREMIUM.forEach(plan => {
          pricing[plan.id] = {};
          [0,1,2].forEach(offset => {
            const plazo = [24,30,36][offset];
            const val = r[plan.col + offset];
            pricing[plan.id][plazo] = (typeof val === 'number' && val >= 0) ? val : null;
          });
        });

        devices.push({
          id: 'p'+i, sheet:'Premium', oferta:'AT&T Premium',
          equipo: r[5], marca: r[4]||'', precioContado: pc,
          estatus: r[2]||'', vigencia: r[33]||'',
          fechaInicio: r[31] instanceof Date ? r[31] : null,
          fechaFin: r[32] instanceof Date ? r[32] : null,
          fechaFinText: typeof r[32] === 'string' ? r[32] : '',
          pricing, plans: PLANS_PREMIUM, plazos: [24,30,36],
        });
      }
    }

    // Parse Promociones AT&T Titanio
    var tSheetName = Object.keys(wb.Sheets).find(function(s) { return s.toLowerCase().includes('titanio'); });
    const tSheet = tSheetName ? wb.Sheets[tSheetName] : null;
    console.log('Titanio sheet:', tSheetName, '| found:', !!tSheet);
    if (tSheet) {
      const rows = XLSX.utils.sheet_to_json(tSheet, { header:1, defval:null, raw:false });
      console.log('Titanio total rows:', rows.length);
      // Find header row (look for "Equipo" in any row)
      var tStartRow = 7;
      for (var ri = 0; ri < Math.min(rows.length, 15); ri++) {
        var row = rows[ri];
        if (row && row.some && row.some(function(cell) { return typeof cell === 'string' && cell.toLowerCase().includes('equipo'); })) {
          tStartRow = ri + 1;
          console.log('Titanio header at row', ri, '| data starts at', tStartRow);
          break;
        }
      }
      for (let i = tStartRow; i < rows.length; i++) {
        const r = rows[i];
        if (!r) continue;
        // Find equipo - try column 5 (F) first, then search
        var equipo = r[5] || r[4] || '';
        if (typeof equipo !== 'string' || equipo.trim() === '') continue;
        equipo = equipo.trim();

        // Parse prices - handle $, commas
        function parsePrice(v) {
          if (v === null || v === undefined || v === '' || v === 'NA' || v === 'N/A') return null;
          if (typeof v === 'number') return v;
          var n = parseFloat(String(v).replace(/[$,]/g, ''));
          return isNaN(n) ? null : n;
        }

        var pc = parsePrice(r[6]) || 0;
        if (pc === 0) continue;
        var promo24 = parsePrice(r[7]);

        console.log('Titanio device:', equipo, '| contado:', pc, '| 24m:', promo24);

        devices.push({
          id: 't'+i, sheet:'Titanio', oferta:'AT&T Titanio',
          equipo: equipo, marca: r[4]||r[3]||'', precioContado: pc,
          estatus: r[2]||r[1]||'', vigencia: r[11]||r[10]||'',
          fechaInicio: null,
          fechaFin: null,
          fechaFinText: '',
          pricing: { titanio: { 24: promo24 } },
          plans: PLANS_TITANIO, plazos: [24],
        });
      }
      console.log('Titanio devices loaded:', devices.filter(function(d){return d.sheet==='Titanio'}).length);
    }

    state.devices = devices;
    state.fileLoaded = true;
    state.fileName = file.name;

    const vigentes = devices.filter(isVigente);
    document.getElementById('uploadStatus').innerHTML =
      `<div class="success-pill">‚úì ${file.name}</div>` +
      `<div class="card-stat">${vigentes.length} equipos vigentes de ${devices.length} total</div>` +
      `<div class="upload-zone" onclick="document.getElementById('fileInput2').click()" style="padding:10px;margin-top:6px">` +
      `<div style="font-size:11px;color:var(--text-3)">Cambiar archivo</div>` +
      `<input type="file" id="fileInput2" accept=".xlsx,.xlsm" onchange="handleFileUpload(event)" style="display:none">` +
      `</div>`;

    updateHome();
  } catch(err) {
    document.getElementById('uploadStatus').innerHTML =
      `<div class="card-desc" style="color:var(--danger)">‚ùå Error: ${err.message}</div>` +
      `<div class="upload-zone" onclick="document.getElementById('fileInput').click()" style="margin-top:8px">` +
      `<div style="font-size:12px">Intentar de nuevo</div>` +
      `<input type="file" id="fileInput" accept=".xlsx,.xlsm" onchange="handleFileUpload(event)" style="display:none">` +
      `</div>`;
  }
}

function isVigente(dev) {
  const now = new Date(); now.setHours(0,0,0,0);
  if (dev.fechaInicio && dev.fechaInicio > now) return false;
  if (dev.fechaFin && dev.fechaFin < now) return false;
  return true;
}

// ============================================================
// SEARCH & DEVICE CARDS
// ============================================================
function searchDevices() {
  const term = document.getElementById('searchInput').value.toLowerCase().trim();
  const filter = document.getElementById('searchFilter').value;
  const container = document.getElementById('deviceResults');

  if (term.length < 2) { container.innerHTML = ''; return; }

  const vigentes = state.devices.filter(isVigente);
  const filtered = vigentes.filter(d => {
    const matchTerm = d.equipo.toLowerCase().includes(term) || d.marca.toLowerCase().includes(term);
    const matchFilter = filter === 'all' ||
      (filter === 'premium' && d.oferta.includes('Premium')) ||
      (filter === 'titanio' && d.oferta.includes('Titanio'));
    return matchTerm && matchFilter;
  });

  if (filtered.length === 0) {
    container.innerHTML = '<div class="no-results">No se encontraron equipos vigentes.</div>';
    return;
  }

  const shown = filtered.slice(0, 20);
  let html = '<div class="device-list">';
  shown.forEach(dev => {
    html += renderDeviceCard(dev);
  });
  if (filtered.length > 20) {
    html += `<div class="no-results" style="font-size:12px">Mostrando 20 de ${filtered.length}. Refina tu b√∫squeda.</div>`;
  }
  html += '</div>';
  container.innerHTML = html;
}

function renderDeviceCard(dev) {
  const planOptions = dev.plans.map(p =>
    `<option value="${p.id}">${p.name} (${p.gb}) - $${p.price}/mes</option>`
  ).join('');
  const plazoOptions = dev.plazos.map(p =>
    `<option value="${p}">${p} meses</option>`
  ).join('');

  return `
    <div class="device-card" id="dev_${dev.id}">
      <div class="device-header" onclick="toggleDevice('${dev.id}')">
        <div>
          <div class="device-brand">${dev.marca}</div>
          <div class="device-name">${dev.equipo}</div>
          <div class="device-offer">${dev.oferta}</div>
        </div>
        <div class="device-price">
          <div class="device-price-label">Precio lista</div>
          <div class="device-price-val">$${dev.precioContado.toLocaleString('es-MX',{minimumFractionDigits:2,maximumFractionDigits:2})}</div>
        </div>
        <span class="expand-icon" id="icon_${dev.id}">‚ñº</span>
      </div>
      <div class="device-body" id="body_${dev.id}">
        <div class="device-selectors">
          <div class="form-group">
            <label class="field-label">Plan</label>
            <select class="field" id="plan_${dev.id}" onchange="updateDeviceCalc('${dev.id}')">${planOptions}</select>
          </div>
          <div class="form-group">
            <label class="field-label">Plazo</label>
            <select class="field" id="plazo_${dev.id}" onchange="updateDeviceCalc('${dev.id}')">${plazoOptions}</select>
          </div>
        </div>
        <div id="calc_${dev.id}"></div>
        <div class="device-vigencia"><strong>Vigencia:</strong> ${dev.vigencia}</div>
      </div>
    </div>
  `;
}

function toggleDevice(id) {
  const body = document.getElementById('body_' + id);
  const icon = document.getElementById('icon_' + id);
  const isOpen = body.classList.contains('open');
  body.classList.toggle('open');
  icon.textContent = isOpen ? '‚ñº' : '‚ñ≤';
  if (!isOpen) updateDeviceCalc(id);
}

function updateDeviceCalc(id) {
  const dev = state.devices.find(d => d.id === id);
  if (!dev) return;

  const planId = document.getElementById('plan_' + id).value;
  const plazo = parseInt(document.getElementById('plazo_' + id).value);
  const plan = ALL_PLANS.find(p => p.id === planId);
  const precioPromo = dev.pricing[planId]?.[plazo];
  const container = document.getElementById('calc_' + id);

  if (precioPromo === null || precioPromo === undefined || precioPromo === 'NA') {
    container.innerHTML = '<div class="not-available">Este equipo no est√° disponible en el plan y plazo seleccionados.</div>';
    return;
  }

  const ahorro = dev.precioContado - precioPromo;
  const mensual = precioPromo / plazo + plan.price;

  container.innerHTML = `
    <div class="device-calc">
      <div class="calc-row">
        <span>Precio promoci√≥n:</span>
        <span class="calc-val blue">$${precioPromo.toLocaleString('es-MX',{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
      </div>
      <div class="calc-row">
        <span>Ahorro:</span>
        <span class="calc-val green">$${ahorro.toLocaleString('es-MX',{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
      </div>
      <div class="calc-row total">
        <span>Equipo + Plan /mes:</span>
        <span class="calc-val big">$${mensual.toLocaleString('es-MX',{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
      </div>
      <button class="btn btn-primary" style="margin-top:10px" onclick="addItemFromDevice('${id}')">+ Agregar a cotizaci√≥n</button>
    </div>
  `;
}

// ============================================================
// ITEMS MANAGEMENT
// ============================================================
function addItemFromDevice(devId) {
  const dev = state.devices.find(d => d.id === devId);
  if (!dev) return;

  const planId = document.getElementById('plan_' + devId).value;
  const plazo = parseInt(document.getElementById('plazo_' + devId).value);
  const plan = ALL_PLANS.find(p => p.id === planId);
  const precioPromo = dev.pricing[planId]?.[plazo];

  if (precioPromo === null || precioPromo === undefined) return;

  state.items.push({
    id: Date.now() + Math.random(),
    equipo: dev.equipo,
    precioLista: dev.precioContado,
    precioPromo,
    planId,
    planNombre: plan.name,
    planPrecio: plan.price,
    plazo,
    enganchePct: 0,
    enganche: 0,
  });

  renderItems();
}

function validatePhone(input) {
  const hint = document.getElementById('phoneHint');
  const val = input.value.replace(/[^0-9]/g, '');
  if (val.length > 0 && val.length !== 10) {
    hint.style.display = 'block';
    input.style.borderColor = 'var(--danger)';
  } else {
    hint.style.display = 'none';
    input.style.borderColor = '';
  }
}

function removeItem(idx) {
  state.items.splice(idx, 1);
  renderItems();
}

function updateEnganche(idx, pct) {
  const item = state.items[idx];
  if (!item) return;
  const p = Math.max(0, Math.min(100, parseInt(pct) || 0));
  item.enganchePct = p;
  item.enganche = Math.round(item.precioPromo * p / 100 * 100) / 100;
  renderItems();
}

function renderItems() {
  const section = document.getElementById('itemsSection');
  const list = document.getElementById('itemsList');
  const title = document.getElementById('itemsTitle');

  if (state.items.length === 0) {
    section.style.display = 'none';
    return;
  }

  section.style.display = 'block';
  title.textContent = `Equipos en Cotizaci√≥n (${state.items.length})`;

  let html = '';
  state.items.forEach((item, idx) => {
    const ahorro = item.precioLista - item.precioPromo;
    const base = item.precioPromo - item.enganche;
    const mensual = base / item.plazo + item.planPrecio;

    html += `
      <div class="item-card">
        <div class="item-top">
          <div>
            <div class="item-name">${item.equipo}</div>
            <div class="item-plan">${item.planNombre} ¬∑ ${item.plazo} meses</div>
          </div>
          <button class="btn-danger-ghost" onclick="removeItem(${idx})">‚úï</button>
        </div>
        <div class="item-grid">
          <div class="item-detail">
            <span class="detail-label">Precio lista</span>
            <span>$${item.precioLista.toLocaleString('es-MX',{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
          </div>
          <div class="item-detail">
            <span class="detail-label">Promoci√≥n</span>
            <span style="color:var(--att-blue);font-weight:600">$${item.precioPromo.toLocaleString('es-MX',{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
          </div>
          <div class="item-detail">
            <span class="detail-label">Ahorro</span>
            <span style="color:var(--success);font-weight:600">$${ahorro.toLocaleString('es-MX',{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
          </div>
          <div class="item-detail">
            <span class="detail-label">Enganche %</span>
            <input class="field" type="number" min="0" max="100" value="${item.enganchePct}"
              style="width:60px;padding:4px 6px;font-size:13px;text-align:center"
              oninput="updateEnganche(${idx}, this.value)"
              onchange="updateEnganche(${idx}, this.value)">
          </div>
          <div class="item-detail">
            <span class="detail-label">Enganche $</span>
            <span>$${item.enganche.toLocaleString('es-MX',{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
          </div>
          <div class="item-detail" style="grid-column:1/-1">
            <span class="detail-label">Imagen del equipo</span>
            <div style="display:flex;align-items:center;gap:8px">
              ${item.imageData ? '<img src="'+item.imageData+'" style="width:36px;height:36px;object-fit:contain;border-radius:4px;border:1px solid var(--border)">' : ''}
              <label class="btn btn-sm btn-secondary" style="cursor:pointer;margin:0">
                ${item.imageData ? 'Cambiar' : 'üì∑ Agregar'}
                <input type="file" accept="image/*" style="display:none" onchange="addImageToItem(${idx}, this)">
              </label>
              ${item.imageData ? '<button class="btn-danger-ghost" style="font-size:14px" onclick="removeImageFromItem('+idx+')">‚úï</button>' : ''}
            </div>
          </div>
          <div class="item-detail total-row">
            <span class="detail-label">Equipo + Plan /mes</span>
            <strong style="font-size:16px;color:var(--att-blue)">$${mensual.toLocaleString('es-MX',{minimumFractionDigits:2,maximumFractionDigits:2})}</strong>
          </div>
        </div>
      </div>
    `;
  });

  list.innerHTML = html;
}

function addImageToItem(idx, input) {
  const file = input.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(e) {
    if (state.items[idx]) {
      state.items[idx].imageData = e.target.result;
      renderItems();
    }
  };
  reader.readAsDataURL(file);
}

function removeImageFromItem(idx) {
  if (state.items[idx]) {
    state.items[idx].imageData = null;
    renderItems();
  }
}

// ============================================================
// FOLIO GENERATOR - Format: AAMMDD-ATTUID-0001
// ============================================================
function generateFolio() {
  const now = new Date();
  const y = String(now.getFullYear()).slice(-2);
  const m = String(now.getMonth()+1).padStart(2,'0');
  const d = String(now.getDate()).padStart(2,'0');
  const datePart = y + m + d;
  const attuid = state.agente.attuid || 'XXXX';

  // Find the highest consecutive for this agent on this date
  const prefix = datePart + '-' + attuid + '-';
  let maxConsec = 0;
  state.cotizaciones.forEach(cot => {
    if (cot.folio && cot.folio.startsWith(prefix)) {
      const parts = cot.folio.split('-');
      const num = parseInt(parts[parts.length - 1]) || 0;
      if (num > maxConsec) maxConsec = num;
    }
  });

  const nextConsec = String(maxConsec + 1).padStart(4, '0');
  return prefix + nextConsec;
}

function formatDate(date) {
  return date.toLocaleDateString('es-MX', { day:'2-digit', month:'2-digit', year:'numeric' });
}

var selectedTemplate = 'classic';
function selectTemplate(tpl) {
  selectedTemplate = tpl;
  var pdfTpl = document.getElementById('pdfTemplate');
  if (pdfTpl) pdfTpl.value = tpl;
  var c1 = document.getElementById('tplCard1');
  var c2 = document.getElementById('tplCard2');
  if (!c1 || !c2) return;
  if (tpl === 'classic') {
    c1.style.border = '2.5px solid #0096D6';
    c1.style.background = '#f0f7ff';
    c1.style.boxShadow = '0 2px 8px rgba(0,150,214,0.2)';
    c2.style.border = '2px solid #d1d9e0';
    c2.style.background = 'white';
    c2.style.boxShadow = 'none';
  } else {
    c2.style.border = '2.5px solid #0096D6';
    c2.style.background = '#f0f7ff';
    c2.style.boxShadow = '0 2px 8px rgba(0,150,214,0.2)';
    c1.style.border = '2px solid #d1d9e0';
    c1.style.background = 'white';
    c1.style.boxShadow = 'none';
  }
}

// ============================================================
// PDF GENERATION
// ============================================================
async function generarCotizacion() {
  const nombre = document.getElementById('cliNombre').value.trim();
  const telefono = document.getElementById('cliTelefono').value.trim();
  const email = document.getElementById('cliEmail').value.trim();
  const direccion = document.getElementById('cliDireccion').value.trim();
  const planActualId = document.getElementById('cliPlanActual').value;
  const planActual = planActualId ? PLANS_ACTUALES.find(function(p){return p.id===planActualId}) : null;

  // Validate required fields
  const errors = [];
  if (!nombre) errors.push('Nombre del cliente');
  if (!telefono || telefono.length !== 10) errors.push('Tel√©fono (debe ser exactamente 10 d√≠gitos)');
  if (!email) errors.push('Email');
  if (!direccion) errors.push('Direcci√≥n');
  if (state.items.length === 0) errors.push('Agrega al menos un equipo');
  if (!state.agente.nombre) errors.push('Configura tu perfil de agente');

  if (errors.length > 0) {
    alert('Completa los siguientes campos:\n\n‚Ä¢ ' + errors.join('\n‚Ä¢ '));
    return;
  }

  // Validate email format
  if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
    alert('Ingresa un email v√°lido.');
    return;
  }

  const btn = document.getElementById('btnGenerar');
  btn.disabled = true;
  btn.textContent = '‚è≥ Generando...';

  try {
    const now = new Date();
    const diasValidez = parseInt(document.getElementById('cliValidez').value);
    const validoHasta = new Date(now.getTime() + diasValidez * 86400000);

    var isEditing = !!state.editingFolio;
    const folio = isEditing ? state.editingFolio : generateFolio();

    const cotizacion = {
      folio,
      fecha: isEditing ? (state.cotizaciones.find(c=>c.folio===folio)||{}).fecha || formatDate(now) : formatDate(now),
      validoHasta: formatDate(validoHasta),
      diasValidez,
      cliente: {
        nombre,
        direccion,
        email,
        telefono,
      },
      ejecutivo: { ...state.agente },
      planActual: planActual,
      items: state.items.map(it => ({...it, imageData: it.imageData || null})),
      estatus: isEditing ? (state.cotizaciones.find(c=>c.folio===folio)||{}).estatus || 'enviada' : 'enviada',
      agente_id: currentUser ? currentUser.id : null,
      createdAt: isEditing ? (state.cotizaciones.find(c=>c.folio===folio)||{}).createdAt || now.toISOString() : now.toISOString(),
      editedAt: isEditing ? now.toISOString() : undefined,
    };

    // Generate PDF based on selected template
    if (selectedTemplate === 'premium') {
      buildAndDownloadPDF_v2(cotizacion);
    } else {
      buildAndDownloadPDF(cotizacion);
    }

    // Save - update existing or add new
    if (isEditing) {
      const idx = state.cotizaciones.findIndex(c => c.folio === folio);
      if (idx >= 0) {
        state.cotizaciones[idx] = cotizacion;
      } else {
        state.cotizaciones.unshift(cotizacion);
      }
    } else {
      state.cotizaciones.unshift(cotizacion);
    }
    saveState();
    syncCotizacionToSupabase(cotizacion, isEditing);

    // Reset form
    document.getElementById('cliNombre').value = '';
    document.getElementById('cliDireccion').value = '';
    document.getElementById('cliEmail').value = '';
    document.getElementById('cliPlanActual').value = '';
    document.getElementById('cliTelefono').value = '';
    state.items = [];
    state.editingFolio = null;
    renderItems();
    document.getElementById('searchInput').value = '';
    document.getElementById('deviceResults').innerHTML = '';

    alert(isEditing ? '‚úÖ Cotizaci√≥n ' + folio + ' actualizada.' : '‚úÖ Cotizaci√≥n ' + folio + ' generada y guardada.');
  } catch(err) {
    alert('Error: ' + err.message);
    console.error(err);
  }

  btn.disabled = false;
  btn.textContent = 'üìÑ Generar Cotizaci√≥n PDF';
  state.editingFolio = null;
}

// ============================================================
// SHARED PDF HELPERS
// ============================================================
function addPlanComparison(doc, cot, mg, y, cW, H) {
  var pa = cot.planActual;
  if (!pa) return y;

  // Get the new plans from items
  var newPlans = [];
  cot.items.forEach(function(it) {
    var np = ALL_PLANS.find(function(p) { return p.id === it.planId; });
    if (np && !newPlans.find(function(n) { return n.id === np.id; })) {
      newPlans.push(np);
    }
  });
  if (newPlans.length === 0) return y;

  if (y > H - 50) { doc.addPage(); y = 16; }
  y += 4;

  // Title
  doc.setFillColor(0, 57, 93);
  doc.roundedRect(mg, y, cW, 7, 1.5, 1.5, 'F');
  doc.setTextColor(255,255,255);
  doc.setFontSize(8);
  doc.setFont('helvetica','bold');
  doc.text('COMPARATIVA DE PLAN', mg + cW/2, y + 5, { align: 'center' });
  y += 10;

  // Table header
  doc.setFillColor(240,245,250);
  doc.rect(mg, y, cW, 7, 'F');
  doc.setTextColor(0,57,93);
  doc.setFontSize(6.5);
  doc.setFont('helvetica','bold');
  var colW = cW / 4;
  doc.text('', mg + 2, y + 5);
  doc.text('Plan', mg + colW * 0.5, y + 5, { align: 'center' });
  doc.text('Datos', mg + colW * 1.5, y + 5, { align: 'center' });
  doc.text('Precio/mes', mg + colW * 2.5, y + 5, { align: 'center' });
  doc.text('Diferencia', mg + colW * 3.5, y + 5, { align: 'center' });
  y += 8;

  // Current plan row
  doc.setFillColor(255, 235, 235);
  doc.rect(mg, y, cW, 7, 'F');
  doc.setTextColor(150, 50, 50);
  doc.setFont('helvetica','normal');
  doc.setFontSize(6.5);
  doc.text('Actual', mg + 2, y + 5);
  doc.text(pa.name, mg + colW * 0.5, y + 5, { align: 'center' });
  doc.text(pa.gb, mg + colW * 1.5, y + 5, { align: 'center' });
  doc.text('$' + pa.price, mg + colW * 2.5, y + 5, { align: 'center' });
  doc.text('‚Äî', mg + colW * 3.5, y + 5, { align: 'center' });
  y += 8;

  // New plan rows
  newPlans.forEach(function(np) {
    if (y > H - 15) { doc.addPage(); y = 16; }
    doc.setFillColor(235, 255, 240);
    doc.rect(mg, y, cW, 7, 'F');
    doc.setTextColor(15, 120, 60);
    doc.setFont('helvetica','bold');
    doc.setFontSize(6.5);
    doc.text('Nuevo', mg + 2, y + 5);
    doc.text(np.name, mg + colW * 0.5, y + 5, { align: 'center' });
    doc.text(np.gb, mg + colW * 1.5, y + 5, { align: 'center' });
    doc.text('$' + np.price, mg + colW * 2.5, y + 5, { align: 'center' });
    var diff = np.price - pa.price;
    var gbOld = parseFloat(pa.gb) || 0;
    var gbNew = parseFloat(np.gb) || 0;
    var gbDiff = gbNew - gbOld;
    var diffText = (diff >= 0 ? '+$' + diff : '-$' + Math.abs(diff)) + ' | +' + gbDiff + 'GB';
    doc.text(diffText, mg + colW * 3.5, y + 5, { align: 'center' });
    y += 8;
  });

  // Impact phrase
  y += 3;
  doc.setFillColor(0, 57, 93);
  doc.roundedRect(mg, y, cW, 10, 1.5, 1.5, 'F');
  doc.setTextColor(255, 255, 255);
  doc.setFontSize(7);
  doc.setFont('helvetica','bold');
  doc.text('M√°s datos, m√°s velocidad, m√°s beneficios ‚Äî al mejor precio. ¬°Es el momento ideal para renovar!', mg + cW/2, y + 6.5, { align: 'center' });
  y += 14;

  return y;
}

function addTitanioMessage(doc, mg, y, cW, H) {
  if (y > H - 30) { doc.addPage(); y = 16; }
  y += 3;
  doc.setFillColor(230, 245, 255);
  doc.setDrawColor(0, 150, 214);
  doc.roundedRect(mg, y, cW, 18, 2, 2, 'FD');
  doc.setTextColor(0, 57, 93);
  doc.setFontSize(7);
  doc.setFont('helvetica','bold');
  doc.text('BENEFICIO PLAN TITANIO', mg + 4, y + 5.5);
  doc.setFont('helvetica','normal');
  doc.setFontSize(6);
  doc.setTextColor(50, 50, 50);
  var titanioText = 'Con el Plan Titanio puedes intercambiar tu dispositivo por el modelo nuevo transcurridos 12 meses, sujeto a una valoraci√≥n f√≠sica del equipo. ¬°Estrena iPhone nuevo cada a√±o!';
  var titanioLines = doc.splitTextToSize(titanioText, cW - 8);
  doc.text(titanioLines, mg + 4, y + 10);
  y += 20;
  return y;
}

function addPriceWarning(doc, mg, y, cW, H) {
  if (y > H - 25) { doc.addPage(); y = 16; }
  y += 3;
  doc.setFillColor(255, 243, 205);
  doc.setDrawColor(230, 162, 0);
  doc.roundedRect(mg, y, cW, 14, 2, 2, 'FD');
  doc.setTextColor(133, 100, 4);
  doc.setFontSize(6.5);
  doc.setFont('helvetica','bold');
  doc.text('AVISO IMPORTANTE', mg + 4, y + 5);
  doc.setFont('helvetica','normal');
  doc.setFontSize(5.5);
  var warningText = 'A partir de marzo 2026, el costo de todos los planes AT&T (nuevos y actuales) tendr√° un incremento. El ajuste aplica el 6 de marzo para planes Diamante, √Årmalo 17GB y 40GB, y el 13 de marzo para el resto de los planes.';
  var warnLines = doc.splitTextToSize(warningText, cW - 8);
  doc.text(warnLines, mg + 4, y + 9.5);
  y += 16;
  return y;
}

// ============================================================
// PDF CLASSIC
// ============================================================
function buildAndDownloadPDF(cot) {
  if (!pdfReady || !window.jspdf || !window.jspdf.jsPDF) {
    alert('Las librer√≠as de PDF no se cargaron. Recarga la p√°gina e intenta de nuevo.');
    return;
  }
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF('p','mm','letter');
  const W = doc.internal.pageSize.getWidth();
  const H = doc.internal.pageSize.getHeight();
  const mg = 15;
  const cW = W - mg*2;

  const BLUE = [0,150,214];
  const DARK = [30,42,56];
  const GBG = [245,247,250];
  const WHT = [255,255,255];

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HEADER (matches original exactly) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // Blue top bar
  doc.setFillColor(...BLUE);
  doc.rect(0, 0, W, 3, 'F');

  // AT&T logo - small globe + text
  try { doc.addImage(ATT_LOGO_B64, 'PNG', mg, 7, 16, 16); } catch(e) {}
  doc.setTextColor(100,110,120);
  doc.setFontSize(7);
  doc.setFont('helvetica','normal');
  doc.text('Distribuidor Autorizado', mg + 19, 16);

  // Client info
  var cx = 72;
  doc.setTextColor(100,110,120);
  doc.setFontSize(8);
  doc.setFont('helvetica','normal');
  doc.text('CLIENTE', cx, 8);
  doc.setTextColor(...DARK);
  doc.setFontSize(12);
  doc.setFont('helvetica','bold');
  doc.text(cot.cliente.nombre.toUpperCase(), cx, 14);
  doc.setFont('helvetica','normal');
  doc.setFontSize(7);
  doc.setTextColor(60,70,80);
  var hy = 18;
  if (cot.cliente.direccion) {
    var al = doc.splitTextToSize(cot.cliente.direccion.toUpperCase(), 70);
    doc.text(al, cx, hy);
    hy += al.length * 3;
  }
  var ct = [cot.cliente.email, cot.cliente.telefono].filter(Boolean).join(' \u00b7 ');
  if (ct) doc.text(ct, cx, hy);

  // Folio right
  doc.setTextColor(...BLUE);
  doc.setFontSize(8);
  doc.setFont('helvetica','bold');
  doc.text('FOLIO: ' + cot.folio, W-mg, 8, {align:'right'});
  doc.setTextColor(60,70,80);
  doc.setFont('helvetica','normal');
  doc.setFontSize(7);
  doc.text('Emitido: ' + cot.fecha, W-mg, 12, {align:'right'});
  doc.setFontSize(7);
  doc.text('Ejecutivo', W-mg, 17, {align:'right'});
  doc.setTextColor(...DARK);
  doc.setFont('helvetica','bold');
  doc.setFontSize(9);
  doc.text(cot.ejecutivo.nombre, W-mg, 21, {align:'right'});
  doc.setFont('helvetica','normal');
  doc.setFontSize(7);
  doc.setTextColor(60,70,80);
  doc.text('ATTUID: ' + cot.ejecutivo.attuid, W-mg, 25, {align:'right'});

  // Separator
  doc.setDrawColor(200,210,220);
  doc.setLineWidth(0.3);
  doc.line(mg, 28, W-mg, 28);

  var y = 33;

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê VALIDITY TEXT (like original: text on white, NOT blue bar) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  doc.setTextColor(...DARK);
  doc.setFontSize(9);
  doc.setFont('helvetica','normal');
  doc.text('V\u00e1lido hasta: ', mg, y);
  doc.setFont('helvetica','bold');
  doc.text(cot.validoHasta, mg + doc.getTextWidth('V\u00e1lido hasta: '), y);
  y += 6;

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TWO INFO BOXES (like original) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  var gap = 6;
  var bW = (cW - gap) / 2;
  var bH = 35;

  // LEFT BOX - Blue header + Validity info + ejecutivo
  doc.setDrawColor(200,210,220);
  doc.setLineWidth(0.3);
  doc.setFillColor(...WHT);
  doc.roundedRect(mg, y, bW, bH, 2, 2, 'FD');

  // Blue header for left box
  doc.setFillColor(...BLUE);
  doc.roundedRect(mg+0.15, y+0.15, bW-0.3, 6, 2, 2, 'F');
  doc.rect(mg+0.15, y+3.5, bW-0.3, 2.65, 'F');
  doc.setTextColor(...WHT);
  doc.setFontSize(7);
  doc.setFont('helvetica','bold');
  doc.text('DATOS DE LA COTIZACI\u00d3N', mg+4, y+4.5);

  doc.setTextColor(80,90,100);
  doc.setFontSize(8);
  doc.setFont('helvetica','normal');
  doc.text('Esta cotizaci\u00f3n tiene validez de:', mg+5, y+11);
  doc.setTextColor(...DARK);
  doc.setFontSize(18);
  doc.setFont('helvetica','bold');
  doc.text(cot.diasValidez + ' d\u00edas', mg+5, y+18);
  doc.setTextColor(60,70,80);
  doc.setFontSize(7);
  doc.setFont('helvetica','normal');
  doc.text('Emitida el ' + cot.fecha + ' por ' + cot.ejecutivo.nombre, mg+5, y+23);
  doc.text('(Ejecutivo AT&T).', mg+5, y+26.5);
  doc.setFont('helvetica','bolditalic');
  doc.text('\u00a1Gracias por su preferencia!', mg+5, y+30);

  // RIGHT BOX - Distribuidor + aviso privacidad
  var rx = mg + bW + gap;
  doc.setFillColor(...WHT);
  doc.roundedRect(rx, y, bW, bH, 2, 2, 'FD');

  // Blue header inside right box
  doc.setFillColor(...BLUE);
  doc.roundedRect(rx+0.15, y+0.15, bW-0.3, 6, 2, 2, 'F');
  doc.rect(rx+0.15, y+3.5, bW-0.3, 2.65, 'F');
  doc.setTextColor(...WHT);
  doc.setFontSize(7);
  doc.setFont('helvetica','bold');
  doc.text('DISTRIBUIDOR AUTORIZADO AT&T', rx+4, y+4.5);

  // Privacy text
  doc.setTextColor(90,100,110);
  doc.setFontSize(6.5);
  doc.setFont('helvetica','normal');
  var disc = 'En cumplimiento de la Ley Federal de Protecci\u00f3n de Datos Personales en Posesi\u00f3n de los Particulares y su Reglamento, AT&T Comunicaciones Digitales, S. de R. L. de C. V. y AT&T Comercializaci\u00f3n M\u00f3vil, S. de R. L. de C. V., con domicilio para o\u00edr y recibir documentos y notificaciones en R\u00edo Lerma no. 232, Torre Diana, Piso 20, Colonia Cuauht\u00e9moc, Alcald\u00eda Cuauht\u00e9moc, Ciudad de M\u00e9xico, C.P. 06500; como Responsable del Tratamiento de los Datos Personales que recaba, pone a tu disposici\u00f3n el presente Aviso de Privacidad.';
  doc.text(doc.splitTextToSize(disc, bW-8), rx+4, y+10);

  y += bH + 8;

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê EQUIPMENT TABLE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  doc.setTextColor(...DARK);
  doc.setFontSize(12);
  doc.setFont('helvetica','bold');
  doc.text('Resumen de equipos', mg, y);
  y += 3;

  var tD = cot.items.map(function(it) {
    var ah = it.precioLista - it.precioPromo;
    var base = it.precioPromo - it.enganche;
    var ep = base / it.plazo + it.planPrecio;
    var f = function(n) { return '$'+(Math.round(n*100)/100).toLocaleString('es-MX',{minimumFractionDigits:2,maximumFractionDigits:2}); };
    return [it.equipo, f(it.precioLista), f(it.precioPromo), f(ah), String(it.plazo), it.enganchePct+'%', f(it.enganche), it.planNombre, f(ep)];
  });

  var c0=cW*0.18, c1=cW*0.10, c2=cW*0.12, c3=cW*0.11, c4=cW*0.07, c5=cW*0.07, c6=cW*0.11, c7=cW*0.10;
  var c8=cW - c0 - c1 - c2 - c3 - c4 - c5 - c6 - c7;

  doc.autoTable({
    startY: y,
    head: [['EQUIPO','PRECIO\nLISTA','PROMOCI\u00d3N','AHORRO','PLAZO','% ENG','ENGANCHE','PLAN','EQUIPO\n+ PLAN']],
    body: tD,
    margin: { left: mg, right: mg },
    tableWidth: cW,
    styles: { fontSize:7, cellPadding:2.5, textColor:DARK, lineColor:[220,220,220], lineWidth:0.2, overflow:'linebreak' },
    headStyles: { fillColor:BLUE, textColor:WHT, fontStyle:'bold', fontSize:6.5, halign:'center', cellPadding:2 },
    columnStyles: {
      0:{cellWidth:c0},
      1:{halign:'right',cellWidth:c1},
      2:{halign:'right',cellWidth:c2},
      3:{halign:'right',cellWidth:c3},
      4:{halign:'center',cellWidth:c4},
      5:{halign:'center',cellWidth:c5},
      6:{halign:'right',cellWidth:c6},
      7:{halign:'center',cellWidth:c7},
      8:{halign:'right',cellWidth:c8},
    },
    alternateRowStyles: { fillColor: GBG },
    theme: 'grid',
  });
  y = doc.lastAutoTable.finalY + 8;

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PLANS TABLE (half width like original) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  var usedPlans = [];
  var seen = {};
  cot.items.forEach(function(i) { if (!seen[i.planId]) { seen[i.planId]=true; usedPlans.push(i.planId); } });
  var pD = usedPlans.map(function(pid) {
    var p = ALL_PLANS.find(function(pl) { return pl.id === pid; });
    if (!p) return null;
    return [p.name, '$'+p.price.toLocaleString('es-MX',{minimumFractionDigits:2,maximumFractionDigits:2}), p.gb];
  }).filter(Boolean);

  if (pD.length) {
    doc.setTextColor(...DARK);
    doc.setFontSize(12);
    doc.setFont('helvetica','bold');
    doc.text('Planes incluidos', mg, y);
    y += 3;

    doc.autoTable({
      startY: y,
      head: [['PLAN','COSTO','GB']],
      body: pD,
      margin: { left: mg, right: mg },
      tableWidth: cW,
      styles: { fontSize:8, cellPadding:3, textColor:DARK, lineColor:[220,220,220], lineWidth:0.2 },
      headStyles: { fillColor:BLUE, textColor:WHT, fontStyle:'bold' },
      columnStyles: { 0:{cellWidth:cW*0.35}, 1:{halign:'right',cellWidth:cW*0.35}, 2:{halign:'right',cellWidth:cW*0.30} },
      theme: 'grid',
    });
    y = doc.lastAutoTable.finalY + 8;
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê EQUIPMENT IMAGES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  var imgs = cot.items.filter(function(it) { return it.imageData; });
  if (imgs.length > 0) {
    if (y > H - 90) { doc.addPage(); y = 16; }
    var cardW = 80, cardH = 75, iGap = 10;
    var imgArea = cardW - 10;
    var perRow = Math.min(imgs.length, Math.floor((cW+iGap)/(cardW+iGap)));
    var rowW = perRow*cardW + (perRow-1)*iGap;
    var sx = mg + (cW-rowW)/2, ix = sx;
    imgs.forEach(function(it, idx) {
      if (idx>0 && idx%perRow===0) { ix=sx; y+=cardH+5; }
      if (y+cardH > H-18) { doc.addPage(); y=16; ix=sx; }
      doc.setFillColor(250,251,253); doc.setDrawColor(210,218,226);
      doc.roundedRect(ix, y, cardW, cardH, 3, 3, 'FD');
      // Draw image preserving aspect ratio inside imgArea x imgArea square
      try {
        var img = new Image();
        img.src = it.imageData;
        var natW = img.width || imgArea;
        var natH = img.height || imgArea;
        var ratio = Math.min(imgArea / natW, (cardH-22) / natH);
        var drawW = natW * ratio;
        var drawH = natH * ratio;
        var imgX = ix + (cardW - drawW) / 2;
        var imgY = y + 4 + ((cardH-22) - drawH) / 2;
        doc.addImage(it.imageData, 'JPEG', imgX, imgY, drawW, drawH);
      } catch(e) {}
      doc.setFontSize(6); doc.setFont('helvetica','bold'); doc.setTextColor(...DARK);
      var lb = it.equipo;
      if (doc.getTextWidth(lb)>cardW-4) { while(doc.getTextWidth(lb+'...')>cardW-6&&lb.length>5) lb=lb.slice(0,-1); lb+='...'; }
      doc.text(lb, ix+cardW/2, y+cardH-10, {align:'center'});
      doc.setFontSize(5); doc.setFont('helvetica','normal'); doc.setTextColor(...BLUE);
      doc.text(it.planNombre+' \u00b7 '+it.plazo+'m', ix+cardW/2, y+cardH-5.5, {align:'center'});
      ix += cardW+iGap;
    });
    y += cardH + 5;
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PLAN COMPARISON (if plan actual selected) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  if (cot.planActual) {
    y = addPlanComparison(doc, cot, mg, y, cW, H);
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TITANIO MESSAGE (if any item is Titanio) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  var hasTitanio = cot.items.some(function(it) { return it.planId === 'titanio' || it.planNombre === 'Titanio'; });
  if (hasTitanio) {
    y = addTitanioMessage(doc, mg, y, cW, H);
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê WHATSAPP PER-ITEM LINKS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  var wa = cot.ejecutivo.whatsapp;
  if (wa && wa.length >= 10) {
    y += 2;
    if (y > H - 25) { doc.addPage(); y = 16; }
    doc.setTextColor(0,57,93);
    doc.setFontSize(8);
    doc.setFont('helvetica','bold');
    var ctaLines = doc.splitTextToSize('\u00bfCu\u00e1l te interesa? Toca la opci\u00f3n que prefieras y env\u00eda copia o foto de tu INE por ambos lados:', cW);
    doc.text(ctaLines, mg, y);
    y += (ctaLines.length - 1) * 3.5;
    y += 5;
    cot.items.forEach(function(it, idx) {
      if (y > H - 22) { doc.addPage(); y = 16; }
      var base = it.precioPromo - (it.enganche||0);
      var ep = base / it.plazo + it.planPrecio;
      var btnW = cW;
      var btnH = 8;
      // Green rounded pill
      doc.setFillColor(0,159,219);
      doc.roundedRect(mg, y, btnW, btnH, 2, 2, 'F');
      doc.setTextColor(255,255,255);
      doc.setFontSize(7);
      doc.setFont('helvetica','bold');
      doc.text(it.equipo + '  \u00b7  Plan ' + it.planNombre + '  \u00b7  ' + it.plazo + 'm  \u00b7  $' + Math.round(ep*100)/100 + '/mes', mg + 4, y + 5.2);
      // Link
      var waMsg = 'Hola ' + cot.ejecutivo.nombre + ', me interesa la cotizaci\u00f3n ' + cot.folio + '.\n\nQuiero iniciar el tr\u00e1mite con:\n\n\u2705 ' + it.equipo + '\nPlan: ' + it.planNombre + '\nPlazo: ' + it.plazo + ' meses\nMensual: $' + Math.round(ep*100)/100 + '\n\nTe comparto mi INE \ud83d\udcf7 (' + cot.ejecutivo.nombre + ')';
      doc.link(mg, y, btnW, btnH, {url: 'https://wa.me/52' + wa + '?text=' + encodeURIComponent(waMsg)});
      y += btnH + 2;
    });
    // "Cotizar otro modelo" button
    var btnW = cW, btnH = 8;
    if (y > H - 22) { doc.addPage(); y = 16; }
    doc.setFillColor(255,255,255);
    doc.setDrawColor(0,159,219);
    doc.setLineWidth(0.4);
    doc.roundedRect(mg, y, btnW, btnH, 2, 2, 'FD');
    doc.setTextColor(0,159,219);
    doc.setFontSize(7);
    doc.setFont('helvetica','bold');
    doc.text('Me interesa otro modelo, \u00bfqu\u00e9 opciones tienes?', mg + 4, y + 5.2);
    var waOtro = 'Hola ' + cot.ejecutivo.nombre + ', vi la cotizaci\u00f3n ' + cot.folio + ' pero me gustar\u00eda ver otras opciones de equipos. \u00bfQu\u00e9 m\u00e1s me puedes ofrecer?';
    doc.link(mg, y, btnW, btnH, {url: 'https://wa.me/52' + wa + '?text=' + encodeURIComponent(waOtro)});
    y += btnH + 4;
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PRICE INCREASE WARNING (at bottom) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  y = addPriceWarning(doc, mg, y, cW, H);

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FOOTER (like original: AT&T logo + blue bar) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  try { doc.addImage(ATT_LOGO_B64, 'PNG', mg, H-15, 11, 11); } catch(e) {}

  // Blue bar from after logo to right edge
  var barX = mg + 18;
  var barW = W - mg - barX;
  doc.setFillColor(...BLUE);
  doc.roundedRect(barX, H-12.5, barW, 9, 2, 2, 'F');
  doc.setTextColor(...WHT);
  doc.setFontSize(9);
  doc.setFont('helvetica','bold');
  doc.text('V\u00e1lido hasta: ' + cot.validoHasta, W-mg-5, H-6.5, {align:'right'});

  doc.save('cotizacion_' + cot.folio.replace(/[^a-zA-Z0-9-]/g,'') + '.pdf');
}

// ============================================================
// PDF V2 - PREMIUM EXECUTIVE DESIGN
// ============================================================
function buildAndDownloadPDF_v2(cot) {
  if (!pdfReady || !window.jspdf || !window.jspdf.jsPDF) {
    alert('Las librer\u00edas de PDF no se cargaron.');
    return;
  }
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF('p','mm','letter');
  const W = doc.internal.pageSize.getWidth();
  const H = doc.internal.pageSize.getHeight();
  const mg = 12;
  const cW = W - mg*2;

  var D1 = [15,23,42];
  var D2 = [30,41,59];
  var AC = [56,189,248];
  var AC2 = [14,165,233];
  var WH = [255,255,255];
  var G1 = [248,250,252];
  var G2 = [226,232,240];
  var G3 = [148,163,184];
  var G4 = [71,85,105];

  // ===== DARK HEADER =====
  doc.setFillColor(...D1);
  doc.rect(0, 0, W, 38, 'F');
  doc.setFillColor(...D2);
  doc.rect(0, 0, 58, 38, 'F');

  // AT&T text logo (no image - clean integration)
  doc.setTextColor(...WH);
  doc.setFontSize(16);
  doc.setFont('helvetica','bold');
  doc.text('AT&T', mg+5, 14);
  doc.setTextColor(...AC);
  doc.setFontSize(7);
  doc.setFont('helvetica','bold');
  doc.text('EXPERTCELL', mg+5, 20);
  doc.setTextColor(100,116,139);
  doc.setFontSize(5);
  doc.setFont('helvetica','normal');
  doc.text('Distribuidor Autorizado', mg+5, 24.5);

  // Center title
  doc.setTextColor(...WH);
  doc.setFontSize(18);
  doc.setFont('helvetica','bold');
  doc.text('COTIZACI\u00d3N', W/2, 14, {align:'center'});
  doc.setFillColor(...AC);
  doc.rect(W/2-20, 17, 40, 0.8, 'F');
  doc.setTextColor(...AC);
  doc.setFontSize(8);
  doc.setFont('helvetica','bold');
  doc.text(cot.folio, W/2, 23, {align:'center'});
  doc.setTextColor(...G3);
  doc.setFontSize(6);
  doc.setFont('helvetica','normal');
  doc.text(cot.fecha + '  \u00b7  V\u00e1lido ' + cot.diasValidez + ' d\u00edas hasta ' + cot.validoHasta, W/2, 27.5, {align:'center'});

  // Right - Ejecutivo
  doc.setTextColor(...G3);
  doc.setFontSize(5);
  doc.setFont('helvetica','normal');
  doc.text('EJECUTIVO', W-mg-3, 8, {align:'right'});
  doc.setTextColor(...WH);
  doc.setFontSize(8);
  doc.setFont('helvetica','bold');
  doc.text(cot.ejecutivo.nombre, W-mg-3, 13, {align:'right'});
  doc.setTextColor(...G3);
  doc.setFontSize(6);
  doc.setFont('helvetica','normal');
  doc.text(cot.ejecutivo.attuid, W-mg-3, 17.5, {align:'right'});

  // Cyan edge
  doc.setFillColor(...AC);
  doc.rect(0, 37, W, 1.2, 'F');

  var y = 43;

  // ===== CLIENT CARD =====
  doc.setFillColor(...G1);
  doc.setDrawColor(...G2);
  doc.setLineWidth(0.25);
  doc.roundedRect(mg, y, cW, 18, 2.5, 2.5, 'FD');

  doc.setTextColor(...D1);
  doc.setFontSize(10);
  doc.setFont('helvetica','bold');
  doc.text(cot.cliente.nombre.toUpperCase(), mg+6, y+6);
  doc.setTextColor(...G4);
  doc.setFontSize(6.5);
  doc.setFont('helvetica','normal');
  if (cot.cliente.direccion) doc.text(cot.cliente.direccion, mg+6, y+10);
  var cInfo = [cot.cliente.email, cot.cliente.telefono].filter(Boolean).join(' \u00b7 ');
  if (cInfo) doc.text(cInfo, mg+6, y+14);

  // Validity text (clear, not cryptic)
  doc.setTextColor(...AC2);
  doc.setFontSize(6);
  doc.setFont('helvetica','bold');
  doc.text('VIGENCIA DE LA PROMOCI\u00d3N', W-mg-5, y+5, {align:'right'});
  doc.setTextColor(...D1);
  doc.setFontSize(12);
  doc.setFont('helvetica','bold');
  doc.text(cot.diasValidez + ' d\u00edas', W-mg-5, y+11, {align:'right'});
  doc.setTextColor(...G3);
  doc.setFontSize(5.5);
  doc.setFont('helvetica','normal');
  doc.text('Hasta el ' + cot.validoHasta, W-mg-5, y+15, {align:'right'});

  y += 23;

  // ===== SECTION: EQUIPOS =====
  doc.setFillColor(...D1);
  doc.roundedRect(mg, y, cW, 7, 1.5, 1.5, 'F');
  doc.setTextColor(...WH);
  doc.setFontSize(8);
  doc.setFont('helvetica','bold');
  doc.text('RESUMEN DE EQUIPOS', mg+5, y+4.8);
  doc.setTextColor(...AC);
  doc.setFontSize(6);
  doc.text(cot.items.length + ' equipo' + (cot.items.length>1?'s':''), W-mg-4, y+4.8, {align:'right'});
  y += 10;

  var tD = cot.items.map(function(it) {
    var ah = it.precioLista - it.precioPromo;
    var base = it.precioPromo - it.enganche;
    var ep = base / it.plazo + it.planPrecio;
    var f = function(n) { return '$'+(Math.round(n*100)/100).toLocaleString('es-MX',{minimumFractionDigits:2,maximumFractionDigits:2}); };
    return [it.equipo, f(it.precioLista), f(it.precioPromo), f(ah), String(it.plazo), it.enganchePct+'%', f(it.enganche), it.planNombre, f(ep)];
  });

  var c0=cW*0.18, c1=cW*0.10, c2=cW*0.12, c3=cW*0.11, c4=cW*0.07, c5=cW*0.07, c6=cW*0.11, c7=cW*0.10;
  var c8=cW - c0 - c1 - c2 - c3 - c4 - c5 - c6 - c7;

  doc.autoTable({
    startY: y,
    head: [['EQUIPO','PRECIO\nLISTA','PROMOCI\u00d3N','AHORRO','PLAZO','% ENG','ENGANCHE','PLAN','EQUIPO\n+ PLAN']],
    body: tD,
    margin: { left: mg, right: mg },
    tableWidth: cW,
    styles: { fontSize:6.5, cellPadding:2.5, textColor:D1, lineColor:G2, lineWidth:0.15, overflow:'linebreak' },
    headStyles: { fillColor:D2, textColor:WH, fontStyle:'bold', fontSize:6, halign:'center', cellPadding:2.5 },
    columnStyles: {
      0:{cellWidth:c0}, 1:{halign:'right',cellWidth:c1}, 2:{halign:'right',cellWidth:c2},
      3:{halign:'right',cellWidth:c3}, 4:{halign:'center',cellWidth:c4}, 5:{halign:'center',cellWidth:c5},
      6:{halign:'right',cellWidth:c6}, 7:{halign:'center',cellWidth:c7}, 8:{halign:'right',cellWidth:c8},
    },
    alternateRowStyles: { fillColor: G1 },
    theme: 'grid',
    didParseCell: function(data) {
      if (data.section === 'body' && data.column.index === 8) {
        data.cell.styles.fontStyle = 'bold';
        data.cell.styles.textColor = AC2;
      }
      if (data.section === 'body' && data.column.index === 3) {
        data.cell.styles.textColor = [16,185,129];
      }
    },
  });
  y = doc.lastAutoTable.finalY + 6;

  // ===== SECTION: PLANES =====
  var usedPlans = [];
  var seen = {};
  cot.items.forEach(function(i) { if (!seen[i.planId]) { seen[i.planId]=true; usedPlans.push(i.planId); } });
  var pD = usedPlans.map(function(pid) {
    var p = ALL_PLANS.find(function(pl) { return pl.id === pid; });
    if (!p) return null;
    return [p.name, '$'+p.price.toLocaleString('es-MX',{minimumFractionDigits:2,maximumFractionDigits:2}), p.gb];
  }).filter(Boolean);

  if (pD.length) {
    doc.setFillColor(...D1);
    doc.roundedRect(mg, y, cW, 7, 1.5, 1.5, 'F');
    doc.setTextColor(...WH);
    doc.setFontSize(8);
    doc.setFont('helvetica','bold');
    doc.text('PLANES INCLUIDOS', mg+5, y+4.8);
    y += 10;

    doc.autoTable({
      startY: y,
      head: [['PLAN','COSTO MENSUAL','DATOS INCLUIDOS']],
      body: pD,
      margin: { left: mg, right: mg },
      tableWidth: cW,
      styles: { fontSize:8, cellPadding:3, textColor:D1, lineColor:G2, lineWidth:0.15 },
      headStyles: { fillColor:D2, textColor:WH, fontStyle:'bold' },
      columnStyles: { 0:{cellWidth:cW*0.30}, 1:{halign:'right',cellWidth:cW*0.35}, 2:{halign:'center',cellWidth:cW*0.35} },
      alternateRowStyles: { fillColor: G1 },
      theme: 'grid',
    });
    y = doc.lastAutoTable.finalY + 8;
  }

  // ===== EQUIPMENT IMAGES =====
  var imgs = cot.items.filter(function(it) { return it.imageData; });
  if (imgs.length > 0) {
    if (y > H - 90) { doc.addPage(); y = 16; }
    var cardW = 80, cardH = 75, iGap = 10;
    var perRow = Math.min(imgs.length, Math.floor((cW+iGap)/(cardW+iGap)));
    var rowW = perRow*cardW + (perRow-1)*iGap;
    var sx = mg + (cW-rowW)/2, ix = sx;
    imgs.forEach(function(it, idx) {
      if (idx>0 && idx%perRow===0) { ix=sx; y+=cardH+5; }
      if (y+cardH > H-25) { doc.addPage(); y=16; ix=sx; }
      doc.setFillColor(230,232,238);
      doc.roundedRect(ix+1.5, y+1.5, cardW, cardH, 4, 4, 'F');
      doc.setFillColor(...WH);
      doc.setDrawColor(...G2);
      doc.roundedRect(ix, y, cardW, cardH, 4, 4, 'FD');
      doc.setFillColor(...AC);
      doc.rect(ix+15, y, cardW-30, 0.6, 'F');
      try {
        var img = new Image();
        img.src = it.imageData;
        var natW = img.width || 70;
        var natH = img.height || 53;
        var ratio = Math.min((cardW-14) / natW, (cardH-26) / natH);
        var drawW = natW * ratio;
        var drawH = natH * ratio;
        doc.addImage(it.imageData, 'JPEG', ix+(cardW-drawW)/2, y+4+((cardH-26)-drawH)/2, drawW, drawH);
      } catch(e) {}
      doc.setFontSize(6); doc.setFont('helvetica','bold'); doc.setTextColor(...D1);
      var lb = it.equipo;
      if (doc.getTextWidth(lb)>cardW-4) { while(doc.getTextWidth(lb+'...')>cardW-6&&lb.length>5) lb=lb.slice(0,-1); lb+='...'; }
      doc.text(lb, ix+cardW/2, y+cardH-10, {align:'center'});
      doc.setFontSize(5); doc.setFont('helvetica','normal'); doc.setTextColor(...AC2);
      doc.text(it.planNombre+' \u00b7 '+it.plazo+'m', ix+cardW/2, y+cardH-5, {align:'center'});
      ix += cardW+iGap;
    });
    y += cardH + 5;
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PLAN COMPARISON (if plan actual selected) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  if (cot.planActual) {
    y = addPlanComparison(doc, cot, mg, y, cW, H);
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TITANIO MESSAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  var hasTitanio2 = cot.items.some(function(it) { return it.planId === 'titanio' || it.planNombre === 'Titanio'; });
  if (hasTitanio2) {
    y = addTitanioMessage(doc, mg, y, cW, H);
  }

  // ===== WHATSAPP PER-ITEM LINKS =====
  var wa = cot.ejecutivo.whatsapp;
  if (wa && wa.length >= 10) {
    y += 2;
    if (y > H - 25) { doc.addPage(); y = 16; }
    doc.setTextColor(0,57,93);
    doc.setFontSize(8);
    doc.setFont('helvetica','bold');
    var ctaLines = doc.splitTextToSize('\u00bfCu\u00e1l te interesa? Toca la opci\u00f3n que prefieras y env\u00eda copia o foto de tu INE por ambos lados:', cW);
    doc.text(ctaLines, mg, y);
    y += (ctaLines.length - 1) * 3.5;
    y += 5;
    cot.items.forEach(function(it, idx) {
      if (y > H - 22) { doc.addPage(); y = 16; }
      var base = it.precioPromo - (it.enganche||0);
      var ep = base / it.plazo + it.planPrecio;
      var btnW = cW;
      var btnH = 8;
      doc.setFillColor(0,159,219);
      doc.roundedRect(mg, y, btnW, btnH, 2, 2, 'F');
      doc.setTextColor(255,255,255);
      doc.setFontSize(7);
      doc.setFont('helvetica','bold');
      doc.text(it.equipo + '  \u00b7  Plan ' + it.planNombre + '  \u00b7  ' + it.plazo + 'm  \u00b7  $' + Math.round(ep*100)/100 + '/mes', mg + 4, y + 5.2);
      var waMsg = 'Hola ' + cot.ejecutivo.nombre + ', me interesa la cotizaci\u00f3n ' + cot.folio + '.\n\nQuiero iniciar el tr\u00e1mite con:\n\n\u2705 ' + it.equipo + '\nPlan: ' + it.planNombre + '\nPlazo: ' + it.plazo + ' meses\nMensual: $' + Math.round(ep*100)/100 + '\n\nTe comparto mi INE \ud83d\udcf7 (' + cot.ejecutivo.nombre + ')';
      doc.link(mg, y, btnW, btnH, {url: 'https://wa.me/52' + wa + '?text=' + encodeURIComponent(waMsg)});
      y += btnH + 2;
    });
    // "Cotizar otro modelo" button
    var btnW = cW, btnH = 8;
    if (y > H - 22) { doc.addPage(); y = 16; }
    doc.setFillColor(255,255,255);
    doc.setDrawColor(...AC);
    doc.setLineWidth(0.4);
    doc.roundedRect(mg, y, btnW, btnH, 2, 2, 'FD');
    doc.setTextColor(...AC2);
    doc.setFontSize(7);
    doc.setFont('helvetica','bold');
    doc.text('Me interesa otro modelo, \u00bfqu\u00e9 opciones tienes?', mg + 4, y + 5.2);
    var waOtro = 'Hola ' + cot.ejecutivo.nombre + ', vi la cotizaci\u00f3n ' + cot.folio + ' pero me gustar\u00eda ver otras opciones de equipos. \u00bfQu\u00e9 m\u00e1s me puedes ofrecer?';
    doc.link(mg, y, btnW, btnH, {url: 'https://wa.me/52' + wa + '?text=' + encodeURIComponent(waOtro)});
    y += btnH + 4;
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PRICE INCREASE WARNING (at bottom) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  y = addPriceWarning(doc, mg, y, cW, H);

  // ===== FOOTER =====
  doc.setFillColor(...D1);
  doc.rect(0, H-16, W, 16, 'F');
  doc.setFillColor(...AC);
  doc.rect(0, H-16, W, 0.6, 'F');

  doc.setTextColor(...WH);
  doc.setFontSize(8);
  doc.setFont('helvetica','bold');
  doc.text('AT&T', mg+4, H-7);
  doc.setTextColor(...G3);
  doc.setFontSize(5);
  doc.setFont('helvetica','normal');
  doc.text('ExpertCell \u00b7 Distribuidor Autorizado', mg+18, H-7);
  doc.setTextColor(80,95,115);
  doc.setFontSize(3.8);
  doc.text('Aviso de Privacidad disponible en att.com.mx', W/2, H-4, {align:'center'});

  doc.setFillColor(...AC2);
  doc.roundedRect(W-mg-46, H-12, 44, 7, 2, 2, 'F');
  doc.setTextColor(...WH);
  doc.setFontSize(7);
  doc.setFont('helvetica','bold');
  doc.text('Hasta: ' + cot.validoHasta, W-mg-24, H-7.5, {align:'center'});

  doc.save('cotizacion_premium_' + cot.folio.replace(/[^a-zA-Z0-9-]/g,'') + '.pdf');
}



// ============================================================
// HISTORIAL WITH ROLE FILTERS
// ============================================================
var hFilterUsers = []; // cached users for historial filters

async function initHistorialFilters() {
  if (!supabase || !currentUser) return;
  var filtersDiv = document.getElementById('historialRoleFilters');
  var rol = currentUser.rol;

  // Only show filters for roles that see other people's cotizaciones
  if (rol === 'agente') {
    filtersDiv.style.display = 'none';
    return;
  }

  filtersDiv.style.display = 'flex';

  // Load users
  try {
    var { data } = await supabase.from('usuarios').select('*, centros(nombre, ciudad)').eq('activo', true).order('nombre');
    hFilterUsers = data || [];
  } catch(e) { hFilterUsers = []; }

  // Load centros
  var centroSel = document.getElementById('hFilterCentro');
  var coordSel = document.getElementById('hFilterCoord');
  var supSel = document.getElementById('hFilterSup');
  var agenteSel = document.getElementById('hFilterAgente');

  // Show/hide dropdowns based on role
  centroSel.style.display = (rol === 'admin') ? '' : 'none';
  coordSel.style.display = (rol === 'admin') ? '' : 'none';
  supSel.style.display = (rol === 'admin' || rol === 'coordinador') ? '' : 'none';
  agenteSel.style.display = (rol === 'admin' || rol === 'coordinador' || rol === 'supervisor') ? '' : 'none';

  // Fill centros (admin only)
  if (rol === 'admin') {
    var centros = [];
    var seenC = {};
    hFilterUsers.forEach(function(u) {
      if (u.centros && !seenC[u.centro_id]) {
        seenC[u.centro_id] = true;
        centros.push({ id: u.centro_id, nombre: u.centros.nombre, ciudad: u.centros.ciudad });
      }
    });
    centroSel.innerHTML = '<option value="all">Todos los centros</option>';
    centros.forEach(function(c) {
      centroSel.innerHTML += '<option value="'+c.id+'">'+c.nombre+' ('+c.ciudad+')</option>';
    });
  }

  // Initial populate cascading dropdowns
  populateCoordFilter();
}

function populateCoordFilter() {
  var rol = currentUser.rol;
  if (rol !== 'admin') return;
  var centroVal = document.getElementById('hFilterCentro').value;
  var coordSel = document.getElementById('hFilterCoord');
  var coords = hFilterUsers.filter(function(u) {
    if (u.rol !== 'coordinador') return false;
    if (centroVal !== 'all' && u.centro_id !== parseInt(centroVal)) return false;
    return true;
  });
  coordSel.innerHTML = '<option value="all">Todos los coordinadores</option>';
  coords.forEach(function(u) {
    coordSel.innerHTML += '<option value="'+u.id+'">'+u.nombre+'</option>';
  });
  populateSupFilter();
}

function populateSupFilter() {
  var rol = currentUser.rol;
  var centroVal = document.getElementById('hFilterCentro').value;
  var coordVal = document.getElementById('hFilterCoord').value;
  var supSel = document.getElementById('hFilterSup');
  var sups = hFilterUsers.filter(function(u) {
    if (u.rol !== 'supervisor') return false;
    if (centroVal !== 'all' && u.centro_id !== parseInt(centroVal)) return false;
    if (coordVal !== 'all' && u.coordinador_id !== coordVal) return false;
    if (rol === 'coordinador' && u.coordinador_id !== currentUser.id) return false;
    return true;
  });
  supSel.innerHTML = '<option value="all">Todos los supervisores</option>';
  sups.forEach(function(u) {
    supSel.innerHTML += '<option value="'+u.id+'">'+u.nombre+'</option>';
  });
  populateAgenteFilter();
}

function populateAgenteFilter() {
  var rol = currentUser.rol;
  var centroVal = document.getElementById('hFilterCentro').value;
  var coordVal = document.getElementById('hFilterCoord').value;
  var supVal = document.getElementById('hFilterSup').value;
  var agenteSel = document.getElementById('hFilterAgente');
  var agentes = hFilterUsers.filter(function(u) {
    if (u.rol !== 'agente') return false;
    if (centroVal !== 'all' && u.centro_id !== parseInt(centroVal)) return false;
    if (coordVal !== 'all' && u.coordinador_id !== coordVal) return false;
    if (supVal !== 'all' && u.supervisor_id !== supVal) return false;
    if (rol === 'coordinador' && u.coordinador_id !== currentUser.id) return false;
    if (rol === 'supervisor' && u.supervisor_id !== currentUser.id) return false;
    return true;
  });
  agenteSel.innerHTML = '<option value="all">Todos los agentes</option>';
  agentes.forEach(function(u) {
    agenteSel.innerHTML += '<option value="'+u.id+'">'+u.nombre+' ('+u.attuid+')</option>';
  });
  renderHistorial();
}

function onHFilterCentroChange() { populateCoordFilter(); }
function onHFilterCoordChange() { populateSupFilter(); }
function onHFilterSupChange() { populateAgenteFilter(); }

function getFilteredAgentIds() {
  var rol = currentUser.rol;
  if (rol === 'agente') return [currentUser.id];

  var centroVal = document.getElementById('hFilterCentro').value;
  var coordVal = document.getElementById('hFilterCoord').value;
  var supVal = document.getElementById('hFilterSup').value;
  var agenteVal = document.getElementById('hFilterAgente').value;

  // If specific agent selected
  if (agenteVal !== 'all') return [agenteVal];

  // If ALL filters are "all" - no filtering needed
  if (centroVal === 'all' && coordVal === 'all' && supVal === 'all') {
    if (rol === 'admin') return null; // show everything
  }

  // Filter users to get matching agent IDs
  var ids = hFilterUsers.filter(function(u) {
    if (centroVal !== 'all' && u.centro_id !== parseInt(centroVal)) return false;
    if (coordVal !== 'all' && u.coordinador_id !== coordVal) return false;
    if (supVal !== 'all' && u.supervisor_id !== supVal) return false;
    if (rol === 'coordinador' && u.coordinador_id !== currentUser.id) return false;
    if (rol === 'supervisor' && u.supervisor_id !== currentUser.id) return false;
    return true;
  }).map(function(u) { return u.id; });

  // Also include supervisors/coordinators who might have made cotizaciones themselves
  if (supVal !== 'all') ids.push(supVal);
  if (coordVal !== 'all') ids.push(coordVal);

  return ids.length > 0 ? ids : null;
}

var SUB_ESTATUS_LABELS = {
  espera_pago: 'En espera de pago inicial',
  falta_biometrico: 'Falta biom√©trico',
  falta_ine: 'Falta INE',
  falta_contrato: 'Falta contrato firmado',
  aceleracion: 'Aceleraci√≥n pendiente',
  renovo_otro: 'Renov√≥ en otro lado',
  no_responde: 'Ya no responde',
  prefiere_tienda: 'Prefiere ir a tienda',
  pago_rechazado: 'Pago inicial rechazado',
  desconfianza: 'Desconfianza tr√°mite en l√≠nea',
  confirmada: 'Venta confirmada ‚úÖ',
  no_confirmada: 'No confirmada ‚ö†Ô∏è',
};
function subEstatusLabel(code) { return SUB_ESTATUS_LABELS[code] || code || ''; }

function renderHistorial() {
  const filterRow = document.getElementById('filterRow');
  const list = document.getElementById('historialList');
  const searchInput = document.getElementById('historialSearch');
  const searchTerm = searchInput ? searchInput.value.toLowerCase().trim() : '';
  const statuses = ['all','enviada','seguimiento','venta','perdida'];
  const labels = { all:'Todas', enviada:'Enviada', seguimiento:'Seguimiento', venta:'Venta Exitosa', perdida:'Perdida' };

  // Apply role-based filter
  var agentIds = getFilteredAgentIds();
  var roleFiltered = state.cotizaciones;
  if (agentIds) {
    roleFiltered = state.cotizaciones.filter(function(c) {
      var cAgentId = c.agente_id || (currentUser ? currentUser.id : null);
      return agentIds.indexOf(cAgentId) !== -1;
    });
  }

  // Apply search filter
  let searchFiltered = roleFiltered;
  if (searchTerm) {
    searchFiltered = roleFiltered.filter(c => {
      return c.cliente.nombre.toLowerCase().includes(searchTerm) ||
        (c.cliente.telefono && c.cliente.telefono.includes(searchTerm)) ||
        c.folio.toLowerCase().includes(searchTerm) ||
        (c.cliente.email && c.cliente.email.toLowerCase().includes(searchTerm)) ||
        (c.ejecutivo && c.ejecutivo.nombre && c.ejecutivo.nombre.toLowerCase().includes(searchTerm));
    });
  }

  filterRow.innerHTML = statuses.map(s => {
    const count = s === 'all' ? searchFiltered.length : searchFiltered.filter(c => c.estatus === s).length;
    const active = state.filterEstatus === s ? ' active' : '';
    return `<button class="filter-btn${active}" onclick="filterHistorial('${s}')">${labels[s]} <span class="filter-count">${count}</span></button>`;
  }).join('');

  const filtered = searchFiltered.filter(c =>
    state.filterEstatus === 'all' || c.estatus === state.filterEstatus
  );

  if (filtered.length === 0) {
    list.innerHTML = '<div class="empty-state">No hay cotizaciones con estos filtros.</div>';
    return;
  }

  list.innerHTML = '<div class="historial-list">' + filtered.map(cot => `
    <div class="historial-card" onclick="showDetalle('${cot.folio}')">
      <div class="historial-top">
        <span class="historial-folio">${cot.folio}</span>
        <span class="badge badge-${cot.estatus}">${{enviada:'Enviada',seguimiento:'Seguimiento',venta:'Venta Exitosa',perdida:'Perdida'}[cot.estatus]||cot.estatus}</span>
      </div>
      <div class="historial-body">
        <span class="historial-client">${cot.cliente.nombre}</span>
        <span class="historial-meta">${cot.cliente.telefono || ''} ¬∑ ${cot.items.length} equipo(s) ¬∑ ${cot.fecha}</span>
        <span class="historial-meta">Ejecutivo: ${cot.ejecutivo ? cot.ejecutivo.nombre : 'N/A'}${cot.sub_estatus ? ' ¬∑ ' + subEstatusLabel(cot.sub_estatus) : ''}${cot.folio_att ? ' ¬∑ Folio ATT: ' + cot.folio_att : ''}${cot.sub_estatus==='aceleracion' && cot.fecha_fin_plazo ? ' ¬∑ Plazo: ' + cot.fecha_fin_plazo + (new Date(cot.fecha_fin_plazo+'T00:00:00') <= new Date() ? ' üö® VENCIDO' : '') : ''}</span>
      </div>
    </div>
  `).join('') + '</div>';
}

function filterHistorial(est) {
  state.filterEstatus = est;
  renderHistorial();
}

// ============================================================
// DETALLE
// ============================================================
function showDetalle(folio) {
  const cot = state.cotizaciones.find(c => c.folio === folio);
  if (!cot) return;
  state.selectedCotizacion = cot;

  const container = document.getElementById('detalleContent');
  container.innerHTML = `
    <div class="detalle-top">
      <div class="detalle-info">
        <h3>${cot.cliente.nombre}</h3>
        <p class="detalle-meta">${[cot.cliente.telefono, cot.cliente.email].filter(Boolean).join(' ¬∑ ')}</p>
        <p class="detalle-meta">${cot.cliente.direccion || ''}</p>
        <p class="detalle-meta">Fecha: ${cot.fecha} ¬∑ V√°lido hasta: ${cot.validoHasta}</p>
        <p class="detalle-meta">Ejecutivo: ${cot.ejecutivo.nombre} (${cot.ejecutivo.attuid})</p>
      </div>
      <div class="detalle-actions">
        <div class="estatus-row" style="display:flex;flex-direction:column;gap:6px;width:100%">
          <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
            <label class="field-label" style="margin:0">Estatus:</label>
            <select class="field" style="width:160px" id="detalleEstatus_${cot.folio}" onchange="onEstatusChange('${cot.folio}')">
              <option value="enviada" ${cot.estatus==='enviada'?'selected':''}>Enviada</option>
              <option value="seguimiento" ${cot.estatus==='seguimiento'?'selected':''}>Seguimiento</option>
              <option value="venta" ${cot.estatus==='venta'?'selected':''}>Venta Exitosa</option>
              <option value="perdida" ${cot.estatus==='perdida'?'selected':''}>Perdida</option>
            </select>
          </div>
          <div id="subEstatusRow_${cot.folio}" style="display:none;flex-direction:column;gap:6px">
            <div id="subSeguimiento_${cot.folio}" style="display:none">
              <label class="field-label">Motivo seguimiento:</label>
              <select class="field" id="subSeg_${cot.folio}" style="width:100%" onchange="onSubSegChange('${cot.folio}')">
                <option value="">Selecciona...</option>
                <option value="espera_pago" ${cot.sub_estatus==='espera_pago'?'selected':''}>En espera de pago inicial</option>
                <option value="falta_biometrico" ${cot.sub_estatus==='falta_biometrico'?'selected':''}>Falta biom√©trico</option>
                <option value="falta_ine" ${cot.sub_estatus==='falta_ine'?'selected':''}>Falta INE</option>
                <option value="falta_contrato" ${cot.sub_estatus==='falta_contrato'?'selected':''}>Falta contrato firmado</option>
                <option value="aceleracion" ${cot.sub_estatus==='aceleracion'?'selected':''}>Aceleraci√≥n pendiente</option>
              </select>
              <div id="subAceleracion_${cot.folio}" style="display:${cot.sub_estatus==='aceleracion'?'block':'none'};margin-top:8px;background:var(--surface-2);padding:10px;border-radius:8px">
                <div style="background:#FFF3CD;border:1px solid #E6A200;border-radius:6px;padding:8px;margin-bottom:8px">
                  <div style="font-size:11px;color:#856404;line-height:1.4">
                    <strong>‚ö†Ô∏è Recuerda:</strong> La fecha en que tu cliente quedar√° libre en AVS es la fecha de su corte posterior al d√≠a en que termin√≥ su contrato.<br>
                    <strong>Ejemplo:</strong> Si un cliente termin√≥ contrato el 14/02/26 y su corte son los d√≠as 2, entonces su fecha real de finalizaci√≥n de plazo ser√° el 02/03/26.
                  </div>
                </div>
                <label class="field-label">Fecha de finalizaci√≥n de plazo:</label>
                <input type="date" class="field" id="fechaFinPlazo_${cot.folio}" value="${cot.fecha_fin_plazo||''}" style="width:100%">
                <label class="field-label" style="margin-top:6px">Estatus de INE:</label>
                <select class="field" id="tieneIne_${cot.folio}" style="width:100%">
                  <option value="">Selecciona...</option>
                  <option value="con_ine" ${cot.tiene_ine==='con_ine'?'selected':''}>Ya cuento con el INE</option>
                  <option value="sin_ine" ${cot.tiene_ine==='sin_ine'?'selected':''}>Prospecto sin INE</option>
                </select>
              </div>
            </div>
            <div id="subPerdida_${cot.folio}" style="display:none">
              <label class="field-label">Motivo de p√©rdida:</label>
              <select class="field" id="subPer_${cot.folio}" style="width:100%">
                <option value="">Selecciona...</option>
                <option value="renovo_otro" ${cot.sub_estatus==='renovo_otro'?'selected':''}>Cliente renov√≥ en otro lado</option>
                <option value="no_responde" ${cot.sub_estatus==='no_responde'?'selected':''}>Ya no responde</option>
                <option value="prefiere_tienda" ${cot.sub_estatus==='prefiere_tienda'?'selected':''}>Prefiere ir a una tienda</option>
                <option value="pago_rechazado" ${cot.sub_estatus==='pago_rechazado'?'selected':''}>Pago inicial rechazado por el cliente</option>
                <option value="desconfianza" ${cot.sub_estatus==='desconfianza'?'selected':''}>Desconfianza de tr√°mite en l√≠nea</option>
              </select>
            </div>
            <div id="subVenta_${cot.folio}" style="display:none">
              <label class="field-label">Folio AT&T (obligatorio):</label>
              <input class="field" id="folioAtt_${cot.folio}" placeholder="Folio de la plataforma AT&T" value="${cot.folio_att||''}" style="width:100%">
            </div>
          </div>
          <button class="btn btn-primary" style="width:auto;font-size:12px" onclick="guardarEstatus('${cot.folio}')">üíæ Guardar Estatus</button>
        </div>
        <div style="display:flex;gap:6px;margin-top:8px">
          <button class="btn btn-secondary" onclick="editCotizacion('${cot.folio}')">‚úèÔ∏è Editar</button>
          <button class="btn btn-secondary" onclick="buildAndDownloadPDF(state.selectedCotizacion)">üìÑ Descargar PDF</button>
        </div>
      </div>
    </div>
    <div class="section">
      <div class="section-title">Equipos cotizados</div>
      ${cot.items.map(item => {
        const base = item.precioPromo - (item.enganche||0);
        const mensual = base / item.plazo + item.planPrecio;
        return `
          <div class="detalle-item">
            <div class="detalle-item-name">${item.equipo}</div>
            <div class="detalle-item-grid">
              <span>Plan: ${item.planNombre}</span>
              <span>Plazo: ${item.plazo}m</span>
              <span>Promoci√≥n: $${item.precioPromo.toLocaleString('es-MX',{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
              <span>Enganche: $${(item.enganche||0).toLocaleString('es-MX',{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
              <span style="color:var(--att-blue);font-weight:700">Mensual: $${mensual.toLocaleString('es-MX',{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
            </div>
          </div>
        `;
      }).join('')}
    </div>
  `;

  showView('detalle', 'Cotizaci√≥n ' + cot.folio);
  setTimeout(function() { onEstatusChange(cot.folio, true); }, 50);
}

function onEstatusChange(folio, init) {
  var est = document.getElementById('detalleEstatus_' + folio).value;
  var subRow = document.getElementById('subEstatusRow_' + folio);
  var subSeg = document.getElementById('subSeguimiento_' + folio);
  var subPer = document.getElementById('subPerdida_' + folio);
  var subVenta = document.getElementById('subVenta_' + folio);

  subRow.style.display = 'flex';
  subSeg.style.display = est === 'seguimiento' ? '' : 'none';
  subPer.style.display = est === 'perdida' ? '' : 'none';
  subVenta.style.display = est === 'venta' ? '' : 'none';

  if (est === 'enviada') subRow.style.display = 'none';
}

function onSubSegChange(folio) {
  var val = document.getElementById('subSeg_' + folio).value;
  var acDiv = document.getElementById('subAceleracion_' + folio);
  if (acDiv) acDiv.style.display = val === 'aceleracion' ? 'block' : 'none';
}

async function guardarEstatus(folio) {
  var est = document.getElementById('detalleEstatus_' + folio).value;
  var subEstatus = '';
  var folioAtt = '';
  var fechaFinPlazo = '';
  var tieneIne = '';

  if (est === 'seguimiento') {
    subEstatus = document.getElementById('subSeg_' + folio).value;
    if (!subEstatus) { alert('Selecciona el motivo de seguimiento.'); return; }
    if (subEstatus === 'aceleracion') {
      fechaFinPlazo = document.getElementById('fechaFinPlazo_' + folio).value;
      tieneIne = document.getElementById('tieneIne_' + folio).value;
      if (!fechaFinPlazo) { alert('La fecha de finalizaci√≥n de plazo es obligatoria para aceleraci√≥n.'); return; }
      if (!tieneIne) { alert('Selecciona el estatus de INE.'); return; }
    }
  } else if (est === 'perdida') {
    subEstatus = document.getElementById('subPer_' + folio).value;
    if (!subEstatus) { alert('Selecciona el motivo de p√©rdida.'); return; }
  } else if (est === 'venta') {
    folioAtt = document.getElementById('folioAtt_' + folio).value.trim();
    if (!folioAtt) { alert('El folio AT&T es obligatorio para ventas exitosas.'); return; }
  }

  // Update local
  var cot = state.cotizaciones.find(function(c) { return c.folio === folio; });
  if (cot) {
    cot.estatus = est;
    cot.sub_estatus = subEstatus;
    cot.folio_att = folioAtt;
    cot.fecha_fin_plazo = fechaFinPlazo;
    cot.tiene_ine = tieneIne;
    saveState();
  }

  // Update Supabase
  if (supabase) {
    try {
      await supabase.from('cotizaciones').update({
        estatus: est,
        sub_estatus: subEstatus || null,
        folio_att: folioAtt || null,
        fecha_fin_plazo: fechaFinPlazo || null,
        tiene_ine: tieneIne || null,
      }).eq('folio', folio);
      console.log('Estatus updated:', folio, est, subEstatus, folioAtt);
    } catch(e) { console.error(e); }
  }

  alert('Estatus actualizado: ' + {enviada:'Enviada', seguimiento:'Seguimiento', venta:'Venta Exitosa', perdida:'Perdida'}[est]);
  showDetalle(folio);
}

// ============================================================
// EDIT COTIZACI√ìN
// ============================================================
function editCotizacion(folio) {
  const cot = state.cotizaciones.find(c => c.folio === folio);
  if (!cot) return;

  if (!state.fileLoaded) {
    alert('Necesitas cargar la lista de precios primero para poder editar equipos.');
    return;
  }

  // Switch to cotizar view
  showView('cotizar', 'Editando: ' + cot.folio);

  // Fill client data
  document.getElementById('cliNombre').value = cot.cliente.nombre;
  document.getElementById('cliTelefono').value = cot.cliente.telefono || '';
  document.getElementById('cliEmail').value = cot.cliente.email || '';
  document.getElementById('cliDireccion').value = cot.cliente.direccion || '';
  document.getElementById('cliValidez').value = cot.diasValidez || 7;

  // Load items
  state.items = cot.items.map(function(it) { return {...it}; });
  renderItems();

  // Set edit mode
  state.editingFolio = cot.folio;

  // Update button text
  var btn = document.getElementById('btnGenerar');
  btn.innerHTML = 'üìÑ Actualizar Cotizaci√≥n PDF';
}

// ============================================================
// DASHBOARD
// ============================================================
var dashUsers = [];

async function openDashboard() {
  showView('dashboard', 'Dashboard');
  if (!supabase) return;

  // Load users for filters
  try {
    var { data } = await supabase.from('usuarios').select('*, centros(nombre, ciudad)').eq('activo', true).order('nombre');
    dashUsers = data || [];
  } catch(e) { dashUsers = []; }

  // Populate filters based on role
  var rol = currentUser.rol;
  var centroSel = document.getElementById('dashFilterCentro');
  var coordSel = document.getElementById('dashFilterCoord');
  var supSel = document.getElementById('dashFilterSup');
  var agenteSel = document.getElementById('dashFilterAgente');

  centroSel.style.display = rol === 'admin' ? '' : 'none';
  coordSel.style.display = rol === 'admin' ? '' : 'none';
  supSel.style.display = (rol === 'admin' || rol === 'coordinador') ? '' : 'none';
  agenteSel.style.display = rol !== 'agente' ? '' : 'none';

  if (rol === 'admin') {
    var centros = {};
    dashUsers.forEach(function(u) { if (u.centros) centros[u.centro_id] = u.centros; });
    centroSel.innerHTML = '<option value="all">Todos los centros</option>';
    Object.keys(centros).forEach(function(id) {
      centroSel.innerHTML += '<option value="'+id+'">'+centros[id].nombre+'</option>';
    });
  }

  onDashFilterChange();
}

function onDashFilterChange() {
  var rol = currentUser.rol;
  var centroVal = document.getElementById('dashFilterCentro').value;
  var coordSel = document.getElementById('dashFilterCoord');
  var supSel = document.getElementById('dashFilterSup');
  var agenteSel = document.getElementById('dashFilterAgente');

  if (rol === 'admin') {
    var coords = dashUsers.filter(function(u) {
      return u.rol === 'coordinador' && (centroVal === 'all' || u.centro_id === parseInt(centroVal));
    });
    coordSel.innerHTML = '<option value="all">Todos los coordinadores</option>';
    coords.forEach(function(u) { coordSel.innerHTML += '<option value="'+u.id+'">'+u.nombre+'</option>'; });
  }

  var coordVal = document.getElementById('dashFilterCoord').value;
  var sups = dashUsers.filter(function(u) {
    if (u.rol !== 'supervisor') return false;
    if (centroVal !== 'all' && u.centro_id !== parseInt(centroVal)) return false;
    if (coordVal !== 'all' && u.coordinador_id !== coordVal) return false;
    if (rol === 'coordinador' && u.coordinador_id !== currentUser.id) return false;
    return true;
  });
  supSel.innerHTML = '<option value="all">Todos los supervisores</option>';
  sups.forEach(function(u) { supSel.innerHTML += '<option value="'+u.id+'">'+u.nombre+'</option>'; });

  var supVal = document.getElementById('dashFilterSup').value;
  var agentes = dashUsers.filter(function(u) {
    if (u.rol !== 'agente') return false;
    if (centroVal !== 'all' && u.centro_id !== parseInt(centroVal)) return false;
    if (coordVal !== 'all' && u.coordinador_id !== coordVal) return false;
    if (supVal !== 'all' && u.supervisor_id !== supVal) return false;
    if (rol === 'coordinador' && u.coordinador_id !== currentUser.id) return false;
    if (rol === 'supervisor' && u.supervisor_id !== currentUser.id) return false;
    return true;
  });
  agenteSel.innerHTML = '<option value="all">Todos los agentes</option>';
  agentes.forEach(function(u) { agenteSel.innerHTML += '<option value="'+u.id+'">'+u.nombre+'</option>'; });

  renderDashboard();
}

function getDashFilteredCots() {
  var rol = currentUser.rol;
  var centroVal = document.getElementById('dashFilterCentro').value;
  var coordVal = document.getElementById('dashFilterCoord').value;
  var supVal = document.getElementById('dashFilterSup').value;
  var agenteVal = document.getElementById('dashFilterAgente').value;
  var periodo = document.getElementById('dashFilterPeriodo').value;

  // Get matching agent IDs
  var agentIds = null;
  if (agenteVal !== 'all') {
    agentIds = [agenteVal];
  } else if (rol === 'agente') {
    agentIds = [currentUser.id];
  } else if (centroVal === 'all' && coordVal === 'all' && supVal === 'all' && rol === 'admin') {
    agentIds = null;
  } else {
    agentIds = dashUsers.filter(function(u) {
      if (centroVal !== 'all' && u.centro_id !== parseInt(centroVal)) return false;
      if (coordVal !== 'all' && u.coordinador_id !== coordVal) return false;
      if (supVal !== 'all' && u.supervisor_id !== supVal) return false;
      if (rol === 'coordinador' && u.coordinador_id !== currentUser.id) return false;
      if (rol === 'supervisor' && u.supervisor_id !== currentUser.id) return false;
      return true;
    }).map(function(u) { return u.id; });
  }

  var cots = state.cotizaciones;
  if (agentIds) {
    cots = cots.filter(function(c) { return agentIds.indexOf(c.agente_id) !== -1; });
  }

  // Period filter
  if (periodo !== 'all') {
    var now = new Date();
    var cutoff, cutoffEnd;
    if (periodo === 'hoy') {
      cutoff = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    } else if (periodo === 'semana') {
      cutoff = new Date(now.getTime() - 7 * 86400000);
    } else if (periodo === 'mes') {
      cutoff = new Date(now.getFullYear(), now.getMonth(), 1);
    } else if (periodo === 'mes_anterior') {
      cutoff = new Date(now.getFullYear(), now.getMonth() - 1, 1);
      cutoffEnd = new Date(now.getFullYear(), now.getMonth(), 1);
    } else if (periodo === 'rango') {
      var desde = document.getElementById('dashFechaDesde').value;
      var hasta = document.getElementById('dashFechaHasta').value;
      if (desde) cutoff = new Date(desde + 'T00:00:00');
      if (hasta) cutoffEnd = new Date(hasta + 'T23:59:59');
    } else {
      // Month names: ene=0, feb=1, etc
      var meses = { ene:0, feb:1, mar:2, abr:3, may:4, jun:5, jul:6, ago:7, sep:8, oct:9, nov:10, dic:11 };
      if (meses[periodo] !== undefined) {
        var m = meses[periodo];
        var yr = m <= now.getMonth() ? now.getFullYear() : now.getFullYear() - 1;
        cutoff = new Date(yr, m, 1);
        cutoffEnd = new Date(yr, m + 1, 1);
      }
    }
    cots = cots.filter(function(c) {
      var d = c.createdAt ? new Date(c.createdAt) : null;
      if (!d) return false;
      if (cutoff && d < cutoff) return false;
      if (cutoffEnd && d >= cutoffEnd) return false;
      return true;
    });
  }

  return cots;
}

function onDashPeriodoChange() {
  var val = document.getElementById('dashFilterPeriodo').value;
  var rangoDiv = document.getElementById('dashRangoFechas');
  rangoDiv.style.display = val === 'rango' ? 'flex' : 'none';
  if (val !== 'rango') renderDashboard();
}

function renderDashboard() {
  var cots = getDashFilteredCots();
  var total = cots.length;
  var enviadas = cots.filter(function(c) { return c.estatus === 'enviada'; }).length;
  var seguimiento = cots.filter(function(c) { return c.estatus === 'seguimiento'; }).length;
  var ventas = cots.filter(function(c) { return c.estatus === 'venta'; }).length;
  var perdidas = cots.filter(function(c) { return c.estatus === 'perdida'; }).length;
  var conversion = total > 0 ? ((ventas / total) * 100).toFixed(1) : '0.0';

  var confirmadas = cots.filter(function(c) { return c.estatus === 'venta' && c.sub_estatus === 'confirmada'; }).length;
  var noConfirmadas = cots.filter(function(c) { return c.estatus === 'venta' && c.sub_estatus === 'no_confirmada'; }).length;
  var sinCruzar = ventas - confirmadas - noConfirmadas;
  var pctConf = ventas > 0 ? ((confirmadas / ventas) * 100).toFixed(0) : '‚Äî';
  var confColor = ventas === 0 ? 'var(--text-3)' : confirmadas === ventas ? '#0FA958' : noConfirmadas > 0 ? '#DC3545' : '#E6A200';

  // KPI cards
  document.getElementById('dashKpis').innerHTML = `
    <div class="kpi-card">
      <div class="kpi-value">${total}</div>
      <div class="kpi-label">Total Cotizaciones</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-value" style="color:#0FA958">${ventas}</div>
      <div class="kpi-label">Ventas Exitosas</div>
      <div class="kpi-sub">${confirmadas} ‚úÖ ¬∑ ${noConfirmadas} ‚ö†Ô∏è ¬∑ ${sinCruzar} sin cruzar</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-value" style="color:${confColor}">${pctConf}%</div>
      <div class="kpi-label">Confirmaci√≥n de Ventas</div>
      <div class="kpi-sub">${confirmadas} de ${ventas} confirmadas</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-value">${conversion}%</div>
      <div class="kpi-label">Tasa de Conversi√≥n</div>
      <div class="kpi-sub">${ventas} de ${total}</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-value" style="color:#E6A200">${seguimiento}</div>
      <div class="kpi-label">En Seguimiento</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-value" style="color:#DC3545">${perdidas}</div>
      <div class="kpi-label">Perdidas</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-value" style="color:var(--att-blue)">${enviadas}</div>
      <div class="kpi-label">Enviadas (sin gesti√≥n)</div>
    </div>
  `;

  // Funnel
  var maxF = Math.max(total, 1);
  var funnelColors = { total:'#009FDB', enviada:'#67B7DC', seguimiento:'#E6A200', venta:'#0FA958', perdida:'#DC3545' };
  document.getElementById('dashFunnel').innerHTML = [
    { label:'Cotizadas', count:total, color:funnelColors.total },
    { label:'Enviadas', count:enviadas, color:funnelColors.enviada },
    { label:'En Seguimiento', count:seguimiento, color:funnelColors.seguimiento },
    { label:'Venta Exitosa', count:ventas, color:funnelColors.venta },
    { label:'Perdidas', count:perdidas, color:funnelColors.perdida },
  ].map(function(f) {
    var pct = Math.max((f.count / maxF) * 100, 4);
    return '<div class="funnel-bar"><span class="funnel-label">' + f.label + '</span><div class="funnel-fill" style="width:' + pct + '%;background:' + f.color + '">' + f.count + '</div></div>';
  }).join('');

  // Motivos de p√©rdida
  var perdidaCots = cots.filter(function(c) { return c.estatus === 'perdida' && c.sub_estatus; });
  var perdidaCounts = {};
  perdidaCots.forEach(function(c) {
    perdidaCounts[c.sub_estatus] = (perdidaCounts[c.sub_estatus] || 0) + 1;
  });
  var maxPer = Math.max.apply(null, Object.values(perdidaCounts).concat([1]));
  var perHtml = Object.keys(perdidaCounts).length === 0 ? '<div style="font-size:12px;color:var(--text-3)">Sin datos</div>' : '';
  Object.keys(perdidaCounts).sort(function(a, b) { return perdidaCounts[b] - perdidaCounts[a]; }).forEach(function(k) {
    var pct = (perdidaCounts[k] / maxPer) * 100;
    perHtml += '<div class="breakdown-row"><span>' + subEstatusLabel(k) + '</span><div class="breakdown-bar"><div class="breakdown-bar-fill" style="width:' + pct + '%;background:#DC3545"></div></div><span style="font-weight:700">' + perdidaCounts[k] + '</span></div>';
  });
  document.getElementById('dashPerdidas').innerHTML = perHtml;

  // Seguimiento pendiente
  var segCots = cots.filter(function(c) { return c.estatus === 'seguimiento' && c.sub_estatus; });
  var segCounts = {};
  segCots.forEach(function(c) {
    segCounts[c.sub_estatus] = (segCounts[c.sub_estatus] || 0) + 1;
  });
  var maxSeg = Math.max.apply(null, Object.values(segCounts).concat([1]));
  var segHtml = Object.keys(segCounts).length === 0 ? '<div style="font-size:12px;color:var(--text-3)">Sin datos</div>' : '';
  Object.keys(segCounts).sort(function(a, b) { return segCounts[b] - segCounts[a]; }).forEach(function(k) {
    var pct = (segCounts[k] / maxSeg) * 100;
    segHtml += '<div class="breakdown-row"><span>' + subEstatusLabel(k) + '</span><div class="breakdown-bar"><div class="breakdown-bar-fill" style="width:' + pct + '%;background:#E6A200"></div></div><span style="font-weight:700">' + segCounts[k] + '</span></div>';
  });
  document.getElementById('dashSeguimiento').innerHTML = segHtml;

  // Ranking de agentes
  var agentStats = {};
  cots.forEach(function(c) {
    var aid = c.agente_id || 'unknown';
    if (!agentStats[aid]) {
      agentStats[aid] = { nombre: (c.ejecutivo ? c.ejecutivo.nombre : 'N/A'), total: 0, ventas: 0 };
    }
    agentStats[aid].total++;
    if (c.estatus === 'venta') agentStats[aid].ventas++;
  });
  var ranking = Object.keys(agentStats).map(function(k) { return agentStats[k]; })
    .sort(function(a, b) { return b.ventas - a.ventas || b.total - a.total; });

  var rankHtml = ranking.length === 0 ? '<div style="font-size:12px;color:var(--text-3)">Sin datos</div>' : '';
  ranking.slice(0, 15).forEach(function(r, i) {
    var posClass = i === 0 ? 'gold' : i === 1 ? 'silver' : i === 2 ? 'bronze' : '';
    var conv = r.total > 0 ? ((r.ventas / r.total) * 100).toFixed(0) : '0';
    rankHtml += '<div class="rank-row">';
    rankHtml += '<div class="rank-pos ' + posClass + '">' + (i + 1) + '</div>';
    rankHtml += '<div style="flex:1"><div style="font-weight:700;font-size:13px">' + r.nombre + '</div>';
    rankHtml += '<div style="font-size:11px;color:var(--text-3)">' + r.ventas + ' ventas de ' + r.total + ' cotizaciones ¬∑ ' + conv + '% conversi√≥n</div>';
    rankHtml += '</div></div>';
  });
  document.getElementById('dashRanking').innerHTML = rankHtml;
}

// ============================================================
// EXPORT DASHBOARD
// ============================================================
function getExportData() {
  var cots = getDashFilteredCots();
  var periodo = document.getElementById('dashFilterPeriodo');
  var periodoLabel = periodo.options[periodo.selectedIndex].text;

  var rows = cots.map(function(c) {
    var subLabel = c.sub_estatus ? subEstatusLabel(c.sub_estatus) : '';
    var estatusLabel = {enviada:'Enviada', seguimiento:'Seguimiento', venta:'Venta Exitosa', perdida:'Perdida'}[c.estatus] || c.estatus;
    return {
      'Folio': c.folio,
      'Fecha': c.fecha,
      'Cliente': c.cliente.nombre,
      'Tel√©fono': c.cliente.telefono || '',
      'Email': c.cliente.email || '',
      'Ejecutivo': c.ejecutivo ? c.ejecutivo.nombre : 'N/A',
      'ATTUID': c.ejecutivo ? c.ejecutivo.attuid : '',
      'Estatus': estatusLabel,
      'Subtipificaci√≥n': subLabel,
      'Folio ATT': c.folio_att || '',
      'Equipos': c.items.map(function(it) { return it.equipo; }).join(', '),
      'Planes': c.items.map(function(it) { return it.planNombre; }).join(', '),
      'Creado': c.createdAt ? new Date(c.createdAt).toLocaleString('es-MX') : '',
    };
  });

  // Summary stats
  var total = cots.length;
  var ventas = cots.filter(function(c) { return c.estatus === 'venta'; }).length;
  var confirmadas = cots.filter(function(c) { return c.estatus === 'venta' && c.sub_estatus === 'confirmada'; }).length;
  var noConfirmadas = cots.filter(function(c) { return c.estatus === 'venta' && c.sub_estatus === 'no_confirmada'; }).length;
  var seguimiento = cots.filter(function(c) { return c.estatus === 'seguimiento'; }).length;
  var perdidas = cots.filter(function(c) { return c.estatus === 'perdida'; }).length;
  var enviadas = cots.filter(function(c) { return c.estatus === 'enviada'; }).length;
  var conversion = total > 0 ? ((ventas / total) * 100).toFixed(1) : '0';
  var pctConf = ventas > 0 ? ((confirmadas / ventas) * 100).toFixed(1) : '‚Äî';

  return { rows, total, ventas, confirmadas, noConfirmadas, seguimiento, perdidas, enviadas, conversion, pctConf, periodoLabel };
}

function exportDashExcel() {
  var d = getExportData();
  var wb = XLSX.utils.book_new();

  // Sheet 1: Resumen
  var resumen = [
    ['REPORTE EXPERTCELL - COTIZADOR AT&T'],
    ['Periodo: ' + d.periodoLabel, 'Generado: ' + new Date().toLocaleString('es-MX')],
    [],
    ['M√âTRICA', 'VALOR'],
    ['Total Cotizaciones', d.total],
    ['Ventas Exitosas', d.ventas],
    ['  - Confirmadas', d.confirmadas],
    ['  - No Confirmadas', d.noConfirmadas],
    ['% Confirmaci√≥n', d.pctConf + '%'],
    ['Tasa de Conversi√≥n', d.conversion + '%'],
    ['En Seguimiento', d.seguimiento],
    ['Perdidas', d.perdidas],
    ['Enviadas (sin gesti√≥n)', d.enviadas],
  ];

  // Subtipificaciones de p√©rdida
  var perdidaCots = getDashFilteredCots().filter(function(c) { return c.estatus === 'perdida' && c.sub_estatus; });
  var perdidaCounts = {};
  perdidaCots.forEach(function(c) { perdidaCounts[c.sub_estatus] = (perdidaCounts[c.sub_estatus] || 0) + 1; });
  if (Object.keys(perdidaCounts).length > 0) {
    resumen.push([]);
    resumen.push(['MOTIVOS DE P√âRDIDA', 'CANTIDAD']);
    Object.keys(perdidaCounts).forEach(function(k) {
      resumen.push([subEstatusLabel(k), perdidaCounts[k]]);
    });
  }

  // Subtipificaciones de seguimiento
  var segCots = getDashFilteredCots().filter(function(c) { return c.estatus === 'seguimiento' && c.sub_estatus; });
  var segCounts = {};
  segCots.forEach(function(c) { segCounts[c.sub_estatus] = (segCounts[c.sub_estatus] || 0) + 1; });
  if (Object.keys(segCounts).length > 0) {
    resumen.push([]);
    resumen.push(['SEGUIMIENTO PENDIENTE', 'CANTIDAD']);
    Object.keys(segCounts).forEach(function(k) {
      resumen.push([subEstatusLabel(k), segCounts[k]]);
    });
  }

  var wsResumen = XLSX.utils.aoa_to_sheet(resumen);
  wsResumen['!cols'] = [{ wch: 30 }, { wch: 20 }];
  XLSX.utils.book_append_sheet(wb, wsResumen, 'Resumen');

  // Sheet 2: Detalle
  var wsDetalle = XLSX.utils.json_to_sheet(d.rows);
  wsDetalle['!cols'] = [
    { wch: 22 }, { wch: 12 }, { wch: 25 }, { wch: 14 }, { wch: 22 },
    { wch: 25 }, { wch: 10 }, { wch: 16 }, { wch: 28 }, { wch: 15 },
    { wch: 35 }, { wch: 20 }, { wch: 18 },
  ];
  XLSX.utils.book_append_sheet(wb, wsDetalle, 'Detalle Cotizaciones');

  var fileName = 'Reporte_ExpertCell_' + new Date().toISOString().slice(0,10) + '.xlsx';
  XLSX.writeFile(wb, fileName);
}

function exportDashPDF() {
  var d = getExportData();
  var doc = new jspdf.jsPDF('l', 'mm', 'letter');
  var W = doc.internal.pageSize.getWidth();
  var mg = 15;
  var y = 15;

  // Header
  doc.setFillColor(0, 57, 93);
  doc.rect(0, 0, W, 22, 'F');
  doc.setTextColor(255, 255, 255);
  doc.setFontSize(16);
  doc.setFont('helvetica', 'bold');
  doc.text('REPORTE EXPERTCELL ‚Äî COTIZADOR AT&T', mg, 14);
  doc.setFontSize(9);
  doc.setFont('helvetica', 'normal');
  doc.text('Periodo: ' + d.periodoLabel + '  |  Generado: ' + new Date().toLocaleString('es-MX'), W - mg, 14, { align: 'right' });

  y = 30;
  doc.setTextColor(0, 0, 0);

  // KPIs row
  var kpis = [
    { label: 'Total', value: d.total, color: [0,159,219] },
    { label: 'Ventas', value: d.ventas, color: [15,169,88] },
    { label: 'Confirmadas', value: d.confirmadas, color: [15,169,88] },
    { label: 'No Confirmadas', value: d.noConfirmadas, color: [220,53,69] },
    { label: '% Confirmaci√≥n', value: d.pctConf + '%', color: [0,57,93] },
    { label: '% Conversi√≥n', value: d.conversion + '%', color: [0,57,93] },
    { label: 'Seguimiento', value: d.seguimiento, color: [230,162,0] },
    { label: 'Perdidas', value: d.perdidas, color: [220,53,69] },
  ];
  var kpiW = (W - mg * 2) / kpis.length;
  kpis.forEach(function(k, i) {
    var x = mg + i * kpiW;
    doc.setFillColor(245, 247, 250);
    doc.roundedRect(x + 1, y, kpiW - 2, 18, 2, 2, 'F');
    doc.setFontSize(14);
    doc.setFont('helvetica', 'bold');
    doc.setTextColor(k.color[0], k.color[1], k.color[2]);
    doc.text(String(k.value), x + kpiW / 2, y + 9, { align: 'center' });
    doc.setFontSize(6);
    doc.setTextColor(100, 100, 100);
    doc.setFont('helvetica', 'normal');
    doc.text(k.label, x + kpiW / 2, y + 15, { align: 'center' });
  });
  y += 25;

  // Table
  var tableData = d.rows.map(function(r) {
    return [r['Folio'], r['Fecha'], r['Cliente'], r['Tel√©fono'], r['Ejecutivo'], r['Estatus'], r['Subtipificaci√≥n'], r['Folio ATT'], r['Equipos']];
  });

  doc.autoTable({
    startY: y,
    head: [['Folio', 'Fecha', 'Cliente', 'Tel√©fono', 'Ejecutivo', 'Estatus', 'Subtipificaci√≥n', 'Folio ATT', 'Equipos']],
    body: tableData,
    margin: { left: mg, right: mg },
    styles: { fontSize: 7, cellPadding: 2 },
    headStyles: { fillColor: [0, 57, 93], textColor: 255, fontStyle: 'bold', fontSize: 7 },
    alternateRowStyles: { fillColor: [245, 247, 250] },
    columnStyles: {
      0: { cellWidth: 28 },
      1: { cellWidth: 18 },
      2: { cellWidth: 30 },
      3: { cellWidth: 22 },
      4: { cellWidth: 28 },
      5: { cellWidth: 20 },
      6: { cellWidth: 30 },
      7: { cellWidth: 20 },
    },
  });

  // Footer on each page
  var totalPages = doc.internal.getNumberOfPages();
  for (var p = 1; p <= totalPages; p++) {
    doc.setPage(p);
    doc.setFontSize(7);
    doc.setTextColor(150);
    doc.text('ExpertCell ‚Äî Distribuidor Autorizado AT&T', mg, doc.internal.pageSize.getHeight() - 6);
    doc.text('P√°gina ' + p + ' de ' + totalPages, W - mg, doc.internal.pageSize.getHeight() - 6, { align: 'right' });
  }

  var fileName = 'Reporte_ExpertCell_' + new Date().toISOString().slice(0,10) + '.pdf';
  doc.save(fileName);
}

// ============================================================
// CRUCE DE VENTAS
// ============================================================
var cruceData = []; // parsed rows from uploaded file
var cruceHeaders = []; // column headers

function procesarCruceVentas(input) {
  var file = input.files[0];
  if (!file) return;
  document.getElementById('cruceFileName').textContent = file.name;

  var reader = new FileReader();
  reader.onload = function(e) {
    try {
      var wb = XLSX.read(e.target.result, { type: 'array' });
      var ws = wb.Sheets[wb.SheetNames[0]];
      var json = XLSX.utils.sheet_to_json(ws, { defval: '' });
      if (json.length === 0) { alert('El archivo est√° vac√≠o.'); return; }

      cruceData = json;
      cruceHeaders = Object.keys(json[0]);

      // Fill column mapping dropdowns
      var telSel = document.getElementById('cruceColTelefono');
      var folSel = document.getElementById('cruceColFolio');
      telSel.innerHTML = '<option value="">No disponible</option>';
      folSel.innerHTML = '<option value="">No disponible</option>';

      cruceHeaders.forEach(function(h) {
        var hLow = h.toLowerCase();
        telSel.innerHTML += '<option value="' + h + '"' + (hLow.includes('tel') || hLow.includes('phone') || hLow.includes('celular') || hLow.includes('m√≥vil') || hLow.includes('movil') ? ' selected' : '') + '>' + h + '</option>';
        folSel.innerHTML += '<option value="' + h + '"' + (hLow.includes('folio') || hLow.includes('order') || hLow.includes('orden') || hLow.includes('pedido') ? ' selected' : '') + '>' + h + '</option>';
      });

      document.getElementById('cruceColumnConfig').style.display = 'block';
      document.getElementById('cruceResults').innerHTML = '<div style="font-size:12px;color:var(--text-3)">' + cruceData.length + ' registros encontrados. Mapea las columnas y ejecuta el cruce.</div>';
    } catch(err) {
      alert('Error al leer archivo: ' + err.message);
    }
  };
  reader.readAsArrayBuffer(file);
}

function normalizeTel(tel) {
  if (!tel) return '';
  return String(tel).replace(/\D/g, '').slice(-10);
}

async function ejecutarCruce() {
  var colTel = document.getElementById('cruceColTelefono').value;
  var colFolio = document.getElementById('cruceColFolio').value;

  if (!colTel && !colFolio) {
    alert('Selecciona al menos una columna para cruzar.');
    return;
  }

  // Build lookup sets from file
  var ventaTels = new Set();
  var ventaFolios = new Set();
  cruceData.forEach(function(row) {
    if (colTel && row[colTel]) ventaTels.add(normalizeTel(row[colTel]));
    if (colFolio && row[colFolio]) ventaFolios.add(String(row[colFolio]).trim().toUpperCase());
  });

  // Get ventas from cotizaciones
  var ventaCots = state.cotizaciones.filter(function(c) { return c.estatus === 'venta'; });

  var confirmadas = [];
  var noConfirmadas = [];

  ventaCots.forEach(function(c) {
    var telMatch = colTel && c.cliente && c.cliente.telefono && ventaTels.has(normalizeTel(c.cliente.telefono));
    var folioMatch = colFolio && c.folio_att && ventaFolios.has(c.folio_att.trim().toUpperCase());

    if (telMatch || folioMatch) {
      confirmadas.push({ cot: c, matchType: telMatch && folioMatch ? 'Tel√©fono + Folio' : telMatch ? 'Tel√©fono' : 'Folio AT&T' });
    } else {
      noConfirmadas.push(c);
    }
  });

  // Update Supabase - mark confirmed
  if (supabase) {
    for (var i = 0; i < confirmadas.length; i++) {
      try {
        await supabase.from('cotizaciones').update({ sub_estatus: 'confirmada' }).eq('folio', confirmadas[i].cot.folio);
        confirmadas[i].cot.sub_estatus = 'confirmada';
      } catch(e) { console.error(e); }
    }
    for (var j = 0; j < noConfirmadas.length; j++) {
      try {
        await supabase.from('cotizaciones').update({ sub_estatus: 'no_confirmada' }).eq('folio', noConfirmadas[j].folio);
        noConfirmadas[j].sub_estatus = 'no_confirmada';
      } catch(e) { console.error(e); }
    }
  }
  saveState();

  // Render results
  var html = '';

  // Summary
  html += '<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:12px">';
  html += '<div class="kpi-card"><div class="kpi-value">' + ventaCots.length + '</div><div class="kpi-label">Ventas reportadas</div></div>';
  html += '<div class="kpi-card"><div class="kpi-value" style="color:#0FA958">' + confirmadas.length + '</div><div class="kpi-label">Confirmadas ‚úÖ</div></div>';
  html += '<div class="kpi-card"><div class="kpi-value" style="color:#DC3545">' + noConfirmadas.length + '</div><div class="kpi-label">No confirmadas ‚ö†Ô∏è</div></div>';
  html += '</div>';

  // No confirmadas first (these need attention)
  if (noConfirmadas.length > 0) {
    html += '<div style="font-weight:700;font-size:13px;color:#DC3545;margin-bottom:6px">‚ö†Ô∏è No confirmadas (' + noConfirmadas.length + ') ‚Äî Requieren revisi√≥n</div>';
    noConfirmadas.forEach(function(c) {
      html += '<div class="cruce-card no-confirmada">';
      html += '<div style="display:flex;justify-content:space-between;align-items:center">';
      html += '<div><span style="font-weight:700">' + c.folio + '</span> <span class="cruce-badge warn">NO CONFIRMADA</span></div>';
      html += '</div>';
      html += '<div style="font-size:11px;color:var(--text-2);margin-top:4px">';
      html += c.cliente.nombre + ' ¬∑ ' + (c.cliente.telefono || 'Sin tel') + ' ¬∑ Folio ATT: ' + (c.folio_att || 'N/A');
      html += ' ¬∑ Ejecutivo: ' + (c.ejecutivo ? c.ejecutivo.nombre : 'N/A');
      html += '</div></div>';
    });
  }

  // Confirmadas
  if (confirmadas.length > 0) {
    html += '<div style="font-weight:700;font-size:13px;color:#0FA958;margin:12px 0 6px">‚úÖ Confirmadas (' + confirmadas.length + ')</div>';
    confirmadas.forEach(function(item) {
      var c = item.cot;
      html += '<div class="cruce-card confirmada">';
      html += '<div style="display:flex;justify-content:space-between;align-items:center">';
      html += '<div><span style="font-weight:700">' + c.folio + '</span> <span class="cruce-badge ok">CONFIRMADA</span>';
      html += ' <span style="font-size:10px;color:var(--text-3)">por ' + item.matchType + '</span></div>';
      html += '</div>';
      html += '<div style="font-size:11px;color:var(--text-2);margin-top:4px">';
      html += c.cliente.nombre + ' ¬∑ ' + (c.cliente.telefono || 'Sin tel') + ' ¬∑ Folio ATT: ' + (c.folio_att || 'N/A');
      html += ' ¬∑ Ejecutivo: ' + (c.ejecutivo ? c.ejecutivo.nombre : 'N/A');
      html += '</div></div>';
    });
  }

  if (ventaCots.length === 0) {
    html += '<div style="font-size:12px;color:var(--text-3)">No hay cotizaciones marcadas como "Venta Exitosa" para cruzar.</div>';
  }

  document.getElementById('cruceResults').innerHTML = html;
}

// ============================================================
// ADMIN PANEL
// ============================================================
var adminCentros = [];
var adminUsers = [];

async function openAdmin() {
  showView('admin', 'Admin Usuarios');
  await loadAdminData();
  renderAdminUsers();
}

async function loadAdminData() {
  if (!supabase) return;
  try {
    var { data: c } = await supabase.from('centros').select('*').order('nombre');
    adminCentros = c || [];
    var { data: u } = await supabase.from('usuarios').select('*').order('nombre');
    var allUsers = u || [];

    // Filter based on role
    if (currentUser.rol === 'coordinador') {
      adminUsers = allUsers.filter(function(usr) {
        return usr.coordinador_id === currentUser.id || usr.id === currentUser.id;
      });
    } else if (currentUser.rol === 'supervisor') {
      adminUsers = allUsers.filter(function(usr) {
        return usr.supervisor_id === currentUser.id || usr.id === currentUser.id;
      });
    } else {
      adminUsers = allUsers;
    }

    // Fill centro dropdowns
    var centroSel = document.getElementById('adminFilterCentro');
    var newCentroSel = document.getElementById('newUserCentro');

    if (currentUser.rol === 'coordinador') {
      centroSel.style.display = 'none';
      newCentroSel.innerHTML = '';
      var myCentro = adminCentros.find(function(c){ return c.id === currentUser.centro_id; });
      if (myCentro) {
        newCentroSel.innerHTML = '<option value="'+myCentro.id+'">'+myCentro.nombre+' ('+myCentro.ciudad+')</option>';
      }
    } else if (currentUser.rol === 'supervisor') {
      centroSel.style.display = 'none';
    } else {
      centroSel.style.display = '';
      centroSel.innerHTML = '<option value="all">Todos los centros</option>';
      newCentroSel.innerHTML = '';
      adminCentros.forEach(function(c) {
        centroSel.innerHTML += '<option value="'+c.id+'">'+c.nombre+' ('+c.ciudad+')</option>';
        newCentroSel.innerHTML += '<option value="'+c.id+'">'+c.nombre+' ('+c.ciudad+')</option>';
      });
    }
  } catch(e) { console.error('Admin load error:', e); }
}

function renderAdminUsers() {
  var filterRol = document.getElementById('adminFilterRol').value;
  var filterCentro = document.getElementById('adminFilterCentro').value;
  var filterEstatus = document.getElementById('adminFilterEstatus').value;
  var list = adminUsers.filter(function(u) {
    if (filterRol !== 'all' && u.rol !== filterRol) return false;
    if (filterCentro !== 'all' && u.centro_id !== parseInt(filterCentro)) return false;
    if (filterEstatus === 'activos' && !u.activo) return false;
    if (filterEstatus === 'baja' && u.activo) return false;
    return true;
  });

  var rolColors = { admin:'#009FDB', coordinador:'#0FA958', supervisor:'#E6A200', agente:'#8899AA' };
  var html = '<div style="display:flex;flex-direction:column;gap:6px">';
  list.forEach(function(u) {
    var centro = adminCentros.find(function(c){return c.id===u.centro_id;});
    var sup = adminUsers.find(function(s){return s.id===u.supervisor_id;});
    var coord = adminUsers.find(function(c){return c.id===u.coordinador_id;});
    var opacity = u.activo ? '1' : '0.6';
    html += '<div style="background:white;padding:10px 14px;border-radius:8px;border:1px solid '+(u.activo?'var(--border)':'#DC3545')+';display:flex;justify-content:space-between;align-items:center;opacity:'+opacity+'">';
    html += '<div>';
    html += '<span style="font-weight:700;color:var(--text)">' + u.nombre + '</span>';
    html += ' <span style="font-size:11px;color:var(--text-3)">' + u.attuid + '</span>';
    html += ' <span style="font-size:10px;background:'+rolColors[u.rol]+';color:white;padding:1px 6px;border-radius:4px">' + u.rol + '</span>';
    if (!u.activo) html += ' <span style="font-size:10px;background:#DC3545;color:white;padding:1px 6px;border-radius:4px">BAJA</span>';
    if (centro) html += ' <span style="font-size:10px;color:var(--text-3)">' + centro.nombre + '</span>';
    if (sup) html += ' <span style="font-size:10px;color:var(--text-3)">‚Üí Sup: ' + sup.nombre + '</span>';
    if (coord) html += ' <span style="font-size:10px;color:var(--text-3)">‚Üí Coord: ' + coord.nombre + '</span>';
    html += '</div>';
    html += '<div style="display:flex;gap:4px;align-items:center">';

    // Don't show actions for self or admin users (except for admin)
    if (u.id !== currentUser.id && u.rol !== 'admin') {
      // Edit button
      html += '<button class="btn btn-secondary" style="font-size:10px;padding:3px 8px" onclick="editarUsuario(\''+u.id+'\')">‚úèÔ∏è</button>';
      if (u.activo) {
        // Dar de baja - available to admin, coordinador, supervisor
        html += '<button class="btn btn-secondary" style="font-size:10px;padding:3px 8px;color:#DC3545;border-color:#DC3545" onclick="darDeBaja(\''+u.id+'\')">Dar de baja</button>';
      } else {
        // Reactivar - available to admin, coordinador, supervisor
        html += '<button class="btn btn-primary" style="font-size:10px;padding:3px 8px" onclick="reactivarUsuario(\''+u.id+'\')">Reactivar</button>';
      }
      // Eliminar - ONLY admin
      if (currentUser.rol === 'admin') {
        html += '<button class="btn btn-secondary" style="font-size:10px;padding:3px 8px;color:#DC3545;border-color:#DC3545" onclick="eliminarUsuario(\''+u.id+'\',\''+u.nombre.replace(/'/g,"\\'")+'\')">üóëÔ∏è</button>';
      }
    }

    html += '</div></div>';
  });
  html += '</div>';

  var activos = list.filter(function(u){return u.activo}).length;
  var bajas = list.filter(function(u){return !u.activo}).length;
  html += '<div style="margin-top:8px;font-size:11px;color:var(--text-3)">' + list.length + ' usuarios ('+activos+' activos, '+bajas+' baja)</div>';
  document.getElementById('adminUsersList').innerHTML = html;
}

function showAddUserForm() {
  if (currentUser.rol === 'supervisor') {
    alert('Solo administradores y coordinadores pueden crear usuarios.');
    return;
  }
  document.getElementById('addUserForm').style.display = 'block';
  document.getElementById('addUserForm').dataset.editId = '';
  document.getElementById('newUserNombre').value = '';
  document.getElementById('newUserAttuid').value = '';
  document.getElementById('newUserPin').value = '';
  document.getElementById('newUserWhatsapp').value = '';
  document.getElementById('newUserError').style.display = 'none';

  // Limit roles based on current user
  var rolSel = document.getElementById('newUserRol');
  rolSel.innerHTML = '<option value="">Selecciona...</option>';
  if (currentUser.rol === 'admin') {
    rolSel.innerHTML += '<option value="coordinador">Coordinador</option>';
    rolSel.innerHTML += '<option value="supervisor">Supervisor</option>';
    rolSel.innerHTML += '<option value="agente">Agente</option>';
  } else if (currentUser.rol === 'coordinador') {
    rolSel.innerHTML += '<option value="supervisor">Supervisor</option>';
    rolSel.innerHTML += '<option value="agente">Agente</option>';
  }
  rolSel.value = '';
  updateNewUserOptions();
}

function updateNewUserOptions() {
  var rol = document.getElementById('newUserRol').value;
  var supDiv = document.getElementById('newUserSupervisorDiv');
  var coordDiv = document.getElementById('newUserCoordinadorDiv');
  supDiv.style.display = 'none';
  coordDiv.style.display = 'none';

  if (rol === 'agente') {
    supDiv.style.display = '';
    coordDiv.style.display = '';
    var supSel = document.getElementById('newUserSupervisor');
    supSel.innerHTML = '<option value="">Sin supervisor</option>';
    adminUsers.filter(function(u){return u.rol==='supervisor'&&u.activo}).forEach(function(u) {
      supSel.innerHTML += '<option value="'+u.id+'">'+u.nombre+' ('+u.attuid+')</option>';
    });
    var coordSel = document.getElementById('newUserCoordinador');
    coordSel.innerHTML = '<option value="">Sin coordinador</option>';
    adminUsers.filter(function(u){return u.rol==='coordinador'&&u.activo}).forEach(function(u) {
      coordSel.innerHTML += '<option value="'+u.id+'">'+u.nombre+' ('+u.attuid+')</option>';
    });
  } else if (rol === 'supervisor') {
    coordDiv.style.display = '';
    var coordSel = document.getElementById('newUserCoordinador');
    coordSel.innerHTML = '<option value="">Sin coordinador</option>';
    adminUsers.filter(function(u){return u.rol==='coordinador'&&u.activo}).forEach(function(u) {
      coordSel.innerHTML += '<option value="'+u.id+'">'+u.nombre+' ('+u.attuid+')</option>';
    });
  }
}

async function saveNewUser() {
  var nombre = document.getElementById('newUserNombre').value.trim();
  var attuid = document.getElementById('newUserAttuid').value.trim().toUpperCase();
  var pin = document.getElementById('newUserPin').value.trim();
  var rol = document.getElementById('newUserRol').value;
  var centro_id = parseInt(document.getElementById('newUserCentro').value);
  var whatsapp = document.getElementById('newUserWhatsapp').value.trim();
  var errEl = document.getElementById('newUserError');

  if (!nombre || !attuid || !pin || !rol) {
    errEl.textContent = 'Completa todos los campos obligatorios.';
    errEl.style.display = 'block';
    return;
  }
  if (pin.length !== 4 || !/^\d{4}$/.test(pin)) {
    errEl.textContent = 'El PIN debe ser exactamente 4 d√≠gitos.';
    errEl.style.display = 'block';
    return;
  }

  var newUser = {
    nombre: nombre,
    attuid: attuid,
    pin: pin,
    rol: rol,
    centro_id: centro_id,
    whatsapp: whatsapp || null,
    supervisor_id: null,
    coordinador_id: null,
    activo: true,
  };

  if (rol === 'agente') {
    var sup = document.getElementById('newUserSupervisor').value;
    var coord = document.getElementById('newUserCoordinador').value;
    if (sup) newUser.supervisor_id = sup;
    if (coord) newUser.coordinador_id = coord;
    // If coordinator is creating, auto-assign themselves
    if (currentUser.rol === 'coordinador') newUser.coordinador_id = currentUser.id;
  } else if (rol === 'supervisor') {
    var coord = document.getElementById('newUserCoordinador').value;
    if (coord) newUser.coordinador_id = coord;
    if (currentUser.rol === 'coordinador') newUser.coordinador_id = currentUser.id;
  }

  var editId = document.getElementById('addUserForm').dataset.editId;

  try {
    if (editId) {
      // Update existing user
      delete newUser.activo;
      var { data, error } = await supabase.from('usuarios').update(newUser).eq('id', editId).select().single();
      if (error) {
        errEl.textContent = 'Error: ' + error.message;
        errEl.style.display = 'block';
        return;
      }
      document.getElementById('addUserForm').style.display = 'none';
      document.getElementById('addUserForm').dataset.editId = '';
      await loadAdminData();
      renderAdminUsers();
      alert('Usuario ' + attuid + ' actualizado.');
    } else {
      // Insert new user
      var { data, error } = await supabase.from('usuarios').insert(newUser).select().single();
      if (error) {
        errEl.textContent = 'Error: ' + (error.message.includes('unique') ? 'ATTUID ya existe.' : error.message);
        errEl.style.display = 'block';
        return;
      }
      document.getElementById('addUserForm').style.display = 'none';
      await loadAdminData();
      renderAdminUsers();
      alert('Usuario ' + attuid + ' creado exitosamente.');
    }
  } catch(e) {
    errEl.textContent = 'Error de conexi√≥n.';
    errEl.style.display = 'block';
  }
}

function descargarPlantillaUsuarios() {
  var wb = XLSX.utils.book_new();
  var headers = [['nombre', 'attuid', 'pin', 'rol', 'centro', 'whatsapp', 'supervisor_attuid', 'coordinador_attuid']];
  var examples = [
    ['Juan P√©rez', 'JP1234', '1234', 'agente', 'Torre JV', '5512345678', 'SUP001', 'CO001'],
    ['Mar√≠a L√≥pez', 'ML5678', '5678', 'supervisor', 'Torre JV', '5598765432', '', 'CO001'],
    ['Carlos Ruiz', 'CO001', '0001', 'coordinador', 'Torre JV', '5511112222', '', ''],
  ];
  var ws = XLSX.utils.aoa_to_sheet(headers.concat(examples));
  ws['!cols'] = [{ wch:25 },{ wch:10 },{ wch:6 },{ wch:14 },{ wch:18 },{ wch:14 },{ wch:18 },{ wch:18 }];
  XLSX.utils.book_append_sheet(wb, ws, 'Usuarios');
  XLSX.writeFile(wb, 'Plantilla_Usuarios_ExpertCell.xlsx');
}

async function cargaMasivaUsuarios(input) {
  var file = input.files[0];
  if (!file || !supabase) return;
  input.value = '';

  try {
    var data = await file.arrayBuffer();
    var wb = XLSX.read(data);
    var ws = wb.Sheets[wb.SheetNames[0]];
    var rows = XLSX.utils.sheet_to_json(ws, { defval: '' });

    if (rows.length === 0) { alert('El archivo est√° vac√≠o.'); return; }

    // Load centros for mapping
    var { data: centros } = await supabase.from('centros').select('*');
    var centroMap = {};
    (centros || []).forEach(function(c) { centroMap[c.nombre.toLowerCase()] = c.id; });

    // Load existing users for supervisor/coordinator mapping
    var { data: existingUsers } = await supabase.from('usuarios').select('id, attuid');
    var attuidMap = {};
    (existingUsers || []).forEach(function(u) { attuidMap[u.attuid.toUpperCase()] = u.id; });

    var created = 0;
    var errors = [];

    for (var i = 0; i < rows.length; i++) {
      var r = rows[i];
      var nombre = String(r.nombre || '').trim();
      var attuid = String(r.attuid || '').trim().toUpperCase();
      var pin = String(r.pin || '').trim();
      var rol = String(r.rol || '').trim().toLowerCase();
      var centroNombre = String(r.centro || '').trim().toLowerCase();
      var whatsapp = String(r.whatsapp || '').trim();
      var supAttuid = String(r.supervisor_attuid || '').trim().toUpperCase();
      var coordAttuid = String(r.coordinador_attuid || '').trim().toUpperCase();

      if (!nombre || !attuid || !pin || !rol) {
        errors.push('Fila ' + (i+2) + ': Datos incompletos (' + attuid + ')');
        continue;
      }
      if (!/^\d{4}$/.test(pin)) {
        errors.push('Fila ' + (i+2) + ': PIN inv√°lido (' + attuid + ')');
        continue;
      }
      if (!['coordinador','supervisor','agente'].includes(rol)) {
        errors.push('Fila ' + (i+2) + ': Rol inv√°lido "' + rol + '" (' + attuid + ')');
        continue;
      }

      var centro_id = centroMap[centroNombre] || null;
      if (!centro_id && centroNombre) {
        errors.push('Fila ' + (i+2) + ': Centro "' + r.centro + '" no encontrado (' + attuid + ')');
        continue;
      }

      var newUser = {
        nombre: nombre,
        attuid: attuid,
        pin: pin,
        rol: rol,
        centro_id: centro_id,
        whatsapp: whatsapp || null,
        supervisor_id: supAttuid && attuidMap[supAttuid] ? attuidMap[supAttuid] : null,
        coordinador_id: coordAttuid && attuidMap[coordAttuid] ? attuidMap[coordAttuid] : null,
        activo: true,
      };

      if (currentUser.rol === 'coordinador') {
        newUser.coordinador_id = currentUser.id;
      }

      var { data: inserted, error } = await supabase.from('usuarios').upsert(newUser, { onConflict: 'attuid' }).select().single();
      if (error) {
        errors.push('Fila ' + (i+2) + ': ' + error.message + ' (' + attuid + ')');
      } else {
        created++;
        attuidMap[attuid] = inserted.id;
      }
    }

    // Second pass: update supervisor/coordinator references that couldn't be set first time
    for (var i = 0; i < rows.length; i++) {
      var r = rows[i];
      var attuid = String(r.attuid || '').trim().toUpperCase();
      var supAttuid = String(r.supervisor_attuid || '').trim().toUpperCase();
      var coordAttuid = String(r.coordinador_attuid || '').trim().toUpperCase();
      var userId = attuidMap[attuid];
      if (!userId) continue;

      var updates = {};
      if (supAttuid && attuidMap[supAttuid]) updates.supervisor_id = attuidMap[supAttuid];
      if (coordAttuid && attuidMap[coordAttuid]) updates.coordinador_id = attuidMap[coordAttuid];
      if (Object.keys(updates).length > 0) {
        await supabase.from('usuarios').update(updates).eq('id', userId);
      }
    }

    await loadAdminData();
    renderAdminUsers();

    var msg = '‚úÖ ' + created + ' usuarios procesados.';
    if (errors.length > 0) {
      msg += '\n\n‚ö†Ô∏è ' + errors.length + ' errores:\n' + errors.join('\n');
    }
    alert(msg);
  } catch(e) {
    alert('Error al procesar archivo: ' + e.message);
  }
}

// ============================================================
// RECUPERACI√ìN DE COTIZACIONES
// ============================================================
var recupCots = [];

async function openRecuperacion() {
  showView('recuperacion', 'Recuperaci√≥n');
  if (!supabase) return;

  // Load cotizaciones from inactive users that are NOT ventas
  try {
    var { data: inactiveUsers } = await supabase.from('usuarios').select('id, nombre, attuid').eq('activo', false);
    var inactiveIds = (inactiveUsers || []).map(function(u) { return u.id; });
    var inactiveMap = {};
    (inactiveUsers || []).forEach(function(u) { inactiveMap[u.id] = u; });

    if (inactiveIds.length === 0) {
      document.getElementById('recupList').innerHTML = '<div style="font-size:12px;color:var(--text-3)">No hay cotizaciones por recuperar.</div>';
      return;
    }

    var { data: cots } = await supabase.from('cotizaciones')
      .select('*, cotizacion_items(*)')
      .in('agente_id', inactiveIds)
      .neq('estatus', 'venta')
      .order('created_at', { ascending: false });

    recupCots = (cots || []).map(function(c) {
      var ag = inactiveMap[c.agente_id];
      return {
        id: c.id,
        folio: c.folio,
        agente_id: c.agente_id,
        agente_nombre: ag ? ag.nombre + ' (' + ag.attuid + ')' : 'Desconocido',
        cliente: c.cliente_nombre,
        telefono: c.cliente_telefono,
        estatus: c.estatus,
        fecha: c.fecha,
        items: (c.cotizacion_items || []).length,
      };
    });

    // Load active agents for reassignment dropdown
    var { data: activeAgents } = await supabase.from('usuarios').select('id, nombre, attuid').eq('activo', true).order('nombre');
    var agenteSel = document.getElementById('recupAgente');
    agenteSel.innerHTML = '<option value="">Selecciona agente...</option>';
    (activeAgents || []).forEach(function(u) {
      agenteSel.innerHTML += '<option value="' + u.id + '">' + u.nombre + ' (' + u.attuid + ')</option>';
    });

    renderRecuperacion();
  } catch(e) {
    console.error(e);
    document.getElementById('recupList').innerHTML = '<div style="color:var(--danger)">Error al cargar.</div>';
  }
}

function renderRecuperacion() {
  if (recupCots.length === 0) {
    document.getElementById('recupList').innerHTML = '<div style="font-size:12px;color:var(--text-3)">No hay cotizaciones por recuperar. ¬°Todo limpio!</div>';
    // Update home card
    var card = document.getElementById('cardRecuperacion');
    if (card) card.style.display = 'none';
    return;
  }

  var estatusLabels = { enviada:'Enviada', seguimiento:'Seguimiento', perdida:'Perdida' };
  var estatusColors = { enviada:'var(--att-blue)', seguimiento:'#E6A200', perdida:'#DC3545' };

  var html = '<div style="font-size:11px;color:var(--text-3);margin-bottom:8px">' + recupCots.length + ' cotizaciones por reasignar</div>';
  html += '<div style="display:flex;flex-direction:column;gap:4px">';
  recupCots.forEach(function(c) {
    html += '<div style="background:white;padding:10px 12px;border-radius:8px;border:1px solid var(--border);display:flex;align-items:center;gap:10px">';
    html += '<input type="checkbox" class="recup-check" value="' + c.id + '" style="width:16px;height:16px">';
    html += '<div style="flex:1">';
    html += '<div style="display:flex;gap:6px;align-items:center;flex-wrap:wrap">';
    html += '<span style="font-weight:700;font-size:12px">' + c.folio + '</span>';
    html += '<span style="font-size:10px;background:' + (estatusColors[c.estatus]||'#888') + ';color:white;padding:1px 6px;border-radius:4px">' + (estatusLabels[c.estatus]||c.estatus) + '</span>';
    html += '</div>';
    html += '<div style="font-size:11px;color:var(--text-2);margin-top:2px">' + c.cliente + ' ¬∑ ' + (c.telefono||'Sin tel') + ' ¬∑ ' + c.items + ' equipo(s) ¬∑ ' + c.fecha + '</div>';
    html += '<div style="font-size:10px;color:var(--text-3)">Ex-agente: ' + c.agente_nombre + '</div>';
    html += '</div></div>';
  });
  html += '</div>';
  document.getElementById('recupList').innerHTML = html;
}

function seleccionarTodasRecup() {
  document.querySelectorAll('.recup-check').forEach(function(cb) { cb.checked = !cb.checked; });
}

async function reasignarSeleccionadas() {
  var newAgenteId = document.getElementById('recupAgente').value;
  if (!newAgenteId) { alert('Selecciona un agente para reasignar.'); return; }

  var checks = document.querySelectorAll('.recup-check:checked');
  if (checks.length === 0) { alert('Selecciona al menos una cotizaci√≥n.'); return; }

  var ids = [];
  checks.forEach(function(cb) { ids.push(cb.value); });

  if (!confirm('¬øReasignar ' + ids.length + ' cotizaci√≥n(es) al agente seleccionado?')) return;

  try {
    for (var i = 0; i < ids.length; i++) {
      await supabase.from('cotizaciones').update({ agente_id: newAgenteId }).eq('id', ids[i]);
    }
    alert('‚úÖ ' + ids.length + ' cotizaci√≥n(es) reasignadas exitosamente.');
    // Reload
    await openRecuperacion();
    // Refresh main data
    await loadCotizacionesFromSupabase();
  } catch(e) {
    alert('Error: ' + e.message);
  }
}

async function moverCotsARecuperacion(userId) {
  if (!supabase) return 0;
  // Count how many non-venta cotizaciones this user has
  var { data } = await supabase.from('cotizaciones')
    .select('id')
    .eq('agente_id', userId)
    .neq('estatus', 'venta');
  return (data || []).length;
}

async function darDeBaja(userId) {
  var cotsCount = await moverCotsARecuperacion(userId);
  var msg = '¬øDar de baja a este usuario?';
  if (cotsCount > 0) {
    msg += '\n\n' + cotsCount + ' cotizaci√≥n(es) (no ventas) pasar√°n a Recuperaci√≥n para reasignarlas.';
  }
  if (!confirm(msg)) return;
  try {
    await supabase.from('usuarios').update({ activo: false }).eq('id', userId);
    await loadAdminData();
    renderAdminUsers();
    if (cotsCount > 0) {
      alert('Usuario dado de baja. Ve a Recuperaci√≥n para reasignar sus ' + cotsCount + ' cotizaci√≥n(es).');
    }
  } catch(e) { console.error(e); }
}

async function reactivarUsuario(userId) {
  if (!confirm('¬øReactivar a este usuario?')) return;
  if (!supabase) return;
  try {
    await supabase.from('usuarios').update({ activo: true }).eq('id', userId);
    await loadAdminData();
    renderAdminUsers();
  } catch(e) { console.error(e); }
}

async function editarUsuario(userId) {
  var user = adminUsers.find(function(u) { return u.id === userId; });
  if (!user) return;
  var form = document.getElementById('addUserForm');
  form.style.display = 'block';
  document.getElementById('newUserNombre').value = user.nombre;
  document.getElementById('newUserAttuid').value = user.attuid;
  document.getElementById('newUserPin').value = user.pin;
  document.getElementById('newUserWhatsapp').value = user.whatsapp || '';
  document.getElementById('newUserCentro').value = user.centro_id || '';

  // Set rol
  var rolSel = document.getElementById('newUserRol');
  // Rebuild options based on current user
  showAddUserForm();
  document.getElementById('newUserNombre').value = user.nombre;
  document.getElementById('newUserAttuid').value = user.attuid;
  document.getElementById('newUserPin').value = user.pin;
  document.getElementById('newUserWhatsapp').value = user.whatsapp || '';
  document.getElementById('newUserCentro').value = user.centro_id || '';
  document.getElementById('newUserRol').value = user.rol;
  updateNewUserOptions();

  // Set supervisor/coordinator after options populated
  setTimeout(function() {
    if (user.supervisor_id) document.getElementById('newUserSupervisor').value = user.supervisor_id;
    if (user.coordinador_id) document.getElementById('newUserCoordinador').value = user.coordinador_id;
  }, 50);

  // Mark as editing
  form.dataset.editId = userId;
  form.querySelector('div[style*="font-weight:700"]').textContent = 'Editar Usuario: ' + user.nombre;
}

async function eliminarUsuario(userId, nombre) {
  if (currentUser.rol !== 'admin') {
    alert('Solo el administrador puede eliminar usuarios.');
    return;
  }
  var cotsCount = await moverCotsARecuperacion(userId);
  var msg = '‚ö†Ô∏è ¬øELIMINAR permanentemente a ' + nombre + '?\n\nEsto NO se puede deshacer.';
  if (cotsCount > 0) {
    msg += '\n\n' + cotsCount + ' cotizaci√≥n(es) pasar√°n a Recuperaci√≥n.';
    msg += '\nPrimero debes reasignarlas antes de eliminar.';
    alert(msg);
    return;
  }
  if (!confirm(msg)) return;
  if (!confirm('√öltima confirmaci√≥n: ¬øRealmente quieres eliminar a ' + nombre + '?')) return;
  if (!supabase) return;
  try {
    await supabase.from('usuarios').delete().eq('id', userId);
    await loadAdminData();
    renderAdminUsers();
    alert('Usuario eliminado.');
  } catch(e) {
    alert('No se pudo eliminar. Primero da de baja al usuario y reasigna sus cotizaciones desde Recuperaci√≥n.');
    console.error(e);
  }
}

// ============================================================
// INIT
// ============================================================
try { loadState(); } catch(e) { console.error('loadState error:', e); }
try { selectTemplate('classic'); } catch(e) { console.error('selectTemplate error:', e); }
try { updateHome(); } catch(e) { console.error('updateHome error:', e); }

// Populate plan actual dropdown
try {
  var paSel = document.getElementById('cliPlanActual');
  if (paSel) {
    var groups = [
      { label: '‚îÄ‚îÄ AT&T Premium ‚îÄ‚îÄ', plans: PLANS_ACTUALES.filter(function(p){return p.id.startsWith('pa_')}) },
      { label: '‚îÄ‚îÄ Cons√≠guelo ‚îÄ‚îÄ', plans: PLANS_ACTUALES.filter(function(p){return p.id.startsWith('cg_')}) },
      { label: '‚îÄ‚îÄ √Årmalo ‚îÄ‚îÄ', plans: PLANS_ACTUALES.filter(function(p){return p.id.startsWith('ar_')}) },
      { label: '‚îÄ‚îÄ Con Todo ‚îÄ‚îÄ', plans: PLANS_ACTUALES.filter(function(p){return p.id.startsWith('ct_')}) },
    ];
    groups.forEach(function(g) {
      if (g.plans.length === 0) return;
      paSel.innerHTML += '<option disabled>'+g.label+'</option>';
      g.plans.forEach(function(p) {
        paSel.innerHTML += '<option value="'+p.id+'">'+p.name+' - '+p.gb+' - $'+p.price+'/mes</option>';
      });
    });
  }
} catch(e) { console.error('Plan actual init error:', e); }

tryAutoLogin();
</script>
</body>
</html>
